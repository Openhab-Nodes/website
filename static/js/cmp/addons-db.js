const t="https://raw.githubusercontent.com/openhab-nodes/addons-registry/master/extensions.json",e="https://raw.githubusercontent.com/openhab-nodes/addons-registry/master/extensions_stats.json",s="/run/recommended_extensions.json",n="/run/permissions.json";function a(t,e){for(var s=0,n=t.length;s<n;){var a=s+n>>>1;t[a].stat.d>e.stat.d?s=a+1:n=a}return t.splice(s,0,e),t}function o(t,e){for(var s=0,n=t.length;s<n;){var a=s+n>>>1;t[a].last_updated>e.last_updated?s=a+1:n=a}return t.splice(s,0,e),t}async function i(t,e){let s=localStorage.getItem(t);if(s&&(s=JSON.parse(s)),s&&s.valid_until>Date.now())return s.data;{const s=await fetch(e,{cache:"default"});let n=await s.json(),a=new Date(Date.now());return a.setHours(a.getHours()+1),localStorage.setItem(t,JSON.stringify({data:n,valid_until:a.getTime()})),n}}class r extends EventTarget{constructor(){super(),this.db=[],this.stats={}}async start(){let r;this.dispatchEvent(new CustomEvent("loader",{detail:{}})),await Promise.all([i("permissions.json",n).then(t=>this.permissions=t),i("recommended.json",s).then(t=>r=t),i("extensions.json",t).then(t=>this.db=function(t){if(!t)return t;for(let e of t)e.changelog_url&&e.changelog_url.startsWith("/")&&(e.changelog_url=e.github+e.changelog_url);return t}(t)),i("extensions_stats.json",e).then(t=>this.stats=t)]),this.db_by_id={},this.last_updated=[],this.often_installed=[],this.recommended=[];let d="";for(let t of this.db)r[t.id]&&this.recommended.push(Object.assign(t,r[t.id])),t.stat=this.stats[t.id],this.db_by_id[t.id]=t,t.stat&&t.stat.d&&a(this.often_installed,t),o(this.last_updated,t),d+=JSON.stringify({id:t.id,label:t.label,author:t.author,description:t.description,manufacturers:t.manufacturers,products:t.products});return this.searchstr=d,this.dispatchEvent(new CustomEvent("loader",{detail:{ok:this}})),this}invalidate_cache(){localStorage.removeItem("extensions.json"),localStorage.removeItem("extensions_stats.json"),this.connectedCallback()}}if(!window.addondb){const t=new r;window.addondb=t.start()}
//# sourceMappingURL=addons-db.js.map
