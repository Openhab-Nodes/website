class e{constructor(e,t,{position:i="top",className:s="popover"}){this.trigger=e,this.position=i,this.className=s,this.isTemplate=!1,this.orderedPositions=["top","right","bottom","left"],this.isTemplate="TEMPLATE"==t.tagName.toUpperCase(),this.isTemplate?(this.popover=document.createElement("div"),this.popover.innerHTML=t.innerHTML):this.popover=t,this.popover.style.zIndex=100,Object.assign(this.popover.style,{position:"fixed"}),this.popover.classList.add(s),this.handleWindowEvent=(()=>{this.isVisible&&this.reposition()}),this.handleDocumentEvent=(e=>{this.isVisible&&e.target!==this.trigger&&e.target!==this.popover&&this.destroy()})}get isVisible(){return this.isTemplate?document.body.contains(this.popover):"hidden"!==this.popover.style.visibility}show(){this.isVisible||(document.addEventListener("click",this.handleDocumentEvent),window.addEventListener("scroll",this.handleWindowEvent),window.addEventListener("resize",this.handleWindowEvent),this.isTemplate?document.body.appendChild(this.popover):this.popover.style.setProperty("visibility","visible","important"),this.reposition())}reposition(){const{top:e,left:t}=this.trigger.getBoundingClientRect(),{offsetHeight:i,offsetWidth:s}=this.trigger,{offsetHeight:o,offsetWidth:n}=this.popover,r=this.orderedPositions.indexOf(this.position),l={top:{name:"top",top:e-o,left:t-(n-s)/2},right:{name:"right",top:e-(o-i)/2,left:t+s},bottom:{name:"bottom",top:e+i,left:t-(n-s)/2},left:{name:"left",top:e-(o-i)/2,left:t-n}},h=this.orderedPositions.slice(r).concat(this.orderedPositions.slice(0,r)).map(e=>l[e]).find(e=>(this.popover.style.top=`${e.top}px`,this.popover.style.left=`${e.left}px`,function(e){const t=e.getBoundingClientRect(),i=document.documentElement;return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||i.clientHeight)&&t.right<=(window.innerWidth||i.clientWidth)}(this.popover)));this.orderedPositions.forEach(e=>{this.popover.classList.remove(`${this.className}--${e}`)}),h?this.popover.classList.add(`${this.className}--${h.name}`):(this.popover.style.top=l.bottom.top,this.popover.style.left=l.bottom.left,this.popover.classList.add(`${this.className}--bottom`))}destroy(){this.isTemplate?this.popover.remove():this.popover.style.setProperty("visibility","hidden","important"),document.removeEventListener("click",this.handleDocumentEvent),window.removeEventListener("scroll",this.handleWindowEvent),window.removeEventListener("resize",this.handleWindowEvent)}toggle(){this.isVisible?this.destroy():this.show()}}function t(e,t,i,s,o){return`\n    <div class="search-results-summary">\n        <h4>${t}</h4>\n        <p>${o}  &hellip; <a class="search-item-more" href="${e}">[more]</a></p>\n        ${null!=i?`<p>${i}</p>`:""}\n    </div>\n    `}const i={shouldSort:!0,includeMatches:!0,threshold:.3,tokenize:!1,location:0,distance:100,maxPatternLength:32,minMatchCharLength:2,keys:[{name:"title",weight:.8},{name:"contents",weight:.5},{name:"tags",weight:.3}]};window.customElements.define("ui-inlinesearch",class extends HTMLElement{constructor(){super()}clear(e,t,i,s){for(;e.firstChild;)e.firstChild.remove();for(;t.firstChild;)t.firstChild.remove();for(;i.firstChild;)i.firstChild.remove();for(;s.firstChild;)s.firstChild.remove()}renderResult(e,i,s,o,n,r,l){const h=s*i,a=h+i;let p=null,d=0,c=[];for(let i of e){for(let e of i.matches){if(!p&&i.item.tags){p="";for(let e of i.item.tags)p=p+"<a href='/tags/"+e+"'>#"+e+"</a> "}if("contents"===e.key){if(++d-1<h)continue;if(d>a)continue;let s=document.createElement("div");const o=e.indices[0][0]-60>0?e.indices[0][0]-60:0,n=e.indices[0][1]+60<i.item.contents.length?e.indices[0][1]+60:i.item.contents.length;let l=i.item.contents.substring(o,n);s.innerHTML=t(i.item.permalink,i.item.title,p,i.item.categories,l),r.appendChild(s)}else if("tags"===e.key)c.push(e.value);else if("title"===e.key){if(++d-1<h)continue;if(d>a)continue;let e=document.createElement("div");e.innerHTML=(m=i.item.permalink,v=i.item.title,u=p,i.item.categories,f=i.item.contents.substring(0,60),`\n    <div class="search-results-summary">\n        <h4><a class="search-item" href="${m}">${v}</a></h4>\n        ${f.length?`<p>${f} &hellip;</p>`:""}\n        ${null!=u?`<p>${u}</p>`:""}\n    </div>\n    `),o.appendChild(e)}}p=null}var m,v,u,f;p="";for(let e of c)p=p+"<a href='/tags/"+e+"'>#"+e+"</a> ";n.innerHTML=p;let g=d/i;if(g>1)for(let t=0;t<g;++t){const h=document.createElement("a");h.innerText=t,t!=s&&(h.href="?s="+t*i,h.onclick=(s=>{s.preventDefault(),s.stopPropagation(),this.clear(o,n,r,l),this.renderResult(e,i,t,o,n,r,l)})),h.classList.add("m-1","border","px-2"),l.appendChild(h)}}init(){let t=document.getElementById(this.getAttribute("target"));const i=document.createElement("template");if(i.innerHTML='\n        <div class="card p-1 mb-2">Document Titles</div><div id="search-results"></div>\n        <div class="card p-1 mb-2">Fulltext matches</div><div id="search-results-fulltext"></div>\n        <div class="card p-1 mb-2">Tags</div><div id="search-results-tags"></div>\n        <div id="search-results-pages"></div>\n        ',!t)return void console.warn("Did not find target: ",t);if(!i)return void console.warn("Did not find template for ",t.id);const s=t.querySelector("input");if(!s)return void console.warn("Did not find input for ",t.id);this.popover&&this.popover.destroy(),this.popover=new e(t,i,{position:"bottom"}),this.lastresultlen=0,t.action="#",t.onsubmit=(e=>(e.preventDefault(),e.stopPropagation(),!1));s.onmouseup=(()=>{window.requestAnimationFrame(()=>{this.popover.show()})}),s.onkeyup=(e=>{this.popover.show();var t=s.value.length?this.fuse.search(s.value):[];const i=this.popover.popover.querySelector("#search-results"),o=this.popover.popover.querySelector("#search-results-tags"),n=this.popover.popover.querySelector("#search-results-fulltext"),r=this.popover.popover.querySelector("#search-results-pages");this.clear(i,o,n,r),t.length>0?this.renderResult(t,5,0,i,o,n,r):0!=this.lastresultlen&&(i.innerHTML='<p class="search-results-empty">No matches found</p>'),this.lastresultlen=t.length})}async connectedCallback(){let e="";this.hasAttribute("index")&&(e="/"+this.getAttribute("index"));let t=import("../../../../../../../../js/fuse.min.js"),s=await fetch(e+"/index.json"),o=await t;o=o.default(),s=await s.json(),this.fuse=new o(s,i),this.init()}disconnectedCallback(){this.popover&&this.popover.destroy()}});
//# sourceMappingURL=inlinesearch.js.map
