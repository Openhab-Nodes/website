window.customElements.define("bind-addon-useraccount",class extends HTMLElement{constructor(){super(),this._userdata={},this.rated_cb=(t=>this.rated(t.detail)),this.addon_queue_cb=(t=>this.addon_queue(t.detail))}disconnectCallback(){this.data_unsub&&this.data_unsub(),delete this.data_unsub,this.target&&(this.target.removeEventListener("rate",this.rated_cb),this.target.removeEventListener("install",this.addon_queue_cb))}async connectedCallback(){if(this.target=document.getElementById(this.getAttribute("addonid")),!this.target)return void console.warn("No target set!");this.target.addEventListener("rate",this.rated_cb),this.target.addEventListener("install",this.addon_queue_cb);let t=await import("../../../../../../../../js/cmp/userdata.js");await import("../../../../../../../../js/cmp/addons-db.js");const a=await window.addondb;this.target.addondb=a,this.target.userawarecomponent=t.UserAwareComponent,this._userdata=t.userdata,this.fetchWithAuth=t.fetchWithAuth,this.data_unsub=this._userdata.data.subscribe(t=>this.userdatachanged(t)),this._userdata.data&&this.userdatachanged(this._userdata.data)}async rated(t){try{await this.fetchWithAuth("https://registry.openhabx.com/rating","POST",JSON.stringify(t));let a={};a["ratings."+t.addonid]=t.rate,await this._userdata.updateData(a),t.confirm()}catch(a){console.error(JSON.stringify(a)),t.error(a)}}async addon_queue(t){try{await this._userdata.queue_action(t.installid,t.code,t.addonid),t.confirm()}catch(a){t.error(a)}}userdatachanged(t){this.target.userdata=Object.assign({user:this._userdata.user},t)}});
//# sourceMappingURL=bind-addon-useraccount.js.map
