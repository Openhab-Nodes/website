{"version":3,"file":"nav-ajax-page-load.js","sources":["../../../assets/js/nav-ajax-page-load/index.js"],"sourcesContent":["/**\n * Class to handle a loaded page\n */\nclass Page {\n  constructor(dom) {\n    this.dom = dom;\n  }\n\n  /**\n   * Performs a querySelector in the page content or document\n   *\n   * @param  {string} selector\n   * @param  {DocumentElement} context\n   *\n   * @return {Node}\n   */\n  querySelector(selector, context = this.dom) {\n    const result = context.querySelector(selector);\n\n    if (!result) {\n      throw new Error(`Could not find target \"${selector}\"`);\n    }\n\n    return result;\n  }\n\n  /**\n   * Performs a querySelector\n   *\n   * @param  {string} selector\n   * @param  {DocumentElement} context\n   *\n   * @return {Nodelist}\n   */\n  querySelectorAll(selector, context = this.dom) {\n    const result = context.querySelectorAll(selector);\n\n    if (!result.length) {\n      throw new Error(`Not found the target \"${selector}\"`);\n    }\n\n    return result;\n  }\n\n  /**\n   * Removes elements in the document\n   *\n   * @param  {String} selector\n   *\n   * @return {this}\n   */\n  removeContent(selector) {\n    this.querySelectorAll(selector, document).forEach(element =>\n      element.remove()\n    );\n\n    return this;\n  }\n\n  async timeout(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Replace an element in the document by an element in the page\n   * Optionally, it can execute a callback to the new inserted element\n   *\n   * @param  {String} selector\n   * @param  {Function|undefined} callback\n   *\n   * @return {this}\n   */\n  async replaceContent(selector = 'body', options = null) {\n    const content = this.querySelector(selector);\n\n    if (!options || !options.animationInClass)\n      this.querySelector(selector, document).replaceWith(content);\n    else {\n      try {\n        const oldMain = this.querySelector(selector, document);\n        const isCurrentVisible = oldMain.hasChildNodes() && window.getComputedStyle(oldMain).opacity>0.4;\n        if (!content.hasChildNodes()) { // remove from doc\n          if (isCurrentVisible) {\n            oldMain.classList.add(...options.animationOutClass);\n          }\n        } else { // Add to doc\n          //console.log(\"IS VIS\", isCurrentVisible, window.getComputedStyle(oldMain).opacity);\n          this.querySelector(selector, document).replaceWith(content);\n          if (!isCurrentVisible) {\n            this.querySelector(selector, document).classList.add(...options.animationInClass);\n          }\n        }\n      } catch (e) {\n        console.warn(\"ANIM failed\", e);\n      }\n    }\n\n    if (options && typeof options.callback === 'function') {\n      options.callback(content);\n    }\n\n    return this;\n  }\n\n  /**\n   * Appends the content of an element in the page in other element in the document\n   * Optionally, it can execute a callback for each new inserted elements\n   *\n   * @param  {String} selector\n   * @param  {Function|undefined} callback\n   *\n   * @return {this}\n   */\n  appendContent(target = 'body', callback = undefined) {\n    const content = Array.from(this.querySelector(target).childNodes);\n    const fragment = document.createDocumentFragment();\n\n    content.forEach(item => fragment.appendChild(item));\n\n    this.querySelector(target, document).append(fragment);\n\n    if (typeof callback === 'function') {\n      content\n        .filter(item => item.nodeType === Node.ELEMENT_NODE)\n        .forEach(callback);\n    }\n\n    return this;\n  }\n\n  replaceNavReferences(context = 'head') {\n    const documentContext = this.querySelector(context, document);\n    const pageContext = this.querySelector(context);\n\n    documentContext.querySelectorAll('link[rel=\"prev\"]').forEach(link => link.remove());\n    documentContext.querySelectorAll('link[rel=\"next\"]').forEach(link => link.remove());\n    documentContext.querySelectorAll('link[rel=\"parent\"]').forEach(link => link.remove());\n\n    var link;\n    link = pageContext.querySelector('link[rel=\"prev\"]');\n    if (link) documentContext.append(link);\n    link = pageContext.querySelector('link[rel=\"next\"]');\n    if (link) documentContext.append(link);\n    link = pageContext.querySelector('link[rel=\"parent\"]');\n    if (link) documentContext.append(link);\n\n    return this;\n  }\n\n  addNewStyles(context = 'head',waitForResult=false) {\n    const currentPage = this.querySelector(context, document);\n    const newPage = this.querySelector(context);\n\n    // Inline styles are perfomed immediately\n    currentPage\n      .querySelectorAll('style')\n      .forEach(style => style.remove());\n    newPage\n      .querySelectorAll('style')\n      .forEach(style => currentPage.append(style));\n\n\n    this.oldLinks = Array.from(\n      currentPage.querySelectorAll('link[rel=\"stylesheet\"]')\n    )\n\n    const newLinks = Array.from(\n      newPage.querySelectorAll('link[rel=\"stylesheet\"]')\n    ).filter(newLink => {\n      let found = this.oldLinks.findIndex(oldLink => oldLink.href == newLink.href);\n      if (found != -1) {\n        this.oldLinks.splice(found, 1);\n        return false;\n      }\n      return true;\n    });\n\n    // Don't remove stylesheets with the data-keep flag like in:\n    // <link rel=\"stylesheet\" href=\"css/tutorial.css\" type=\"text/css\" data-keep=\"true\" />\n    this.oldLinks = this.oldLinks.filter(e => !e.dataset.keep);\n\n    return Promise.all(\n      newLinks.map(\n        link =>\n          new Promise((resolve, reject) => {\n            if (waitForResult) {\n              link.addEventListener('load', resolve);\n              link.addEventListener('error', reject);  \n            } else {\n              resolve();\n            }\n            currentPage.append(link);\n          })\n      )\n    ).then(() => this);\n  }\n\n  removeOldStyles(context = 'head') {\n    for (let link of this.oldLinks) {\n      link.remove();\n    }\n    delete this.oldLinks;\n    return this;\n  }\n\n  /**\n   * Change the scripts of the current page\n   *\n   * @param {string} context\n   *\n   * @return Promise\n   */\n  replaceScripts(context = 'head',waitForResult=false) {\n    const documentContext = this.querySelector(context, document);\n    const pageContext = this.querySelector(context);\n    const oldScripts = Array.from(\n      documentContext.querySelectorAll('script')\n    );\n    const newScripts = Array.from(pageContext.querySelectorAll('script'));\n\n    oldScripts.forEach(script => {\n      if (!script.src) {\n        script.remove();\n        return;\n      }\n\n      const index = newScripts.findIndex(\n        newScript => newScript.src === script.src\n      );\n\n      if (index === -1) {\n        script.remove();\n      } else {\n        newScripts.splice(index, 1);\n      }\n    });\n\n    return Promise.all(\n      newScripts.map(\n        script =>\n          new Promise((resolve, reject) => {\n            const scriptElement = document.createElement('script');\n\n            scriptElement.type = script.type || 'text/javascript';\n            scriptElement.defer = script.defer;\n            scriptElement.async = script.async;\n\n            if (script.src) {\n              scriptElement.src = script.src;\n              if (waitForResult) {\n                scriptElement.addEventListener('load', resolve);\n                scriptElement.addEventListener('error', reject);  \n              } else {\n                resolve();\n              }  \n              documentContext.append(scriptElement);\n              return;\n            }\n\n            scriptElement.innerText = script.innerText;\n            documentContext.append(script);\n            resolve();\n          })\n      )\n    ).then(() => Promise.resolve(this));\n  }\n}\n\n/**\n * Class to load an url and generate a page with the result\n */\nexport class UrlLoader {\n  constructor(url) {\n    this.url = url;\n    this.html = null;\n    this.state = {};\n  }\n\n  /**\n   * Performs a fetch to the url and return a promise\n   *\n   * @return {Promise}\n   */\n  fetch() {\n    return fetch(this.url);\n  }\n\n  /**\n   * Go natively to the url. Used as fallback\n   */\n  fallback() {\n    document.location = this.url;\n  }\n\n  /**\n   * Load the page with the content of the page\n   *\n   * @return {Promise}\n   */\n  async load(replace = false, state = null) {\n    if (this.html) {\n      const page = new Page(parseHtml(this.html));\n      this.setState(page.dom.title, replace, state);\n      return page;\n    }\n\n    const html = await this.fetch()\n      .then(res => {\n        if (res.status < 200 || res.status >= 300) {\n          throw new Error(`The request status code is ${res.status}`);\n        }\n\n        return res;\n      })\n      .then(res => res.text());\n\n    if (this.html !== false) {\n      this.html = html;\n    }\n\n    const page = new Page(parseHtml(html));\n    this.setState(page.dom.title, replace, state);\n    return page;\n  }\n\n  setState(title, replace = false, state = null) {\n    document.title = title;\n\n    if (state) {\n      this.state = state;\n    }\n\n    if (this.url !== document.location.href) {\n      if (replace) {\n        history.replaceState(this.state, null, this.url);\n      } else {\n        history.pushState(this.state, null, this.url);\n      }\n    } else {\n      history.replaceState(this.state, null, this.url);\n    }\n  }\n}\n\n/**\n * Class to submit a form and generate a page with the result\n */\nexport class FormLoader extends UrlLoader {\n  constructor(form) {\n    let url = form.action.split('?', 2).shift();\n    const method = (form.method || 'GET').toUpperCase();\n\n    if (method === 'GET') {\n      url += '?' + new URLSearchParams(new FormData(form));\n    }\n\n    super(url);\n\n    this.html = false;\n    this.method = method;\n    this.form = form;\n  }\n\n  /**\n   * Submit natively the form. Used as fallback\n   */\n  fallback() {\n    this.form.submit();\n  }\n\n  /**\n   * Performs a fetch with the form data and return a promise\n   *\n   * @return {Promise}\n   */\n  fetch() {\n    const options = { method: this.method };\n\n    if (this.method === 'POST') {\n      options.body = new FormData(this.form);\n    }\n\n    return fetch(this.url, options);\n  }\n}\n\nfunction parseHtml(html) {\n  html = html.trim().replace(/^\\<!DOCTYPE html\\>/i, '');\n  const doc = document.implementation.createHTMLDocument();\n  doc.documentElement.innerHTML = html;\n\n  return doc;\n}\n\n\n/**\n * A filter function\n * \n * @param {Element} element The element that was clicked on.\n * @param {String|URL} url The url to navigate to.\n * @returns Return true a full page reload is required.\n *  Return false if a html replacement is fine.\n *  Return null if the page navigation should be aborted.\n */\nfunction fnRequirePageReloadPrototype(element, url) {\n\n}\n\n/**\n * Class to handle the navigation history\n */\nclass Navigator {\n  constructor(handler) {\n    this.handler = handler;\n    this.fnRequirePageReloadList = [\n      async (el, url) => !(url && url.indexOf(`${document.location.protocol}//${document.location.host}`) === 0),\n      async (el, url) => url === document.location.href ? null : false,\n      async (el, url) => new URL(url).hash === \"#\" ? null : false\n\n    ];\n  }\n\n  /**\n   * Add a filter. Depending on the return value a page will be served via\n   * partial html replacement, a complete page reload or the page navigation will\n   * be aborted.\n   * \n   * @param {fnRequirePageReloadPrototype} fnRequirePageReload The filter function accepting two arguments: the element clicked and url\n   *\n   * @return {this}\n   */\n  addFilter(fnRequirePageReload) {\n    this.fnRequirePageReloadList.push(fnRequirePageReload);\n    return this;\n  }\n\n  async consultFilters(event, el, url) {\n    for (let fnRequirePageReload of this.fnRequirePageReloadList) {\n      const r = await fnRequirePageReload(el, url);\n      if (r === true) {\n        event.stopPropagation();\n        // Default handling. Clone the old event and attach a \"alreadyHandled\" property.\n        // The event will arrive at the a.click handler further down, but not handled\n        // ourself anymore when that property is noticed.\n        const new_e = new event.constructor(event.type, event);\n        new_e.alreadyHandled = true;\n        el.dispatchEvent(new_e);\n        return false;\n      } else if (r === null)\n        return false;\n    }\n    return true;\n  }\n\n  /**\n   * Init the navigator, attach the events to capture the history changes\n   *\n   * @return {this}\n   */\n  init() {\n    var handlePopState = (event) => {\n      this.go(document.location.href, event);\n    }\n\n    delegate('click', 'a', async (event, link) => {\n      window.removeEventListener('popstate', handlePopState);\n      if (event.alreadyHandled) return;\n      event.preventDefault();\n      if (await this.consultFilters(event, link, link.href)) this.go(link.href, event);\n      setTimeout(() => window.addEventListener('popstate', handlePopState), 0);\n    });\n\n    delegate('submit', 'form', (event, form) => {\n      if (event.alreadyHandled) return;\n      if (this.consultFilters(event, form, resolve(form.action)))\n        this.submit(form, event);\n    });\n\n    window.addEventListener('popstate', handlePopState);\n\n    return this;\n  }\n\n  /**\n   * Go to other url.\n   *\n   * @param  {string} url\n   * @param  {Event} event\n   *\n   * @return {Promise|void}\n   */\n  go(url, event) {\n    return this.load(new UrlLoader(resolve(url)), event);\n  }\n\n  /**\n   * Submit a form via ajax\n   *\n   * @param  {HTMLFormElement} form\n   * @param  {Event} event\n   *\n   * @return {Promise}\n   */\n  submit(form, event) {\n    return this.load(new FormLoader(form), event);\n  }\n\n  /**\n   * Execute a page loader\n   *\n   * @param  {UrlLoader|FormLoader} loader\n   * @param  {Event} event\n   *\n   * @return {Promise}\n   */\n  load(loader, event) {\n    try {\n      return this.handler(loader, event);\n    } catch (err) {\n      console.error(err);\n      loader.fallback();\n\n      return Promise.resolve();\n    }\n  }\n}\n\nconst link = document.createElement('a');\n\nfunction resolve(url) {\n  link.setAttribute('href', url);\n  return link.href;\n}\n\nfunction delegate(event, selector, callback) {\n  document.addEventListener(\n    event,\n    function (event) {\n      for (\n        let target = event.target;\n        target && target != this;\n        target = target.parentNode\n      ) {\n        if (target.matches(selector)) {\n          callback.call(target, event, target);\n          break;\n        }\n      }\n    },\n    true\n  );\n}\n\n/**\n * @category Web Components\n * @customelement nav-ajax-page-load\n * @description \n * To avoid flickering of the website-shell, an ajax loading mechanism\n * is used. This is a progressive enhancement and the page works without\n * it as well.\n * \n * The script only replaces part of the page with the downloaded content.\n * That is:\n * - All styles and scripts linked in the body section\n * - <main>, <footer>, <section.header>, <aside>, <nav> is replaced.\n * - \"prev\"/\"next\"/\"parent\" ref links in <head> are replaced.\n * - A \"DOMContentLoaded\" event is emitted after loading\n * \n * A not-found message is shown if loading failed.\n * \n * A replacement does not happen if the link points to the same page or (\"#\").\n * \n * @see https://github.com/oom-components/page-loader\n * @example <caption>An example</caption>\n * <nav-ajax-page-load></nav-ajax-page-load>\n */\nclass NavAjaxPageLoad extends HTMLElement {\n  constructor() {\n    super();\n\n    this.nav = new Navigator((loader, event) => {\n      if (event && event.target && event.target.classList)\n        event.target.classList.add(\"disabled\");\n      loader.load()\n        .then(page => page.addNewStyles(\"body\"))\n//        .then(page => this.checkReload(event.target, \"aside\") ? page.replaceContent('aside') : page)\n//        .then(page => this.checkReload(event.target, \"nav\") ? page.replaceContent('body>nav') : page)\n        .then(page => page.replaceNavReferences())\n        .then(page => page.replaceContent('footer#footer'))\n        .then(page => page.replaceContent('header#header .navbar-nav'))\n        .then(page => page.replaceContent('header #navbarlogo'))\n        .then(page => page.replaceContent('#pageheader',{animationInClass:[\"animated\",\"fadeInDown\"],animationOutClass:[\"beforeRemove\",\"animated\",\"fadeOutUp\"]}))\n        .then(page => page.replaceContent('main'))\n        .then(page => page.removeOldStyles(\"body\"))\n        .then(page => page.replaceScripts(\"body\"))\n        .then(() => this.prepareLoadedContent(event))\n        .catch(e => { // Connection lost? Check login\n          console.warn(\"Failed to load page:\", e);\n          document.querySelector(\"main\").innerHTML = `\n<main class='centered m-4'>\n  <section class='card p-4'>\n    <h4>Error loading the page ☹</h4>\n    ${e.message ? e.message : e}\n  </section>\n</main>\n`;\n          document.dispatchEvent(new Event('FailedLoading'));\n        })\n    });\n\n    // Perform default action if clicking on a same page link where only the hash differs.\n    // Required for anchor links\n    this.nav.addFilter((el, url) => ((el && el.dataset && !el.dataset.noReload) && new URL(url).pathname == window.location.pathname));\n    this.nav.addFilter((el, url) => {\n      if (!el || ! el.dataset) return false;\n      return el.dataset.fullreload?true:false;\n    });\n\n    // Abort page request on demand\n    this.nav.addFilter((el, url) => {\n      if (this.hasUnsavedChanges) {\n        const r = window.confirm(\"You have unsaved changes. Dismiss them?\");\n        if (r) this.hasUnsavedChanges = false;\n        return r ? false : null; // Perform a normal xhr page replacement or abort the request\n      }\n      return false;\n    });\n\n    this.boundUnsavedChanges = (event) => {\n      this.hasUnsavedChanges = event.detail;\n      window.removeEventListener(\"beforeunload\", this.boundBeforeUnload, { passive: false });\n      if (this.hasUnsavedChanges) window.addEventListener(\"beforeunload\", this.boundBeforeUnload, { passive: false });\n    }\n    this.boundBeforeUnload = (event) => {\n      if (this.hasUnsavedChanges) {\n        event.preventDefault();\n        event.returnValue = 'You have unsaved changes which will not be saved.';\n        return event.returnValue;\n      }\n    }\n  }\n\n  prepareLoadedContent(event) {\n    if (event.target && event.target.classList) event.target.classList.remove(\"disabled\");\n    setTimeout(() => {\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n      document.dispatchEvent(new Event('DOMContentLoaded'));\n      const autofocus = document.querySelector(\"input[autofocus]\");\n      if (autofocus) autofocus.focus();\n    }, 50);\n  }\n\n  checkReload(target, section) {\n    const d = (target && target.dataset && target.dataset.noReload) ? target.dataset.noReload.split(\",\") : [];\n    return !d.includes(section);\n  }\n\n  connectedCallback() {\n    this.nav.init();\n\n    document.addEventListener(\"unsavedchanges\", this.boundUnsavedChanges, { passive: true });\n  }\n  disconnectedCallback() {\n    document.removeEventListener(\"unsavedchanges\", this.boundUnsavedChanges, { passive: true });\n    window.removeEventListener(\"beforeunload\", this.boundBeforeUnload, { passive: false });\n  }\n}\n\ncustomElements.define('nav-ajax-page-load', NavAjaxPageLoad);"],"names":[],"mappings":"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"}