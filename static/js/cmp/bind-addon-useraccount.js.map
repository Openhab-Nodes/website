{"version":3,"file":"bind-addon-useraccount.js","sources":["../../../assets/js/bind-addon-useraccount/index.js"],"sourcesContent":["\nwindow.customElements.define('bind-addon-useraccount', class extends HTMLElement {\n    constructor() {\n        super();\n        this._userdata = {};\n        this.rated_cb = (event) => this.rated(event.detail);\n        this.addon_queue_cb = (event) => this.addon_queue(event.detail);\n    }\n    disconnectCallback() {\n        if (this.data_unsub)\n            this.data_unsub();\n        delete this.data_unsub;\n        if (this.target) {\n            this.target.removeEventListener(\"rate\", this.rated_cb);\n            this.target.removeEventListener(\"install\", this.addon_queue_cb);\n        }\n    }\n    async connectedCallback() {\n        this.target = document.getElementById(this.getAttribute(\"addonid\"));\n        if (!this.target) {\n            console.warn(\"No target set!\");\n            return;\n        }\n        this.target.addEventListener(\"rate\", this.rated_cb);\n        this.target.addEventListener(\"install\", this.addon_queue_cb);\n\n        let module = await import(\"/js/cmp/userdata.js\");\n        await import(\"/js/cmp/addons-db.js\");\n        const addondb = await window.addondb;\n        this.target.addondb = addondb;\n        this.target.userawarecomponent = module.UserAwareComponent;\n        this._userdata = module.userdata;\n        this.fetchWithAuth = module.fetchWithAuth;\n        this.data_unsub = this._userdata.data.subscribe(d => this.userdatachanged(d));\n        if (this._userdata.data) this.userdatachanged(this._userdata.data);\n    }\n    async rated(data) {\n        try {\n            // Submit to backend\n            await this.fetchWithAuth(\"https://registry.openhabx.com/rating\", \"POST\", JSON.stringify(data));\n\n            // Update user data\n            let upObj = {};\n            upObj[\"ratings.\" + data.addonid] = data.rate;\n            await this._userdata.updateData(upObj);\n\n            data.confirm();\n        } catch (err) {\n            console.error(JSON.stringify(err));\n            data.error(err);\n        }\n    }\n    \n    async addon_queue(data) {\n        try {\n            // Submit to backend\n            await this._userdata.queue_action(data.installid, data.code, data.addonid);\n            data.confirm();\n        } catch (err) {\n            data.error(err);\n        }\n    }\n    userdatachanged(data) {\n        this.target.userdata = Object.assign({ user: this._userdata.user }, data);\n    }\n});"],"names":["window","customElements","define","HTMLElement","[object Object]","super","this","_userdata","rated_cb","event","rated","detail","addon_queue_cb","addon_queue","data_unsub","target","removeEventListener","document","getElementById","getAttribute","console","warn","addEventListener","module","import","addondb","userawarecomponent","UserAwareComponent","userdata","fetchWithAuth","data","subscribe","d","userdatachanged","JSON","stringify","upObj","addonid","rate","updateData","confirm","err","error","queue_action","installid","code","Object","assign","user"],"mappings":"AACAA,OAAOC,eAAeC,OAAO,yBAA0B,cAAcC,YACjEC,cACIC,QACAC,KAAKC,UAAY,GACjBD,KAAKE,SAAW,CAACC,GAAUH,KAAKI,MAAMD,EAAME,SAC5CL,KAAKM,eAAiB,CAACH,GAAUH,KAAKO,YAAYJ,EAAME,SAE5DP,qBACQE,KAAKQ,YACLR,KAAKQ,oBACFR,KAAKQ,WACRR,KAAKS,SACLT,KAAKS,OAAOC,oBAAoB,OAAQV,KAAKE,UAC7CF,KAAKS,OAAOC,oBAAoB,UAAWV,KAAKM,iBAGxDR,0BAEI,GADAE,KAAKS,OAASE,SAASC,eAAeZ,KAAKa,aAAa,aACnDb,KAAKS,OAEN,YADAK,QAAQC,KAAK,kBAGjBf,KAAKS,OAAOO,iBAAiB,OAAQhB,KAAKE,UAC1CF,KAAKS,OAAOO,iBAAiB,UAAWhB,KAAKM,gBAE7C,IAAIW,QAAeC,OAAO,oDACpBA,OAAO,+CACb,MAAMC,QAAgBzB,OAAOyB,QAC7BnB,KAAKS,OAAOU,QAAUA,EACtBnB,KAAKS,OAAOW,mBAAqBH,EAAOI,mBACxCrB,KAAKC,UAAYgB,EAAOK,SACxBtB,KAAKuB,cAAgBN,EAAOM,cAC5BvB,KAAKQ,WAAaR,KAAKC,UAAUuB,KAAKC,UAAUC,GAAK1B,KAAK2B,gBAAgBD,IACtE1B,KAAKC,UAAUuB,MAAMxB,KAAK2B,gBAAgB3B,KAAKC,UAAUuB,MAEjE1B,YAAY0B,GACR,UAEUxB,KAAKuB,cAAc,uCAAwC,OAAQK,KAAKC,UAAUL,IAGxF,IAAIM,EAAQ,GACZA,EAAM,WAAaN,EAAKO,SAAWP,EAAKQ,WAClChC,KAAKC,UAAUgC,WAAWH,GAEhCN,EAAKU,UACP,MAAOC,GACLrB,QAAQsB,MAAMR,KAAKC,UAAUM,IAC7BX,EAAKY,MAAMD,IAInBrC,kBAAkB0B,GACd,UAEUxB,KAAKC,UAAUoC,aAAab,EAAKc,UAAWd,EAAKe,KAAMf,EAAKO,SAClEP,EAAKU,UACP,MAAOC,GACLX,EAAKY,MAAMD,IAGnBrC,gBAAgB0B,GACZxB,KAAKS,OAAOa,SAAWkB,OAAOC,OAAO,CAAEC,KAAM1C,KAAKC,UAAUyC,MAAQlB"}