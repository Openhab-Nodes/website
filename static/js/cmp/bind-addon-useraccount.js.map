{"version":3,"file":"bind-addon-useraccount.js","sources":["../../../assets/js/bind-addon-useraccount/index.js"],"sourcesContent":["\nwindow.customElements.define('bind-addon-useraccount', class extends HTMLElement {\n    constructor() {\n        super();\n        this._userdata = {};\n        this.rated_cb = (event) => this.rated(event.detail);\n        this.addon_queue_cb = (event) => this.addon_queue(event.detail);\n    }\n    disconnectCallback() {\n        if (this.data_unsub)\n            this.data_unsub();\n        delete this.data_unsub;\n        if (this.target) {\n            this.target.removeEventListener(\"rate\", this.rated_cb);\n            this.target.removeEventListener(\"install\", this.addon_queue_cb);\n        }\n    }\n    async connectedCallback() {\n        this.target = document.getElementById(this.getAttribute(\"addonid\"));\n        if (!this.target) {\n            console.warn(\"No target set!\");\n            return;\n        }\n        this.target.addEventListener(\"rate\", this.rated_cb);\n        this.target.addEventListener(\"install\", this.addon_queue_cb);\n\n        let module = await import(\"/js/cmp/userdata.js\");\n        await import(\"/js/cmp/addons-db.js\");\n        const addondb = await window.addondb;\n        this.target.addondb = addondb;\n        this.target.userawarecomponent = module.UserAwareComponent;\n        this._userdata = module.userdata;\n        this.fetchWithAuth = module.fetchWithAuth;\n        this.data_unsub = this._userdata.data.subscribe(d => this.userdatachanged(d));\n        if (this._userdata.data) this.userdatachanged(this._userdata.data);\n    }\n    async rated(data) {\n        try {\n            // Submit to firestore. This will be synced to the backend periodically\n            var db = this._userdata.db();\n            await db.collection(\"ratings\")\n                .doc(user.uid + \"_\" + data.addonid)\n                .update({ rate: data.rate, last_rating: data.last_rating, addon_id: data.addonid });\n\n            // Update user data\n            let upObj = {};\n            upObj[\"ratings.\" + data.addonid] = data.rate;\n            await this._userdata.updateData(upObj);\n\n            data.confirm();\n        } catch (err) {\n            console.error(JSON.stringify(err));\n            data.error(err);\n        }\n    }\n\n    async addon_queue(data) {\n        try {\n            // Submit to backend\n            await this._userdata.queue_action(data.installid, data.code, data.addonid);\n            data.confirm();\n        } catch (err) {\n            data.error(err);\n        }\n    }\n    userdatachanged(data) {\n        this.target.userdata = Object.assign({ user: this._userdata.user }, data);\n    }\n});"],"names":[],"mappings":"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"}