var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};function e(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function r(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function i(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function o(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=o(t[n],e[n]));return t}function a(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var s="FirebaseError",u=function(t){function n(e,r){var i=t.call(this,r)||this;return i.code=e,i.name=s,Object.setPrototypeOf(i,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,c.prototype.create),i}return e(n,t),n}(Error),c=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(h,function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",c=new u(i,s),l=0,f=Object.keys(r);l<f.length;l++){var p=f[l];"_"!==p.slice(-1)&&(p in c&&console.warn('Overwriting FirebaseError base field "'+p+'" can cause unexpected behavior.'),c[p]=r[p])}return c},t}();var h=/\{\$([^}]+)}/g;function l(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function f(t,e){var n=new d(t,e);return n.subscribe.bind(n)}var p,d=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=m),void 0===r.error&&(r.error=m),void 0===r.complete&&(r.complete=m);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function m(){}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(p||(p={}));var y,g=p.INFO,v=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case p.DEBUG:case p.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case p.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case p.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case p.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},b=function(){function t(t){this.name=t,this._logLevel=g,this._logHandler=v}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in p))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,p.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,p.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,p.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,p.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,p.ERROR].concat(t))},t}(),w=((y={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",y["bad-app-name"]="Illegal App name: '{$appName}",y["duplicate-app"]="Firebase App named '{$appName}' already exists",y["app-deleted"]="Firebase App named '{$appName}' already deleted",y["duplicate-service"]="Firebase service named '{$appName}' already registered",y["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",y),E=new c("app","Firebase",w),T="[DEFAULT]",I=[],S=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=o(void 0,t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){I.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){I=I.filter(function(e){return e!==t})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],n=0,r=Object.keys(t.services_);n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(t.services_[i]);o<a.length;o++){var s=a[o];e.push(t.services_[i][s])}return Promise.all(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=T),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==T?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=T),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;o(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(I.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),I=[])},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw E.create("app-deleted",{appName:this.name_})},t}();S.prototype.name&&S.prototype.options||S.prototype.delete||console.log("dc");var A="6.3.4";var N=new b("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){N.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var C=self.firebase.SDK_VERSION;C&&C.indexOf("LITE")>=0&&N.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var _=function t(){var e=function(t){var e={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){if(void 0===r&&(r={}),"object"!=typeof r||null===r){var o=r;r={name:o}}var a=r;void 0===a.name&&(a.name=T);var s=a.name;if("string"!=typeof s||!s)throw E.create("bad-app-name",{appName:String(s)});if(l(e,s))throw E.create("duplicate-app",{appName:s});var c=new t(n,a,i);return e[s]=c,u(c,"create"),c},app:a,apps:null,SDK_VERSION:A,INTERNAL:{registerService:function(e,u,c,h,l){if(void 0===l&&(l=!1),n[e])throw E.create("duplicate-service",{appName:e});function f(t){if(void 0===t&&(t=a()),"function"!=typeof t[e])throw E.create("invalid-app-argument",{appName:e});return t[e]()}return n[e]=u,h&&(r[e]=h,s().forEach(function(t){h("create",t)})),void 0!==c&&o(f,c),i[e]=f,t.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._getService.bind(this,e).apply(this,l?t:[])},f},removeApp:function(t){u(e[t],"delete"),delete e[t]},factories:n,useAsService:c}};function a(t){if(!l(e,t=t||T))throw E.create("no-app",{appName:t});return e[t]}function s(){return Object.keys(e).map(function(t){return e[t]})}function u(t,e){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=c(0,o[i]);if(null===a)return;r[a]&&r[a](e,t)}}function c(t,e){return"serverAuth"===e?null:e}return i.default=i,Object.defineProperty(i,"apps",{get:s}),a.App=t,i}(S);return e.INTERNAL=n({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){o(e,t)},createSubscribe:f,ErrorFactory:c,deepExtend:o}),e}(),D=_.initializeApp;_.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&N.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),D.apply(void 0,t)};var k=_;(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function r(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function i(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:r(t)}}!function(t,r){if(r){var i=n;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in i||(i[a]={}),i=i[a]}(r=r(o=i[t=t[t.length-1]]))!=o&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Promise",function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function r(){this.a=null}function o(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;r.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var a=n.setTimeout;r.prototype.c=function(t){a(t,0)},r.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},r.prototype.f=function(t){this.c(function(){throw t})},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.o),reject:t(this.g)}},e.prototype.o=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.u(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.l(t):this.h(t)}},e.prototype.l=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.m()},e.prototype.m=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new r;return e.prototype.u=function(t){var e=this.f();t.Ja(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){o(t)}}:e}var i,o,a=new e(function(t,e){i=t,o=e});return this.Ja(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Ja=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=o,e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=i(t),a=r.next();!a.done;a=r.next())o(a.value).Ja(e,n)})},e.all=function(t){var n=i(t),r=n.next();return r.done?o([]):new e(function(t,e){function i(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,o(r.value).Ja(i(a.length-1),e),r=n.next()}while(!r.done)})},e});var o=o||{},a=this||self;function s(t){return"string"==typeof t}function u(t){return"boolean"==typeof t}var c=/^[\w+\/_-]+[=]{0,2}$/,h=null;function l(){}function f(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function p(t){return null===t}function d(t){return"array"==f(t)}function m(t){var e=f(t);return"array"==e||"object"==e&&"number"==typeof t.length}function y(t){return"function"==f(t)}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var v="closure_uid_"+(1e9*Math.random()>>>0),b=0;function w(t,e,n){return t.call.apply(t.bind,arguments)}function E(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function T(t,e,n){return(T=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:E).apply(null,arguments)}function I(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var S=Date.now||function(){return+new Date};function A(t,e){function n(){}n.prototype=e.prototype,t.qb=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.cd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function N(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function _(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function D(t,e){throw new _("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function R(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function O(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function P(){this.b=this.a=null}A(C,Error),C.prototype.name="CustomError",A(_,C),_.prototype.name="AssertionError",R.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var L=new R(function(){return new x},function(t){t.reset()});function M(){var t=Kt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function x(){this.next=this.b=this.a=null}function U(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||a).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(g(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;D("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}P.prototype.add=function(t,e){var n=L.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},x.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},x.prototype.reset=function(){this.next=this.b=this.a=null};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(s(t))return s(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=s(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var V=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=s(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},B=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function j(t,e){return 0<=q(t,e)}function K(t,e){var n;return(n=0<=(e=q(t,e)))&&Array.prototype.splice.call(t,e,1),n}function G(t,e){!function(t,e){for(var n=s(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,function(n,r){e.call(void 0,n,r,t)&&1==Array.prototype.splice.call(t,r,1).length&&0})}function W(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function H(t){for(var e in t)return!1;return!0}function Y(t){var e,n={};for(e in t)n[e]=t[e];return n}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<X.length;o++)n=X[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function $(t,e){this.a=t===et&&e||"",this.b=tt}function Z(t){return t instanceof $&&t.constructor===$&&t.b===tt?t.a:(D("expected object of type Const, got '"+t+"'"),"type_error:Const")}$.prototype.na=!0,$.prototype.ma=function(){return this.a},$.prototype.toString=function(){return"Const{"+this.a+"}"};var tt={},et={},nt=new $(et,"");function rt(){this.a="",this.b=ut}function it(t){return t instanceof rt&&t.constructor===rt&&t.b===ut?t.a:(D("expected object of type TrustedResourceUrl, got '"+t+"' of type "+f(t)),"type_error:TrustedResourceUrl")}function ot(t,e){var n=Z(t);if(!st.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return ct(t=n.replace(at,function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof $?Z(t):encodeURIComponent(String(t))}))}rt.prototype.na=!0,rt.prototype.ma=function(){return this.a.toString()},rt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var at=/%{(\w+)}/g,st=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^\/\\]|[^:\/\\%]+\/|[^:\/\\%]*[?#]|about:blank#)/i,ut={};function ct(t){var e=new rt;return e.a=t,e}var ht=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},lt=/&/g,ft=/</g,pt=/>/g,dt=/"/g,mt=/'/g,yt=/\x00/g,gt=/[\x00&<>"']/;function vt(t,e){return-1!=t.indexOf(e)}function bt(t,e){return t<e?-1:t>e?1:0}function wt(){this.a="",this.b=At}function Et(t){return t instanceof wt&&t.constructor===wt&&t.b===At?t.a:(D("expected object of type SafeUrl, got '"+t+"' of type "+f(t)),"type_error:SafeUrl")}wt.prototype.na=!0,wt.prototype.ma=function(){return this.a.toString()},wt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Tt=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function It(t){return t instanceof wt?t:(t="object"==typeof t&&t.na?t.ma():String(t),Tt.test(t)||(t="about:invalid#zClosurez"),Nt(t))}var St,At={};function Nt(t){var e=new wt;return e.a=t,e}Nt("about:blank");t:{var Ct=a.navigator;if(Ct){var _t=Ct.userAgent;if(_t){St=_t;break t}}St=""}function Dt(t){return vt(St,t)}function kt(){this.a="",this.b=Ot}function Rt(t){return t instanceof kt&&t.constructor===kt&&t.b===Ot?t.a:(D("expected object of type SafeHtml, got '"+t+"' of type "+f(t)),"type_error:SafeHtml")}kt.prototype.na=!0,kt.prototype.ma=function(){return this.a.toString()},kt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Ot={};function Pt(t){var e=new kt;return e.a=t,e}Pt("<!DOCTYPE html>");var Lt,Mt,xt=Pt("");function Ut(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function qt(t){return gt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(lt,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ft,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(pt,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(dt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(mt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(yt,"&#0;"))),t}function Ft(t){a.setTimeout(function(){throw t},0)}function Vt(){var t=a.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Dt("Presto")&&(t=function(){var t,e,n=document.createElement("IFRAME");n.style.display="none",t=n,e=ct(Z(nt)),U(t,"HTMLIFrameElement"),t.src=it(e).toString(),document.documentElement.appendChild(n);var r=n.contentWindow;(n=r.document).open(),n.write(Rt(xt)),n.close();var i="callImmediate"+Math.random(),o="file:"==r.location.protocol?"*":r.location.protocol+"//"+r.location.host;n=T(function(t){"*"!=o&&t.origin!=o||t.data!=i||this.port1.onmessage()},this),r.addEventListener("message",n,!1),this.port1={},this.port2={postMessage:function(){r.postMessage(i,o)}}}),void 0!==t&&!Dt("Trident")&&!Dt("MSIE")){var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){a.setTimeout(t,0)}}function Bt(t,e){Mt||function(){if(a.Promise&&a.Promise.resolve){var t=a.Promise.resolve(void 0);Mt=function(){t.then(Gt)}}else Mt=function(){var t=Gt;!y(a.setImmediate)||a.Window&&a.Window.prototype&&!Dt("Edge")&&a.Window.prototype.setImmediate==a.setImmediate?(Lt||(Lt=Vt()),Lt(t)):a.setImmediate(t)}}(),jt||(Mt(),jt=!0),Kt.add(t,e)}Pt("<br>");var jt=!1,Kt=new P;function Gt(){for(var t;t=M();){try{t.a.call(t.b)}catch(t){Ft(t)}O(L,t)}jt=!1}function Wt(t,e){if(this.a=Qt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=l)try{var n=this;t.call(e,function(t){ie(n,zt,t)},function(t){if(!(t instanceof le))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ie(n,Ht,t)})}catch(t){ie(this,Ht,t)}}var Qt=0,zt=2,Ht=3;function Yt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Yt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Xt=new R(function(){return new Yt},function(t){t.reset()});function Jt(t,e,n){var r=Xt.get();return r.g=t,r.b=e,r.f=n,r}function $t(t){if(t instanceof Wt)return t;var e=new Wt(l);return ie(e,zt,t),e}function Zt(t){return new Wt(function(e,n){n(t)})}function te(t,e,n){oe(t,e,n,null)||Bt(I(e,t))}function ee(t){return new Wt(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Eb:!0,value:o}:{Eb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)te(t[o],I(i,o,!0),I(i,o,!1));else e(r)})}function ne(t,e){t.b||t.a!=zt&&t.a!=Ht||ae(t),t.f?t.f.next=e:t.b=e,t.f=e}function re(t,e,n,r){var i=Jt(null,null,null);return i.a=new Wt(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(t){o(t)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof le?o(e):t(i)}catch(t){o(t)}}:o}),i.a.c=t,ne(t,i),i.a}function ie(t,e,n){t.a==Qt&&(t===n&&(e=Ht,n=new TypeError("Promise cannot resolve to itself")),t.a=1,oe(n,t.Lc,t.Mc,t)||(t.i=n,t.a=e,t.c=null,ae(t),e!=Ht||n instanceof le||function(t,e){t.g=!0,Bt(function(){t.g&&he.call(null,e)})}(t,n)))}function oe(t,e,n,r){if(t instanceof Wt)return ne(t,Jt(e||l,n||null,r)),!0;if(N(t))return t.then(e,n,r),!0;if(g(t))try{var i=t.then;if(y(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function ae(t){t.h||(t.h=!0,Bt(t.Wb,t))}function se(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function ue(t,e,n,r){if(n==Ht&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ce(e,n,r);else try{e.c?e.g.call(e.f):ce(e,n,r)}catch(t){he.call(null,t)}O(Xt,e)}function ce(t,e,n){e==zt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}Wt.prototype.then=function(t,e,n){return re(this,y(t)?t:null,y(e)?e:null,n)},Wt.prototype.$goog_Thenable=!0,(t=Wt.prototype).ia=function(t,e){return(t=Jt(t,t,e)).c=!0,ne(this,t),this},t.s=function(t,e){return re(this,null,t,e)},t.cancel=function(t){this.a==Qt&&Bt(function(){!function t(e,n){if(e.a==Qt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Qt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):se(r),ue(r,o,Ht,n)))}e.c=null}else ie(e,Ht,n)}(this,new le(t))},this)},t.Lc=function(t){this.a=Qt,ie(this,zt,t)},t.Mc=function(t){this.a=Qt,ie(this,Ht,t)},t.Wb=function(){for(var t;t=se(this);)ue(this,t,this.a,this.i);this.h=!1};var he=Ft;function le(t){C.call(this,t)}function fe(){this.qa=this.qa,this.ja=this.ja}A(le,C),le.prototype.name="cancel";var pe=0;function de(t){if(!t.qa&&(t.qa=!0,t.va(),0!=pe))t[v]||(t[v]=++b)}function me(t){return me[" "](t),t}fe.prototype.qa=!1,fe.prototype.va=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},me[" "]=l;var ye,ge,ve=Dt("Opera"),be=Dt("Trident")||Dt("MSIE"),we=Dt("Edge"),Ee=we||be,Te=Dt("Gecko")&&!(vt(St.toLowerCase(),"webkit")&&!Dt("Edge"))&&!(Dt("Trident")||Dt("MSIE"))&&!Dt("Edge"),Ie=vt(St.toLowerCase(),"webkit")&&!Dt("Edge");function Se(){var t=a.document;return t?t.documentMode:void 0}t:{var Ae="",Ne=(ge=St,Te?/rv:([^\);]+)(\)|;)/.exec(ge):we?/Edge\/([\d\.]+)/.exec(ge):be?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ge):Ie?/WebKit\/(\S+)/.exec(ge):ve?/(?:Version)[ \/]?(\S+)/.exec(ge):void 0);if(Ne&&(Ae=Ne?Ne[1]:""),be){var Ce=Se();if(null!=Ce&&Ce>parseFloat(Ae)){ye=String(Ce);break t}}ye=Ae}var _e,De={};function ke(t){return function(t,e){var n=De;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=ht(String(ye)).split("."),r=ht(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=bt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||bt(0==a[2].length,0==s[2].length)||bt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}_e=a.document&&be?Se():void 0;var Re=Object.freeze||function(t){return t},Oe=!be||9<=Number(_e),Pe=be&&!ke("9"),Le=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",l,e),a.removeEventListener("test",l,e)}catch(t){}return t}();function Me(t,e){this.type=t,this.b=this.target=e,this.Kb=!0}function xe(t,e){if(Me.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Te){t:{try{me(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=s(t.pointerType)?t.pointerType:Ue[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}Me.prototype.preventDefault=function(){this.Kb=!1},A(xe,Me);var Ue=Re({2:"touch",3:"pen",4:"mouse"});xe.prototype.preventDefault=function(){xe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Pe)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},xe.prototype.f=function(){return this.a};var qe="closure_listenable_"+(1e6*Math.random()|0),Fe=0;function Ve(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Na=i,this.key=++Fe,this.oa=this.Ia=!1}function Be(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.Na=null}function je(t){this.src=t,this.a={},this.b=0}function Ke(t,e){var n=e.type;n in t.a&&K(t.a[n],e)&&(Be(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Ge(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.Na==r)return i}return-1}je.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Ge(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new Ve(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var We="closure_lm_"+(1e6*Math.random()|0),Qe={};function ze(t,e,n,r,i){if(r&&r.once)Ye(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)ze(t,e[o],n,r,i);else n=on(n),t&&t[qe]?sn(t,e,n,g(r)?!!r.capture:!!r,i):He(t,e,n,!1,r,i)}function He(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=g(i)?!!i.capture:!!i,s=nn(t);if(s||(t[We]=s=new je(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var t=en,e=Oe?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Le||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent($e(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function Ye(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ye(t,e[o],n,r,i);else n=on(n),t&&t[qe]?un(t,e,n,g(r)?!!r.capture:!!r,i):He(t,e,n,!0,r,i)}function Xe(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Xe(t,e[o],n,r,i);else r=g(r)?!!r.capture:!!r,n=on(n),t&&t[qe]?(t=t.m,(e=String(e).toString())in t.a&&(-1<(n=Ge(o=t.a[e],n,r,i))&&(Be(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=nn(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Ge(e,n,r,i)),(n=-1<t?e[t]:null)&&Je(n))}function Je(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[qe])Ke(e.m,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent($e(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=nn(e))?(Ke(n,t),0==n.b&&(n.src=null,e[We]=null)):Be(t)}}}function $e(t){return t in Qe?Qe[t]:Qe[t]="on"+t}function Ze(t,e,n,r){var i=!0;if((t=nn(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=tn(o,r),i=i&&!1!==o)}return i}function tn(t,e){var n=t.listener,r=t.Na||t.src;return t.Ia&&Je(t),n.call(r,e)}function en(t,e){if(t.oa)return!0;if(!Oe){if(!e)t:{e=["window","event"];for(var n=a,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new xe(r=e,this),n=!0,!(0>r.keyCode||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Ze(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Ze(r[i],t,!1,e),n=n&&o}return n}return tn(t,new xe(e,this))}function nn(t){return(t=t[We])instanceof je?t:null}var rn="__closure_events_fn_"+(1e9*Math.random()>>>0);function on(t){return y(t)?t:(t[rn]||(t[rn]=function(e){return t.handleEvent(e)}),t[rn])}function an(){fe.call(this),this.m=new je(this),this.Pb=this,this.Wa=null}function sn(t,e,n,r,i){t.m.add(String(e),n,!1,r,i)}function un(t,e,n,r,i){t.m.add(String(e),n,!0,r,i)}function cn(t,e,n,r){if(!(e=t.m.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.Na||a.src;a.Ia&&Ke(t.m,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Kb}function hn(t,e,n){if(y(t))n&&(t=T(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=T(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function ln(t){var e=null;return new Wt(function(n,r){-1==(e=hn(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw a.clearTimeout(e),t})}function fn(t){if(t.S&&"function"==typeof t.S)return t.S();if(s(t))return t.split("");if(m(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function pn(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(m(t)||s(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function dn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof dn)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function mn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];yn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)yn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function yn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}A(an,fe),an.prototype[qe]=!0,an.prototype.addEventListener=function(t,e,n,r){ze(this,t,e,n,r)},an.prototype.removeEventListener=function(t,e,n,r){Xe(this,t,e,n,r)},an.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Pb;var r=t.type||t;if(s(t))t=new Me(t,n);else if(t instanceof Me)t.target=t.target||n;else{var i=t;J(t=new Me(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=cn(a,r,!0,t)&&i}if(i=cn(a=t.b=n,r,!0,t)&&i,i=cn(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=cn(a=t.b=e[o],r,!1,t)&&i;return i},an.prototype.va=function(){if(an.qb.va.call(this),this.m){var t,e=this.m;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Be(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=dn.prototype).S=function(){mn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return mn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return yn(this.b,t)?this.b[t]:e},t.set=function(t,e){yn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var gn=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function vn(t,e){var n;this.b=this.i=this.f="",this.m=null,this.g=this.c="",this.h=!1,t instanceof vn?(this.h=void 0!==e?e:t.h,bn(this,t.f),this.i=t.i,this.b=t.b,wn(this,t.m),this.c=t.c,En(this,Vn(t.a)),this.g=t.g):t&&(n=String(t).match(gn))?(this.h=!!e,bn(this,n[1]||"",!0),this.i=Nn(n[2]||""),this.b=Nn(n[3]||"",!0),wn(this,n[4]),this.c=Nn(n[5]||"",!0),En(this,n[6]||"",!0),this.g=Nn(n[7]||"")):(this.h=!!e,this.a=new Ln(null,this.h))}function bn(t,e,n){t.f=n?Nn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function wn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function En(t,e,n){e instanceof Ln?(t.a=e,function(t,e){e&&!t.f&&(Mn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Un(this,e),Fn(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Cn(e,On)),t.a=new Ln(e,t.h))}function Tn(t,e,n){t.a.set(e,n)}function In(t,e){return t.a.get(e)}function Sn(t){return t instanceof vn?new vn(t):new vn(t,void 0)}function An(t,e){var n=new vn(null,void 0);return bn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Nn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Cn(t,e,n){return s(t)?(t=encodeURI(t).replace(e,_n),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function _n(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}vn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Cn(e,Dn,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(Cn(e,Dn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Cn(n,"/"==n.charAt(0)?Rn:kn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Cn(n,Pn)),t.join("")},vn.prototype.resolve=function(t){var e=new vn(this),n=!!t.f;n?bn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.m;var r=t.c;if(n)wn(e,t.m);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(vt(i,"./")||vt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?En(e,Vn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Dn=/[#\/\?@]/g,kn=/[#\?:]/g,Rn=/[#\?]/g,On=/[#\?@]/g,Pn=/#/g;function Ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Mn(t){t.a||(t.a=new dn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function xn(t){var e=pn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Ln(null,void 0);t=fn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Fn(n,i,o):n.add(i,o)}return n}function Un(t,e){Mn(t),e=Bn(t,e),yn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,yn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&mn(t)))}function qn(t,e){return Mn(t),e=Bn(t,e),yn(t.a.b,e)}function Fn(t,e,n){Un(t,e),0<n.length&&(t.c=null,t.a.set(Bn(t,e),Q(n)),t.b+=n.length)}function Vn(t){var e=new Ln;return e.c=t.c,t.a&&(e.a=new dn(t.a),e.b=t.b),e}function Bn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Ln.prototype).add=function(t,e){Mn(this),this.c=null,t=Bn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){Mn(this),this.a.forEach(function(n,r){F(n,function(n){t.call(e,n,r,this)},this)},this)},t.U=function(){Mn(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){Mn(this);var e=[];if(s(t))qn(this,t)&&(e=W(e,this.a.get(Bn(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},t.set=function(t,e){return Mn(this),this.c=null,qn(this,t=Bn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var jn=!be||9<=Number(_e);function Kn(t){var e=document;return s(t)?e.getElementById(t):t}function Gn(t,e){z(e,function(e,n){e&&"object"==typeof e&&e.na&&(e=e.ma()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:Wn.hasOwnProperty(n)?t.setAttribute(Wn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}var Wn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Qn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!jn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',qt(a.name),'"'),a.type){o.push(' type="',qt(a.type),'"');var u={};J(u,a),delete u.type,a=u}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(s(a)?o.className=a:d(a)?o.className=a.join(" "):Gn(o,a)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(s(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!m(o)||g(o)&&0<o.nodeType?r(o):F(zn(o)?Q(o):o,r)}}(i,o,r),o}function zn(t){if(t&&"number"==typeof t.length){if(g(t))return"function"==typeof t.item||"string"==typeof t.item;if(y(t))return"function"==typeof t.item}return!1}function Hn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),$n(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":$n(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Yn,t,e),e.join("")}function Yn(){}var Xn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Jn=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function $n(t,e){e.push('"',t.replace(Jn,function(t){var e=Xn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Xn[t]=e),e}),'"')}function Zn(){var t=vr();return be&&!!_e&&11==_e||/Edge\/\d+/.test(t)}function tr(){return a.window&&a.window.location.href||self&&self.location&&self.location.href||""}function er(t,e){e=e||a.window;var n="about:blank";t&&(n=Et(It(t)).toString()),e.location.href=n}function nr(t){return!!((t=(t||vr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function rr(t){t=t||a.window;try{t.close()}catch(t){}}function ir(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=vr().toLowerCase(),r&&(e.target=r,vt(n,"crios/")&&(e.target="_blank")),mr(vr())==pr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof wt?n:It(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Dt("iPhone")&&!Dt("iPod")&&!Dt("iPad")||Dt("iPad")||Dt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(U(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof wt||e instanceof wt||(e="object"==typeof e&&e.na?e.ma():String(e),Tt.test(e)||(e="about:invalid#zClosurez"),e=Nt(e)),a.href=Et(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=Et(e).toString(),a&&(Ee&&vt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Pt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+qt(t)+'">'),a.document.write(Rt(t)),a.document.close())):(a=r.open(Et(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var or=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ar=/^[^@]+@[^@]+$/;function sr(){var t=null;return new Wt(function(e){"complete"==a.document.readyState?e():(t=function(){e()},Ye(window,"load",t))}).s(function(e){throw Xe(window,"load",t),e})}function ur(t){return t=t||vr(),!("file:"!==Ir()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function cr(){var t=a.window;try{return!(!t||t==t.top)}catch(t){return!1}}function hr(){return void 0!==a.WorkerGlobalScope&&"function"==typeof a.importScripts}function lr(){return k.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":k.INTERNAL.hasOwnProperty("node")?"Node":hr()?"Worker":"Browser"}function fr(){var t=lr();return"ReactNative"===t||"Node"===t}var pr="Firefox",dr="Chrome";function mr(t){var e=t.toLowerCase();return vt(e,"opera/")||vt(e,"opr/")||vt(e,"opios/")?"Opera":vt(e,"iemobile")?"IEMobile":vt(e,"msie")||vt(e,"trident/")?"IE":vt(e,"edge/")?"Edge":vt(e,"firefox/")?pr:vt(e,"silk/")?"Silk":vt(e,"blackberry")?"Blackberry":vt(e,"webos")?"Webos":!vt(e,"safari/")||vt(e,"chrome/")||vt(e,"crios/")||vt(e,"android")?!vt(e,"chrome/")&&!vt(e,"crios/")||vt(e,"edge/")?vt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":dr:"Safari"}var yr={Sc:"FirebaseCore-web",Uc:"FirebaseUI-web"};function gr(t,e){e=e||[];var n,r=[],i={};for(n in yr)i[yr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=lr())?r=mr(i=vr()):"Worker"===r&&(r=mr(i=vr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function vr(){return a.navigator&&a.navigator.userAgent||""}function br(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function wr(){try{var t=a.localStorage,e=_r();if(t)return t.setItem(e,"1"),t.removeItem(e),!Zn()||!!a.indexedDB}catch(t){return hr()&&!!a.indexedDB}return!1}function Er(){return(Tr()||"chrome-extension:"===Ir()||ur())&&!fr()&&wr()&&!hr()}function Tr(){return"http:"===Ir()||"https:"===Ir()}function Ir(){return a.location&&a.location.protocol||null}function Sr(t){return!nr(t=t||vr())&&mr(t)!=pr}function Ar(t){return void 0===t?null:Hn(t)}function Nr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Cr(t){if(null!==t)return JSON.parse(t)}function _r(t){return t||Math.floor(1e9*Math.random()).toString()}function Dr(t){return"Safari"!=mr(t=t||vr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function kr(){var t=a.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Rr(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=vr(),e=lr(),this.b=nr(t)||"ReactNative"===e}function Or(){var t=a.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Pr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Lr(){return!(!br("fireauth.oauthhelper",a)&&!br("fireauth.iframe",a))}Rr.prototype.get=function(){var t=a.navigator;return!t||"boolean"!=typeof t.onLine||!Tr()&&"chrome-extension:"!==Ir()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Mr,xr={};function Ur(t){xr[t]||(xr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var qr={};Object.defineProperty(qr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(qr,"abcd",{configurable:!0,enumerable:!0,value:2}),Mr=2==qr.abcd}catch(ge){Mr=!1}function Fr(t,e,n){Mr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Vr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Fr(t,n,e[n])}function Br(t){var e={};return Vr(e,t),e}function jr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Fr(e,n,jr(t[n]));return e}function Kr(t){var e={},n=t[Wr],r=t[Qr];if(!(t=t[zr])||t!=Gr&&!n)throw Error("Invalid provider user info!");e[Yr]=r||null,e[Hr]=n||null,Fr(this,Jr,t),Fr(this,Xr,jr(e))}var Gr="EMAIL_SIGNIN",Wr="email",Qr="newEmail",zr="requestType",Hr="email",Yr="fromEmail",Xr="data",Jr="operation";function $r(t,e){this.code=ti+t,this.message=e||ei[t]||""}function Zr(t){var e=t&&t.code;return e?new $r(e.substring(ti.length),t.message):null}A($r,Error),$r.prototype.w=function(){return{code:this.code,message:this.message}},$r.prototype.toJSON=function(){return this.w()};var ti="auth/",ei={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function ni(t){var e=t[si];if(void 0===e)throw new $r("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new $r("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ri];if(n&&"object"==typeof n){e=n[hi];var r=n[ui];if(n=n[ci],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new $r("argument-error",ui+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new $r("argument-error",ci+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new $r("argument-error",hi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new $r("missing-android-pkg-name")}}else if(void 0!==n)throw new $r("argument-error",ri+" property must be a non null object when specified.");if(this.f=null,(e=t[ai])&&"object"==typeof e){if("string"==typeof(e=e[li])&&e.length)this.f=e;else if(void 0!==e)throw new $r("argument-error",li+" property must be a non empty string when specified.")}else if(void 0!==e)throw new $r("argument-error",ai+" property must be a non null object when specified.");if(void 0!==(e=t[oi])&&"boolean"!=typeof e)throw new $r("argument-error",oi+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[ii])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new $r("argument-error",ii+" property must be a non empty string when specified.");this.i=t||null}var ri="android",ii="dynamicLinkDomain",oi="handleCodeInApp",ai="iOS",si="url",ui="installApp",ci="minimumVersion",hi="packageName",li="bundleId";function fi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var pi=null,di=null;function mi(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=di[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!pi){pi={},di={};for(var t=0;65>t;t++)pi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),di[pi[t]]=t,62<=t&&(di["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function yi(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function gi(t){return(t=vi(t))&&t.sub&&t.iss&&t.aud&&t.exp?new yi(t):null}function vi(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(mi(t))}catch(t){}return null}yi.prototype.f=function(){return this.b};var bi,wi={Yc:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://securetoken.googleapis.com/v1/token",id:"p"},$c:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ad:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",jb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ei(t){for(var e in wi)if(wi[e].id===t)return{firebaseEndpoint:(t=wi[e]).bb,secureTokenEndpoint:t.jb};return null}bi=Ei("__EID__")?"__EID__":void 0;var Ti="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Ii=["client_id","response_type","scope","redirect_uri","state"],Si={Tc:{Oa:"locale",Ba:500,Aa:600,Pa:"facebook.com",ib:Ii},Vc:{Oa:null,Ba:500,Aa:620,Pa:"github.com",ib:Ii},Wc:{Oa:"hl",Ba:515,Aa:680,Pa:"google.com",ib:Ii},bd:{Oa:"lang",Ba:485,Aa:705,Pa:"twitter.com",ib:Ti}};function Ai(t){for(var e in Si)if(Si[e].Pa==t)return Si[e];return null}function Ni(t){var e={};e["facebook.com"]=Ri,e["google.com"]=Pi,e["github.com"]=Oi,e["twitter.com"]=Li;var n=t&&t[_i];try{if(n)return e[n]?new e[n](t):new ki(t);if(void 0!==t[Ci])return new Di(t)}catch(t){}return null}var Ci="idToken",_i="providerId";function Di(t){var e=t[_i];if(!e&&t[Ci]){var n=gi(t[Ci]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Fr(this,"providerId",e),Fr(this,"isNewUser",n)}function ki(t){Di.call(this,t),Fr(this,"profile",jr((t=Cr(t.rawUserInfo||"{}"))||{}))}function Ri(t){if(ki.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Oi(t){if(ki.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Fr(this,"username",this.profile&&this.profile.login||null)}function Pi(t){if(ki.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Li(t){if(ki.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Fr(this,"username",t.screenName||null)}function Mi(t){this.a=Sn(t)}function xi(t){var e=Sn(t),n=In(e,"link"),r=In(Sn(n),"link");return e=In(e,"deep_link_id"),In(Sn(e),"link")||e||r||n||t}function Ui(){}function qi(t,e){return t.then(function(t){if(t[Na]){var n=gi(t[Na]);if(!n||e!=n.c)throw new $r("user-mismatch");return t}throw new $r("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==ti+"user-not-found"?new $r("user-mismatch"):t})}function Fi(t,e){if(!e)throw new $r("internal-error","failed to construct a credential");this.a=e,Fr(this,"providerId",t),Fr(this,"signInMethod",t)}function Vi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Bi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Fi(t.providerId,t.pendingToken)}catch(t){}return null}function ji(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Fr(this,"idToken",e.idToken),e.accessToken&&Fr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Fr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new $r("internal-error","failed to construct a credential");Fr(this,"accessToken",e.oauthToken),Fr(this,"secret",e.oauthTokenSecret)}Fr(this,"providerId",t),Fr(this,"signInMethod",n)}function Ki(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:xn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Gi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new ji(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Wi(t,e){this.Cc=e||[],Vr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(Ai(t)||{}).Oa||null,this.ab=null}function Qi(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new $r("argument-error",'SAML provider IDs must be prefixed with "saml."');Wi.call(this,t,[])}function zi(t){Wi.call(this,t,Ii),this.a=[]}function Hi(){zi.call(this,"facebook.com")}function Yi(t){if(!t)throw new $r("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Hi).credential({accessToken:e})}function Xi(){zi.call(this,"github.com")}function Ji(t){if(!t)throw new $r("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Xi).credential({accessToken:e})}function $i(){zi.call(this,"google.com"),this.ua("profile")}function Zi(t,e){var n=t;return g(t)&&(n=t.idToken,e=t.accessToken),(new $i).credential({idToken:n,accessToken:e})}function to(){Wi.call(this,"twitter.com",Ti)}function eo(t,e){var n=t;if(g(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new $r("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new ji("twitter.com",n,"twitter.com")}function no(t,e,n){this.a=t,this.c=e,Fr(this,"providerId","password"),Fr(this,"signInMethod",n===io.EMAIL_LINK_SIGN_IN_METHOD?io.EMAIL_LINK_SIGN_IN_METHOD:io.EMAIL_PASSWORD_SIGN_IN_METHOD)}function ro(t){return t&&t.email&&t.password?new no(t.email,t.password,t.signInMethod):null}function io(){Vr(this,{providerId:"password",isOAuthProvider:!1})}function oo(t,e){if(!(e=ao(e)))throw new $r("argument-error","Invalid email link!");return new no(t,e,io.EMAIL_LINK_SIGN_IN_METHOD)}function ao(t){var e=In((t=new Mi(t=xi(t))).a,"oobCode")||null;return"signIn"===(In(t.a,"mode")||null)&&e?e:null}function so(t){if(!(t.Ua&&t.Ta||t.Fa&&t.$))throw new $r("internal-error");this.a=t,Fr(this,"providerId","phone"),Fr(this,"signInMethod","phone")}function uo(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return F(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(n){t[n]&&(e[n]=t[n])}),new so(e)}return null}function co(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function ho(t){try{this.a=t||k.auth()}catch(t){throw new $r("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Vr(this,{providerId:"phone",isOAuthProvider:!1})}function lo(t,e){if(!t)throw new $r("missing-verification-id");if(!e)throw new $r("missing-verification-code");return new so({Ua:t,Ta:e})}function fo(t){if(t.temporaryProof&&t.phoneNumber)return new so({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return Zi(o,n);case"facebook.com":return Yi(n);case"github.com":return Ji(n);case"twitter.com":return eo(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Fi(e,a):new ji(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new zi(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function po(t){if(!t.isOAuthProvider)throw new $r("invalid-oauth-provider")}function mo(t,e,n,r,i,o){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new $r("invalid-auth-event");if(this.g&&this.a)throw new $r("invalid-auth-event");if(this.g&&!this.f)throw new $r("invalid-auth-event")}function yo(t){return(t=t||{}).type?new mo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Zr(t.error),t.postBody):null}function go(){this.b=null,this.a=[]}A(ki,Di),A(Ri,ki),A(Oi,ki),A(Pi,ki),A(Li,ki),Fi.prototype.la=function(t){return Ga(t,Vi(this))},Fi.prototype.b=function(t,e){var n=Vi(this);return n.idToken=e,Wa(t,n)},Fi.prototype.f=function(t,e){return qi(Qa(t,Vi(this)),e)},Fi.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},ji.prototype.la=function(t){return Ga(t,Ki(this))},ji.prototype.b=function(t,e){var n=Ki(this);return n.idToken=e,Wa(t,n)},ji.prototype.f=function(t,e){return qi(Qa(t,Ki(this)),e)},ji.prototype.w=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Wi.prototype.Da=function(t){return this.zb=Y(t),this},A(Qi,Wi),A(zi,Wi),zi.prototype.ua=function(t){return j(this.a,t)||this.a.push(t),this},zi.prototype.Fb=function(){return Q(this.a)},zi.prototype.credential=function(t,e){var n;if(!(n=g(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new $r("argument-error","credential failed: must provide the ID token and/or the access token.");return new ji(this.providerId,n,this.providerId)},A(Hi,zi),Fr(Hi,"PROVIDER_ID","facebook.com"),Fr(Hi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),A(Xi,zi),Fr(Xi,"PROVIDER_ID","github.com"),Fr(Xi,"GITHUB_SIGN_IN_METHOD","github.com"),A($i,zi),Fr($i,"PROVIDER_ID","google.com"),Fr($i,"GOOGLE_SIGN_IN_METHOD","google.com"),A(to,Wi),Fr(to,"PROVIDER_ID","twitter.com"),Fr(to,"TWITTER_SIGN_IN_METHOD","twitter.com"),no.prototype.la=function(t){return this.signInMethod==io.EMAIL_LINK_SIGN_IN_METHOD?Es(t,ts,{email:this.a,oobCode:this.c}):Es(t,gs,{email:this.a,password:this.c})},no.prototype.b=function(t,e){return this.signInMethod==io.EMAIL_LINK_SIGN_IN_METHOD?Es(t,es,{idToken:e,email:this.a,oobCode:this.c}):Es(t,ls,{idToken:e,email:this.a,password:this.c})},no.prototype.f=function(t,e){return qi(this.la(t),e)},no.prototype.w=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Vr(io,{PROVIDER_ID:"password"}),Vr(io,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Vr(io,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),so.prototype.la=function(t){return t.Va(co(this))},so.prototype.b=function(t,e){var n=co(this);return n.idToken=e,Es(t,bs,n)},so.prototype.f=function(t,e){var n=co(this);return n.operation="REAUTH",qi(t=Es(t,ws,n),e)},so.prototype.w=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},ho.prototype.Va=function(t,e){var n=this.a.c;return $t(e.verify()).then(function(r){if(!s(r))throw new $r("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return Es(t,cs,e)}(n,{phoneNumber:t,recaptchaToken:r}).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new $r("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Vr(ho,{PROVIDER_ID:"phone"}),Vr(ho,{PHONE_SIGN_IN_METHOD:"phone"}),mo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.i&&t.push(this.i),t.join("-")},mo.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.h,error:this.a&&this.a.w()}};var vo,bo=null;function wo(t){var e="unauthorized-domain",n=void 0,r=Sn(t);t=r.b,"chrome-extension"==(r=r.f)?n=Ut("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=Ut("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",$r.call(this,e,n)}function Eo(t,e,n){$r.call(this,t,n),(t=e||{}).Ab&&Fr(this,"email",t.Ab),t.$&&Fr(this,"phoneNumber",t.$),t.credential&&Fr(this,"credential",t.credential)}function To(t){if(t.code){var e=t.code||"";0==e.indexOf(ti)&&(e=e.substring(ti.length));var n={credential:fo(t)};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new $r(e,t.message||void 0);return new Eo(e,n,t.message)}return null}function Io(){}function So(t){return t.c||(t.c=t.b())}function Ao(){}function No(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function Co(){}function _o(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=T(this.cc,this),this.a.onerror=T(this.Gb,this),this.a.onprogress=T(this.dc,this),this.a.ontimeout=T(this.hc,this)}function Do(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function ko(t,e,n){this.reset(t,e,n,void 0,void 0)}function Ro(t){this.f=t,this.b=this.c=this.a=null}function Oo(t,e){this.name=t,this.value=e}go.prototype.subscribe=function(t){var e=this;this.a.push(t),this.b||(this.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=br("universalLinks.subscribe",a))&&t(null,this.b))},go.prototype.unsubscribe=function(t){G(this.a,function(e){return e==t})},A(wo,$r),A(Eo,$r),Eo.prototype.w=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.w();return e&&J(t,e),t},Eo.prototype.toJSON=function(){return this.w()},Io.prototype.c=null,A(Ao,Io),Ao.prototype.a=function(){var t=No(this);return t?new ActiveXObject(t):new XMLHttpRequest},Ao.prototype.b=function(){var t={};return No(this)&&(t[0]=!0,t[1]=!0),t},vo=new Ao,A(Co,Io),Co.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new _o;throw Error("Unsupported browser")},Co.prototype.b=function(){return{}},(t=_o.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.cc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Do(this,4)},t.Gb=function(){this.status=500,this.response=this.responseText="",Do(this,4)},t.hc=function(){this.Gb()},t.dc=function(){this.status=200,Do(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},ko.prototype.a=null,ko.prototype.reset=function(t,e,n,r,i){delete this.a},Oo.prototype.toString=function(){return this.name};var Po=new Oo("SEVERE",1e3),Lo=new Oo("WARNING",900),Mo=new Oo("CONFIG",700),xo=new Oo("FINE",500);Ro.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(D("Root logger has no level set."),null)}(this).value)for(y(e)&&(e=e()),t=new ko(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var Uo={},qo=null;function Fo(t){var e;if(qo||(qo=new Ro(""),Uo[""]=qo,qo.c=Mo),!(e=Uo[t])){e=new Ro(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Fo(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,Uo[t]=e}return e}function Vo(t,e){t&&t.log(xo,e,void 0)}function Bo(t){this.f=t}function jo(t){an.call(this),this.u=t,this.readyState=Ko,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.o="GET",this.g="",this.a=!1,this.h=Fo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}A(Bo,Io),Bo.prototype.a=function(){return new jo(this.f)},Bo.prototype.b=function(t){return function(){return t}}({}),A(jo,an);var Ko=0;function Go(t){t.c.read().then(t.bc.bind(t)).catch(t.Ma.bind(t))}function Wo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,Qo(t)}function Qo(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function zo(t){an.call(this),this.headers=new dn,this.D=t||null,this.c=!1,this.A=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.o=Ho,this.v=this.O=!1}(t=jo.prototype).open=function(t,e){if(this.readyState!=Ko)throw this.abort(),Error("Error reopening a connection");this.o=t,this.g=e,this.readyState=1,Qo(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.o,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.gc.bind(this),this.Ma.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Wo(this,!1)),this.readyState=Ko},t.gc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,Qo(this)),this.a&&(this.readyState=3,Qo(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.ec.bind(this),this.Ma.bind(this)):void 0!==a.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Go(this)):t.text().then(this.fc.bind(this),this.Ma.bind(this)))))},t.bc=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Wo(this,!0):Qo(this),3==this.readyState&&Go(this)}},t.fc=function(t){this.a&&(this.response=this.responseText=t,Wo(this,!0))},t.ec=function(t){this.a&&(this.response=t,Wo(this,!0))},t.Ma=function(t){var e=this.h;e&&e.log(Lo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Wo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Lo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Lo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},A(zo,an);var Ho="";zo.prototype.b=Fo("goog.net.XhrIo");var Yo=/^https?$/i,Xo=["POST","PUT"];function Jo(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.N=n,t.G=!1,t.c=!0,t.a=t.D?t.D.a():vo.a(),t.A=t.D?So(t.D):So(vo),t.a.onreadystatechange=T(t.Jb,t);try{Vo(t.b,aa(t,"Opening Xhr")),t.I=!0,t.a.open(n,String(e),!0),t.I=!1}catch(e){return Vo(t.b,aa(t,"Error opening Xhr: "+e.message)),void Zo(t,e)}e=r||"";var o=new dn(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(m(t)||s(t))F(t,e,void 0);else for(var n=pn(t),r=fn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=$o,n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:s(t)?t.charAt(e):t[e]}(o.U()),r=a.FormData&&e instanceof a.FormData,!j(Xo,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.o&&(t.a.responseType=t.o),"withCredentials"in t.a&&t.a.withCredentials!==t.O&&(t.a.withCredentials=t.O);try{ra(t),0<t.g&&(t.v=function(t){return be&&ke(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),Vo(t.b,aa(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=T(t.Ga,t)):t.u=hn(t.Ga,t.g,t)),Vo(t.b,aa(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){Vo(t.b,aa(t,"Send error: "+e.message)),Zo(t,e)}}function $o(t){return"content-type"==t.toLowerCase()}function Zo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,ta(t),na(t)}function ta(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function ea(t){if(t.c&&void 0!==o)if(t.A[1]&&4==ia(t)&&2==oa(t))Vo(t.b,aa(t,"Local request error detected and ignored"));else if(t.i&&4==ia(t))hn(t.Jb,0,t);else if(t.dispatchEvent("readystatechange"),4==ia(t)){Vo(t.b,aa(t,"Request complete")),t.c=!1;try{var e,n=oa(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.l).match(gn)[1]||null;if(!s&&a.self&&a.self.location){var u=a.self.location.protocol;s=u.substr(0,u.length-1)}i=!Yo.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<ia(t)?t.a.statusText:""}catch(e){Vo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+oa(t)+"]",ta(t)}}finally{na(t)}}}function na(t,e){if(t.a){ra(t);var n=t.a,r=t.A[0]?l:null;t.a=null,t.A=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(Po,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function ra(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(a.clearTimeout(t.u),t.u=null)}function ia(t){return t.a?t.a.readyState:0}function oa(t){try{return 2<ia(t)?t.a.status:-1}catch(t){return-1}}function aa(t,e){return e+" ["+t.N+" "+t.l+" "+oa(t)+"]"}function sa(t){var e=va;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.A=this.i=!1,this.h=0,this.b=null,this.m=0}function ua(t,e,n){t.a=!0,t.c=n,t.f=!e,fa(t)}function ca(t){if(t.a){if(!t.l)throw new pa(t);t.l=!1}}function ha(t,e,n,r){t.g.push([e,n,r]),t.a&&fa(t)}function la(t){return B(t.g,function(t){return y(t[1])})}function fa(t){if(t.h&&t.a&&la(t)){var e=t.h,n=ya[e];n&&(a.clearTimeout(n.a),delete ya[e]),t.h=0}t.b&&(t.b.m--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],s=i[1];if(i=i[2],o=t.f?s:o)try{var u=o.call(i||t.u,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(N(e)||"function"==typeof a.Promise&&e instanceof a.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,la(t)||(n=!0)}}t.c=e,r&&(u=T(t.o,t,!0),r=T(t.o,t,!1),e instanceof sa?(ha(e,u,r),e.A=!0):e.then(u,r)),n&&(e=new ma(e),ya[e.a]=e,t.h=e.a)}function pa(){C.call(this)}function da(){C.call(this)}function ma(t){this.a=a.setTimeout(T(this.c,this),0),this.b=t}(t=zo.prototype).Ga=function(){void 0!==o&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Vo(this.b,aa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Vo(this.b,aa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),na(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),na(this,!0)),zo.qb.va.call(this)},t.Jb=function(){this.qa||(this.I||this.i||this.f?ea(this):this.vc())},t.vc=function(){ea(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.o){case Ho:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Po,"Response type "+this.o+" is not supported on this browser",void 0),null}catch(t){return Vo(this.b,"Can not get response: "+t.message),null}},sa.prototype.cancel=function(t){if(this.a)this.c instanceof sa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.m--,0>=e.m&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new da(this),ca(this),ua(this,!1,t))}},sa.prototype.o=function(t,e){this.i=!1,ua(this,t,e)},sa.prototype.then=function(t,e,n){var r,i,o=new Wt(function(t,e){r=t,i=e});return ha(this,r,function(t){t instanceof da?o.cancel():i(t)}),o.then(t,e,n)},sa.prototype.$goog_Thenable=!0,A(pa,C),pa.prototype.message="Deferred has already fired",pa.prototype.name="AlreadyCalledError",A(da,C),da.prototype.message="Deferred was canceled",da.prototype.name="CanceledError",ma.prototype.c=function(){throw delete ya[this.a],this.b};var ya={};function ga(t){var e,n=document,r=it(t).toString(),i=document.createElement("SCRIPT"),o={Lb:i,Ga:void 0},s=new sa(o);return e=window.setTimeout(function(){ba(i,!0);var t=new Ta(Ea,"Timeout reached for loading script "+r);ca(s),ua(s,!1,t)},5e3),o.Ga=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(ba(i,!1,e),ca(s),ua(s,!0,null))},i.onerror=function(){ba(i,!0,e);var t=new Ta(wa,"Error while loading script "+r);ca(s),ua(s,!1,t)},J(o={},{type:"text/javascript",charset:"UTF-8"}),Gn(i,o),function(t,e){U(t,"HTMLScriptElement"),t.src=it(e),null===h&&(h=(e=(e=a.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&c.test(e)?e:""),(e=h)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function va(){if(this&&this.Lb){var t=this.Lb;t&&"SCRIPT"==t.tagName&&ba(t,!0,this.Ga)}}function ba(t,e,n){null!=n&&a.clearTimeout(n),t.onload=l,t.onerror=l,t.onreadystatechange=l,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var wa=0,Ea=1;function Ta(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function Ia(t){this.f=t}function Sa(t,e,n){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=t.secureTokenTimeout||Ca,this.f=Y(t.secureTokenHeaders||_a),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||Da,this.a=Y(t.firebaseHeaders||ka),n&&(this.a["X-Client-Version"]=n,this.f["X-Client-Version"]=n),n="Node"==lr(),!(n=a.XMLHttpRequest||n&&k.INTERNAL.node&&k.INTERNAL.node.XMLHttpRequest)&&!hr())throw new $r("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,hr()?this.c=new Bo(self):fr()?this.c=new Ia(n):this.c=new Co}A(Ta,C),A(Ia,Io),Ia.prototype.a=function(){return new this.f},Ia.prototype.b=function(){return{}};var Aa,Na="idToken",Ca=new Rr(3e4,6e4),_a={"Content-Type":"application/x-www-form-urlencoded"},Da=new Rr(3e4,6e4),ka={"Content-Type":"application/json"};function Ra(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Oa(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function Pa(t,e,n,r,i,o,s){(function(){var t=vr();return!((t=mr(t)!=dr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||be&&_e&&!(9<_e))})()||hr()?t=T(t.o,t):(Aa||(Aa=new Wt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{a[Ma]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var n=ot(La,{onload:Ma});!function(t,e){ha(t,null,e,void 0)}(ga(n),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)})),t=T(t.l,t)),t(e,n,r,i,o,s)}Sa.prototype.o=function(t,e,n,r,i,o){if(hr()&&(void 0===a.fetch||void 0===a.Headers||void 0===a.Request))throw new $r("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var s=new zo(this.c);if(o){s.g=Math.max(0,o);var u=setTimeout(function(){s.dispatchEvent("timeout")},o)}sn(s,"complete",function(){u&&clearTimeout(u);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return Vo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)}),un(s,"ready",function(){u&&clearTimeout(u),de(this)}),un(s,"timeout",function(){u&&clearTimeout(u),de(this),e&&e(null)}),Jo(s,t,n,r,i)};var La=new $(et,"https://apis.google.com/js/client.js?onload=%{onload}"),Ma="__fcb"+Math.floor(1e6*Math.random()).toString();function xa(t){if(!s(t=t.email)||!ar.test(t))throw new $r("invalid-email")}function Ua(t){"email"in t&&xa(t)}function qa(t){if(!t[Na])throw new $r("internal-error")}function Fa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new $r("internal-error")}else{if(!t.sessionInfo)throw new $r("missing-verification-id");if(!t.code)throw new $r("missing-verification-code")}}Sa.prototype.l=function(t,e,n,r,i){var o=this;Aa.then(function(){window.gapi.client.setApiKey(o.b);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Sa.prototype.ob=function(){return Es(this,fs,{})},Sa.prototype.rb=function(t,e){return Es(this,hs,{idToken:t,email:e})},Sa.prototype.sb=function(t,e){return Es(this,ls,{idToken:t,password:e})};var Va={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ba(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new $r("internal-error")}function ja(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(qn(t=new Ln(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ka(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=To(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=To(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=To(t)):t.errorMessage&&(e=Ts(t.errorMessage)),e)throw e;if(!t[Na])throw new $r("internal-error")}function Ga(t,e){return e.returnIdpCredential=!0,Es(t,ps,e)}function Wa(t,e){return e.returnIdpCredential=!0,Es(t,ms,e)}function Qa(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Es(t,ds,e)}function za(t){if(!t.oobCode)throw new $r("invalid-action-code")}(t=Sa.prototype).tb=function(t,e){var n={idToken:t},r=[];return z(Va,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),Es(this,hs,n)},t.lb=function(t,e){return J(t={requestType:"PASSWORD_RESET",email:t},e),Es(this,os,t)},t.mb=function(t,e){return J(t={requestType:"EMAIL_SIGNIN",email:t},e),Es(this,rs,t)},t.kb=function(t,e){return J(t={requestType:"VERIFY_EMAIL",idToken:t},e),Es(this,is,t)},t.Va=function(t){return Es(this,vs,t)},t.$a=function(t,e){return Es(this,us,{oobCode:t,newPassword:e})},t.Ka=function(t){return Es(this,Ya,{oobCode:t})},t.Xa=function(t){return Es(this,Ha,{oobCode:t})};var Ha={endpoint:"setAccountInfo",C:za,da:"email"},Ya={endpoint:"resetPassword",C:za,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new $r("internal-error")}},Xa={endpoint:"signupNewUser",C:function(t){if(xa(t),!t.password)throw new $r("weak-password")},J:qa,R:!0},Ja={endpoint:"createAuthUri"},$a={endpoint:"deleteAccount",T:["idToken"]},Za={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],C:function(t){if(!d(t.deleteProvider))throw new $r("internal-error")}},ts={endpoint:"emailLinkSignin",T:["email","oobCode"],C:xa,J:qa,R:!0},es={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],C:xa,J:qa,R:!0},ns={endpoint:"getAccountInfo"},rs={endpoint:"getOobConfirmationCode",T:["requestType"],C:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new $r("internal-error");xa(t)},da:"email"},is={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],C:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new $r("internal-error")},da:"email"},os={endpoint:"getOobConfirmationCode",T:["requestType"],C:function(t){if("PASSWORD_RESET"!=t.requestType)throw new $r("internal-error");xa(t)},da:"email"},as={wb:!0,endpoint:"getProjectConfig",Ib:"GET"},ss={wb:!0,endpoint:"getRecaptchaParam",Ib:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new $r("internal-error")}},us={endpoint:"resetPassword",C:za,da:"email"},cs={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},hs={endpoint:"setAccountInfo",T:["idToken"],C:Ua,R:!0},ls={endpoint:"setAccountInfo",T:["idToken"],C:function(t){if(Ua(t),!t.password)throw new $r("weak-password")},J:qa,R:!0},fs={endpoint:"signupNewUser",J:qa,R:!0},ps={endpoint:"verifyAssertion",C:Ba,Qa:ja,J:Ka,R:!0},ds={endpoint:"verifyAssertion",C:Ba,Qa:ja,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new $r("user-not-found");if(t.errorMessage)throw Ts(t.errorMessage);if(!t[Na])throw new $r("internal-error")},R:!0},ms={endpoint:"verifyAssertion",C:function(t){if(Ba(t),!t.idToken)throw new $r("internal-error")},Qa:ja,J:Ka,R:!0},ys={endpoint:"verifyCustomToken",C:function(t){if(!t.token)throw new $r("invalid-custom-token")},J:qa,R:!0},gs={endpoint:"verifyPassword",C:function(t){if(xa(t),!t.password)throw new $r("wrong-password")},J:qa,R:!0},vs={endpoint:"verifyPhoneNumber",C:Fa,J:qa},bs={endpoint:"verifyPhoneNumber",C:function(t){if(!t.idToken)throw new $r("internal-error");Fa(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",To(t);qa(t)}},ws={Vb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",C:Fa,J:qa};function Es(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Zt(new $r("internal-error"));var r,i=e.Ib||"POST";return $t(n).then(e.C).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,n,r,i,o){var a=Sn(t.g+e);Tn(a,"key",t.b),o&&Tn(a,"cb",S().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&Tn(a,u,r[u]);return new Wt(function(e,o){Pa(t,a.toString(),function(t){t?t.error?o(Is(t,i||{})):e(t):o(new $r("network-request-failed"))},n,s?void 0:Hn(Nr(r)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Vb,e.wb||!1)}).then(function(t){return r=t,e.Qa?e.Qa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new $r("internal-error");return r[e.da]})}function Ts(t){return Is({error:{errors:[{message:t}],code:400,message:t}})}function Is(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new $r(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",J(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new $r(r[i],e);return!e&&t&&(e=Ar(t)),new $r("internal-error",e)}function Ss(t){this.b=t,this.a=null,this.gb=function(t){return(_s||(_s=new Wt(function(t,e){function n(){kr(),br("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){kr(),e(Error("Network Error"))},timeout:Ns.get()})}if(br("gapi.iframes.Iframe"))t();else if(br("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();a[r]=function(){br("gapi.load")?n():e(Error("Network Error"))},$t(ga(r=ot(As,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw _s=null,t}))).then(function(){return new Wt(function(e,n){br("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:br("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},Cs.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})})}(this)}var As=new $(et,"https://apis.google.com/js/api.js?onload=%{onload}"),Ns=new Rr(3e4,6e4),Cs=new Rr(5e3,15e3),_s=null;function Ds(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=An(this.i,"/__/auth/iframe"),Tn(this.a,"apiKey",this.g),Tn(this.a,"appName",this.h),this.b=null,this.c=[]}function ks(t,e,n,r,i){this.o=t,this.l=e,this.c=n,this.m=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function Rs(t){try{return k.app(t).auth().ya()}catch(t){return[]}}function Os(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.o=this.u=this.v=null,this.g=[],this.m=this.a=null}function Ps(t){var e=tr();return function(t){return Es(t,as,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=Sn(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(0==o.indexOf("chrome-extension://")?a=Sn(o).b==a&&"chrome-extension"==s:"http"!=s&&"https"!=s?a=!1:or.test(o)?a=a==o:(o=o.split(".").join("\\."),a=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)),a){t=!0;break t}}t=!1}if(!t)throw new wo(tr())})}function Ls(t){return t.m?t.m:(t.m=sr().then(function(){if(!t.u){var e=t.c,n=t.h,r=Rs(t.b),i=new Ds(t.l,t.f,t.b);i.f=e,i.b=n,i.c=Q(r||[]),t.u=i.toString()}t.i=new Ss(t.u),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then(function(){t.a.register("authEvent",e,br("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.i,function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=yo(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",$t(n)}return n.status="ERROR",$t(n)})}(t)}),t.m)}function Ms(t){return t.o||(t.v=t.c?gr(t.c,Rs(t.b)):null,t.o=new Sa(t.f,Ei(t.h),t.v)),t.o}function xs(t,e,n,r,i,o,a,s,u,c){return(t=new ks(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=Y(u||null),t.f=c,t.toString()}function Us(t){if(this.a=t||k.INTERNAL.reactNative&&k.INTERNAL.reactNative.AsyncStorage,!this.a)throw new $r("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function qs(t){this.b=t,this.a={},this.c=T(this.f,this)}Ds.prototype.toString=function(){return this.f?Tn(this.a,"v",this.f):Un(this.a.a,"v"),this.b?Tn(this.a,"eid",this.b):Un(this.a.a,"eid"),this.c.length?Tn(this.a,"fw",this.c.join(",")):Un(this.a.a,"fw"),this.a.toString()},ks.prototype.toString=function(){var t=An(this.o,"/__/auth/handler");if(Tn(t,"apiKey",this.l),Tn(t,"appName",this.c),Tn(t,"authType",this.m),this.a.isOAuthProvider){var e=this.a;try{var n=k.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.ab=n,Tn(t,"providerId",this.a.providerId),n=Nr((e=this.a).zb))n[r]=n[r].toString();r=e.Cc,n=Y(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.ab&&!n[e.eb]&&(n[e.eb]=e.ab),H(n)||Tn(t,"customParameters",Ar(n))}if("function"==typeof this.a.Fb&&((e=this.a.Fb()).length&&Tn(t,"scopes",e.join(","))),this.i?Tn(t,"redirectUrl",this.i):Un(t.a,"redirectUrl"),this.g?Tn(t,"eventId",this.g):Un(t.a,"eventId"),this.h?Tn(t,"v",this.h):Un(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!In(t,a)&&Tn(t,a,this.b[a]);return this.f?Tn(t,"eid",this.f):Un(t.a,"eid"),(a=Rs(this.c)).length&&Tn(t,"fw",a.join(",")),t.toString()},(t=Os.prototype).Ea=function(t,e,n){var r=new $r("popup-closed-by-user"),i=new $r("web-storage-unsupported"),o=this,a=!1;return this.ga().then(function(){(function(t){var e={type:"webStorageSupport"};return Ls(t).then(function(){return function(t,e){return t.gb.then(function(){return new Wt(function(n){t.a.send(e.type,e,n,br("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&rr(t),e(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(t){return new Wt(function(e){return function n(){ln(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!a)return ln(n).then(function(){e(r)})})},t.Mb=function(){var t=vr();return!Sr(t)&&!Dr(t)},t.Hb=function(){return!1},t.Db=function(t,e,n,r,i,o,a){if(!t)return Zt(new $r("popup-blocked"));if(a&&!Sr())return this.ga().s(function(e){rr(t),i(e)}),r(),$t();this.a||(this.a=Ps(Ms(this)));var s=this;return this.a.then(function(){var e=s.ga().s(function(e){throw rr(t),i(e),e});return r(),e}).then(function(){(po(n),a)||er(xs(s.l,s.f,s.b,e,n,null,o,s.c,void 0,s.h),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ca=function(t,e,n){this.a||(this.a=Ps(Ms(this)));var r=this;return this.a.then(function(){po(e),er(xs(r.l,r.f,r.b,t,e,tr(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ga=function(){var t=this;return Ls(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new $r("network-request-failed")})},t.Ob=function(){return!0},t.wa=function(t){this.g.push(t)},t.La=function(t){G(this.g,function(e){return e==t})},(t=Us.prototype).get=function(t){return $t(this.a.getItem(t)).then(function(t){return t&&Cr(t)})},t.set=function(t,e){return $t(this.a.setItem(t,Ar(e)))},t.P=function(t){return $t(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var Fs,Vs=[];function Bs(t){this.a=t}function js(t){this.c=t,this.b=!1,this.a=[]}function Ks(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Zt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new Wt(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return Gs(t,c),e}).s(function(e){throw Gs(t,c),e})}function Gs(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),G(t.a,function(t){return t==e})}}function Ws(){if(!Hs())throw new $r("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=a.indexedDB,this.type="indexedDB",this.g=this.m=this.f=this.i=null,this.u=!1,this.h=null;var t=this;hr()&&self?(this.m=function(){var t=hr()?self:null;if(F(Vs,function(n){n.b==t&&(e=n)}),!e){var e=new qs(t);Vs.push(e)}return e}(),this.m.subscribe("keyChanged",function(e,n){return Zs(t).then(function(e){return 0<e.length&&F(t.a,function(t){t(e)}),{keyProcessed:j(e,n.key)}})}),this.m.subscribe("ping",function(){return $t(["keyChanged"])})):function(){var t=a.navigator;return t&&t.serviceWorker?$t().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):$t(null)}().then(function(e){(t.h=e)&&(t.g=new js(new Bs(e)),Ks(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&j(e[0].value,"keyChanged")&&(t.u=!0)}).s(function(){}))})}function Qs(t){return new Wt(function(e,n){var r=t.l.open("firebaseLocalStorageDb",1);r.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},r.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(r):function(t){return new Wt(function(e,n){var r=t.l.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}})}(t).then(function(){return Qs(t)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function zs(t){return t.o||(t.o=Qs(t)),t.o}function Hs(){try{return!!a.indexedDB}catch(t){return!1}}function Ys(t){return t.objectStore("firebaseLocalStorage")}function Xs(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function Js(t){return new Wt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function $s(t,e){return t.g&&t.h&&function(){var t=a.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Ks(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):$t()}function Zs(t){return zs(t).then(function(t){var e=Ys(Xs(t,!1));return e.getAll?Js(e.getAll()):new Wt(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function tu(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function eu(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=$t().then(function(){if(Hs()){var t=_r(),r="__sak"+t;return Fs||(Fs=new Ws),(n=Fs).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.P(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.Y(function(t){F(e.a,function(e){e(t)})}),t})}function nu(){this.a={},this.type="inMemory"}function ru(){if(!function(){var t="Node"==lr();if(!(t=iu()||t&&k.INTERNAL.node&&k.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==lr())throw new $r("internal-error","The LocalStorage compatibility library was not found.");throw new $r("web-storage-unsupported")}this.a=iu()||k.INTERNAL.node.localStorage,this.type="localStorage"}function iu(){try{var t=a.localStorage,e=_r();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function ou(){this.type="nullStorage"}function au(){if(!function(){var t="Node"==lr();if(!(t=su()||t&&k.INTERNAL.node&&k.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==lr())throw new $r("internal-error","The SessionStorage compatibility library was not found.");throw new $r("web-storage-unsupported")}this.a=su()||k.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function su(){try{var t=a.sessionStorage,e=_r();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function uu(){var t={};t.Browser=lu,t.Node=fu,t.ReactNative=pu,t.Worker=du,this.a=t[lr()]}qs.prototype.f=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];F(r,function(e){i.push($t().then(function(){return e(t.origin,t.data.data)}))}),ee(i).then(function(r){var i=[];F(r,function(t){i.push({fulfilled:t.Eb,value:t.value,reason:t.reason?t.reason.message:void 0})}),F(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},qs.prototype.subscribe=function(t,e){H(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},qs.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(G(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],H(this.a)&&this.b.removeEventListener("message",this.c)},Bs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},js.prototype.close=function(){for(;0<this.a.length;)Gs(this,this.a[0]);this.b=!0},(t=Ws.prototype).set=function(t,e){var n,r=!1,i=this;return zs(this).then(function(e){return Js((e=Ys(Xs(n=e,!0))).get(t))}).then(function(o){var a=Ys(Xs(n,!0));return o?(o.value=e,Js(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,Js(a.add(o)))}).then(function(){return i.c[t]=e,$s(i,t)}).ia(function(){r&&i.b--})},t.get=function(t){return zs(this).then(function(e){return Js(Ys(Xs(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.P=function(t){var e=!1,n=this;return zs(this).then(function(r){return e=!0,n.b++,Js(Ys(Xs(r,!0)).delete(t))}).then(function(){return delete n.c[t],$s(n,t)}).ia(function(){e&&n.b--})},t.Y=function(t){0==this.a.length&&function(t){tu(t),function e(){t.f=setTimeout(function(){t.i=Zs(t).then(function(e){0<e.length&&F(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ca=function(t){G(this.a,function(e){return e==t}),0==this.a.length&&tu(this)},(t=eu.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.P=function(t){return this.b.then(function(e){return e.P(t)})},t.Y=function(t){this.a.push(t)},t.ca=function(t){G(this.a,function(e){return e==t})},(t=nu.prototype).get=function(t){return $t(this.a[t])},t.set=function(t,e){return this.a[t]=e,$t()},t.P=function(t){return delete this.a[t],$t()},t.Y=function(){},t.ca=function(){},(t=ru.prototype).get=function(t){var e=this;return $t().then(function(){return Cr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return $t().then(function(){var r=Ar(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return $t().then(function(){e.a.removeItem(t)})},t.Y=function(t){a.window&&ze(a.window,"storage",t)},t.ca=function(t){a.window&&Xe(a.window,"storage",t)},(t=ou.prototype).get=function(){return $t(null)},t.set=function(){return $t()},t.P=function(){return $t()},t.Y=function(){},t.ca=function(){},(t=au.prototype).get=function(t){var e=this;return $t().then(function(){return Cr(e.a.getItem(t))})},t.set=function(t,e){var n=this;return $t().then(function(){var r=Ar(e);null===r?n.P(t):n.a.setItem(t,r)})},t.P=function(t){var e=this;return $t().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var cu,hu,lu={B:ru,Sa:au},fu={B:ru,Sa:au},pu={B:Us,Sa:ou},du={B:ru,Sa:ou},mu={Xc:"local",NONE:"none",Zc:"session"};function yu(){var t=!(Dr(vr())||!cr()),e=Sr(),n=wr();this.o=t,this.h=e,this.m=n,this.a={},cu||(cu=new uu),t=cu;try{this.g=!Zn()&&Lr()||!a.indexedDB?new t.a.B:new eu(hr()?new nu:new t.a.B)}catch(t){this.g=new nu,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new nu}this.l=new nu,this.f=T(this.Nb,this),this.b={}}function gu(){return hu||(hu=new yu),hu}function vu(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function bu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function wu(t,e,n){return n=bu(e,n),"local"==e.B&&(t.b[n]=null),vu(t,e.B).P(n)}function Eu(t){t.c&&(clearInterval(t.c),t.c=null)}function Tu(t){this.a=t,this.b=gu()}(t=yu.prototype).get=function(t,e){return vu(this,t.B).get(bu(t,e))},t.set=function(t,e,n){var r=bu(t,n),i=this,o=vu(this,t.B);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.B&&(i.b[r]=e)})},t.addListener=function(t,e,n){t=bu(t,e),this.m&&(this.b[t]=a.localStorage.getItem(t)),H(this.a)&&(vu(this,"local").Y(this.f),this.h||(Zn()||!Lr())&&a.indexedDB||!this.m||function(t){Eu(t),t.c=setInterval(function(){for(var e in t.a){var n=a.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new xe({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Nb(n))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=bu(t,e),this.a[t]&&(G(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),H(this.a)&&(vu(this,"local").ca(this.f),Eu(this))},t.Nb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=a.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Ya(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?vu(this,"local").ca(this.f):Eu(this),this.o)if(n=a.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?a.localStorage.setItem(e,r):a.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===a.localStorage.getItem(e)||(o.b[e]=a.localStorage.getItem(e),o.Ya(e))},be&&_e&&10==_e&&a.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else F(t,T(this.Ya,this))},t.Ya=function(t){this.a[t]&&F(this.a[t],function(t){t()})};var Iu,Su={name:"authEvent",B:"local"};function Au(){this.a=gu()}function Nu(t,e){this.b=Cu,this.f=a.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.m=a.Int32Array?new Int32Array(64):Array(64),void 0!==Iu||(Iu=a.Int32Array?new Int32Array(Lu):Lu),this.reset()}A(Nu,function(){this.b=-1});for(var Cu=64,_u=Cu-1,Du=[],ku=0;ku<_u;ku++)Du[ku]=0;var Ru=W(128,Du);function Ou(t){for(var e=t.f,n=t.m,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Iu[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function Pu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(s(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Ou(t),i=0);else{if(!m(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Ou(t),i=0)}}t.c=i,t.g+=n}Nu.prototype.reset=function(){this.g=this.c=0,this.a=a.Int32Array?new Int32Array(this.h):Q(this.h)};var Lu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Mu(){Nu.call(this,8,xu)}A(Mu,Nu);var xu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Uu(t,e,n,r,i){this.l=t,this.i=e,this.m=n,this.o=r||null,this.u=i||null,this.h=e+":"+n,this.v=new Au,this.g=new Tu(this.h),this.f=null,this.b=[],this.a=this.c=null}function qu(t){return new $r("invalid-cordova-configuration",t)}function Fu(t){var e=new Mu;Pu(e,t),t=[];var n=8*e.g;56>e.c?Pu(e,Ru,56-e.c):Pu(e,Ru,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Ou(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return V(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Vu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Bu(t){return t.f||(t.f=t.ga().then(function(){return new Wt(function(e){t.wa(function n(r){return e(r),t.La(n),!1}),function(t){function e(e){r=!0,i&&i.cancel(),ju(t).then(function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=xi(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Cr(In(o=Sn(i),"firebaseError")||null))?Zr(o):null)?new mo(r.c,r.b,null,null,o):new mo(r.c,r.b,i,r.f)),i=o||n}Vu(t,i)})}var n=new mo("unknown",null,null,null,new $r("no-auth-event")),r=!1,i=ln(500).then(function(){return ju(t).then(function(){r||Vu(t,n)})}),o=a.handleOpenURL;a.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(br("BuildInfo.packageName",a).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(t){console.error(t)}},bo||(bo=new go),bo.subscribe(e)}(t)})})),t.f}function ju(t){var e=null;return function(t){return t.b.get(Su,t.a).then(function(t){return yo(t)})}(t.g).then(function(n){return e=n,wu((n=t.g).b,Su,n.a)}).then(function(){return e})}function Ku(t){this.a=t,this.b=gu()}(t=Uu.prototype).ga=function(){return this.za?this.za:this.za=(ur(void 0)?sr().then(function(){return new Wt(function(t,e){var n=a.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Zt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof br("universalLinks.subscribe",a))throw qu("cordova-universal-links-plugin-fix is not installed");if(void 0===br("BuildInfo.packageName",a))throw qu("cordova-plugin-buildinfo is not installed");if("function"!=typeof br("cordova.plugins.browsertab.openUrl",a))throw qu("cordova-plugin-browsertab is not installed");if("function"!=typeof br("cordova.InAppBrowser.open",a))throw qu("cordova-plugin-inappbrowser is not installed")},function(){throw new $r("cordova-not-ready")})},t.Ea=function(t,e){return e(new $r("operation-not-supported-in-this-environment")),$t()},t.Db=function(){return Zt(new $r("operation-not-supported-in-this-environment"))},t.Ob=function(){return!1},t.Mb=function(){return!0},t.Hb=function(){return!0},t.Ca=function(t,e,n){if(this.c)return Zt(new $r("redirect-operation-pending"));var r=this,i=a.document,o=null,s=null,u=null,c=null;return this.c=$t().then(function(){return po(e),Bu(r)}).then(function(){return function(t,e,n,r){var i=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),o=new mo(e,r,null,i,new $r("no-auth-event")),s=br("BuildInfo.packageName",a);if("string"!=typeof s)throw new $r("invalid-cordova-configuration");var u=br("BuildInfo.displayName",a),c={};if(vr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!vr().toLowerCase().match(/android/))return Zt(new $r("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),i=Fu(i),c.sessionId=i;var h=xs(t.l,t.i,t.m,e,n,null,r,t.o,c,t.u);return t.ga().then(function(){var e=t.h;return t.v.a.set(Su,o.w(),e)}).then(function(){var e=br("cordova.plugins.browsertab.isAvailable",a);if("function"!=typeof e)throw new $r("invalid-cordova-configuration");var n=null;e(function(e){if(e){if("function"!=typeof(n=br("cordova.plugins.browsertab.openUrl",a)))throw new $r("invalid-cordova-configuration");n(h)}else{if("function"!=typeof(n=br("cordova.InAppBrowser.open",a)))throw new $r("invalid-cordova-configuration");e=vr(),t.a=n(h,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(r,t,e,n)}).then(function(){return new Wt(function(t,e){s=function(){var e=br("cordova.plugins.browsertab.close",a);return t(),"function"==typeof e&&e(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.wa(s),u=function(){o||(o=ln(2e3).then(function(){e(new $r("redirect-cancelled-by-user"))}))},c=function(){Or()&&u()},i.addEventListener("resume",u,!1),vr().toLowerCase().match(/android/)||i.addEventListener("visibilitychange",c,!1)}).s(function(t){return ju(r).then(function(){throw t})})}).ia(function(){u&&i.removeEventListener("resume",u,!1),c&&i.removeEventListener("visibilitychange",c,!1),o&&o.cancel(),s&&r.La(s),r.c=null})},t.wa=function(t){this.b.push(t),Bu(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new mo("unknown",null,null,null,new $r("no-auth-event")),t(e))})},t.La=function(t){G(this.b,function(e){return e==t})};var Gu={name:"pendingRedirect",B:"session"};function Wu(t){return wu(t.b,Gu,t.a)}function Qu(t,e,n){this.i={},this.u=0,this.A=t,this.l=e,this.o=n,this.h=[],this.f=!1,this.m=T(this.cb,this),this.b=new nc,this.v=new ac,this.g=new Ku(this.l+":"+this.o),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.v,this.c.linkViaPopup=this.v,this.c.reauthViaPopup=this.v,this.a=zu(this.A,this.l,this.o,bi)}function zu(t,e,n,r){var i=k.SDK_VERSION||null;return ur()?new Uu(t,e,n,i,r):new Os(t,e,n,i,r)}function Hu(t){t.f||(t.f=!0,t.a.wa(t.m));var e=t.a;return t.a.ga().s(function(n){throw t.a==e&&t.reset(),n})}function Yu(t){t.a.Mb()&&Hu(t).s(function(e){var n=new mo("unknown",null,null,null,new $r("operation-not-supported-in-this-environment"));Zu(e)&&t.cb(n)}),t.a.Hb()||rc(t.b)}(t=Qu.prototype).reset=function(){this.f=!1,this.a.La(this.m),this.a=zu(this.A,this.l,this.o),this.i={}},t.Za=function(){this.b.Za()},t.subscribe=function(t){if(j(this.h,t)||this.h.push(t),!this.f){var e=this;(function(t){return t.b.get(Gu,t.a).then(function(t){return"pending"==t})})(this.g).then(function(t){t?Wu(e.g).then(function(){Hu(e).s(function(t){var n=new mo("unknown",null,null,null,new $r("operation-not-supported-in-this-environment"));Zu(t)&&e.cb(n)})}):Yu(e)}).s(function(){Yu(e)})}},t.unsubscribe=function(t){G(this.h,function(e){return e==t})},t.cb=function(t){if(!t)throw new $r("invalid-auth-event");if(6e5<=S()-this.u&&(this.i={},this.u=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.u=S())),e=!0;break}}return rc(this.b),e};var Xu=new Rr(2e3,1e4),Ju=new Rr(3e4,6e4);function $u(t,e,n,r,i,o){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.m))},function(){t.reset()},i,o)}function Zu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}Qu.prototype.fa=function(){return this.b.fa()},Qu.prototype.Ca=function(t,e,n){var r,i=this;return function(t){return t.b.set(Gu,"pending",t.a)}(this.g).then(function(){return i.a.Ca(t,e,n).s(function(t){if(Zu(t))throw new $r("operation-not-supported-in-this-environment");return r=t,Wu(i.g).then(function(){throw r})}).then(function(){return i.a.Ob()?new Wt(function(){}):Wu(i.g).then(function(){return i.fa()}).then(function(){}).s(function(){})})})},Qu.prototype.Ea=function(t,e,n,r){return this.a.Ea(n,function(n){t.ha(e,null,n,r)},Xu.get())};var tc={};function ec(t,e,n){var r=e+":"+n;return tc[r]||(tc[r]=new Qu(t,e,n)),tc[r]}function nc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function rc(t){t.g||(t.g=!0,oc(t,!1,null,null))}function ic(t,e){if(t.b=function(){return $t(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function oc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Zt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):ic(t,n):ic(t,{user:null}),t.f=[],t.c=[]}function ac(){}function sc(){this.ub=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.ub},set:function(t){this.ub=t},enumerable:!1})}function uc(t,e){this.a=e,Fr(this,"verificationId",t)}function cc(t,e,n,r){return new ho(t).Va(e,n).then(function(t){return new uc(t,r)})}function hc(t){var e=vi(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new $r("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Vr(this,{token:t,expirationTime:Pr(1e3*e.exp),authTime:Pr(1e3*e.auth_time),issuedAtTime:Pr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function lc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function fc(t){this.f=t,this.b=this.a=null,this.c=0}function pc(t,e){var n=e[Na],r=e.refreshToken;e=dc(e.expiresIn),t.b=n,t.c=e,t.a=r}function dc(t){return S()+1e3*parseInt(t,10)}function mc(t,e){return function(t,e){return new Wt(function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?Pa(t,t.i+"?key="+encodeURIComponent(t.b),function(t){t?t.error?r(Is(t)):t.access_token&&t.refresh_token?n(t):r(new $r("internal-error")):r(new $r("network-request-failed"))},"POST",xn(e).toString(),t.f,t.m.get()):r(new $r("internal-error"))})}(t.f,e).then(function(e){return t.b=e.access_token,t.c=dc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}function yc(t,e){this.a=t||null,this.b=e||null,Vr(this,{lastSignInTime:Pr(e||null),creationTime:Pr(t||null)})}function gc(t,e,n,r,i,o){Vr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function vc(t,e){for(var n in Me.call(this,t),e)this[n]=e[n]}function bc(t,e,n){this.G=[],this.l=t.apiKey,this.o=t.appName,this.u=t.authDomain||null,t=k.SDK_VERSION?gr(k.SDK_VERSION):null,this.c=new Sa(this.l,Ei(bi),t),this.h=new fc(this.c),Nc(this,e[Na]),pc(this.h,e),Fr(this,"refreshToken",this.h.a),Dc(this,n||{}),an.call(this),this.I=!1,this.u&&Er()&&(this.a=ec(this.u,this.l,this.o)),this.N=[],this.i=null,this.A=function(t){return new lc(function(){return t.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.h.c-S()-3e5;return 0<e?e:0})}(this),this.V=T(this.Ha,this);var r=this;this.ka=null,this.ta=function(t){r.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){Ec(r,t.c)},this.W=null}function wc(t,e){t.X&&Xe(t.X,"languageCodeChanged",t.ta),(t.X=e)&&ze(e,"languageCodeChanged",t.ta)}function Ec(t,e){t.O=e,Oa(t.c,k.SDK_VERSION?gr(k.SDK_VERSION,t.O):null)}function Tc(t,e){t.W&&Xe(t.W,"frameworkChanged",t.sa),(t.W=e)&&ze(e,"frameworkChanged",t.sa)}function Ic(t){try{return k.app(t.o).auth()}catch(e){throw new $r("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.o+"'!")}}function Sc(t){t.D||t.A.b||(t.A.start(),Xe(t,"tokenChanged",t.V),ze(t,"tokenChanged",t.V))}function Ac(t){Xe(t,"tokenChanged",t.V),t.A.stop()}function Nc(t,e){t.ra=e,Fr(t,"_lat",e)}function Cc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return ee(e).then(function(){return t})}function _c(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function Dc(t,e){Vr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new yc(e.createdAt,e.lastLoginAt),providerData:[]})}function kc(){}function Rc(t){return $t().then(function(){if(t.D)throw new $r("app-deleted")})}function Oc(t){return V(t.providerData,function(t){return t.providerId})}function Pc(t,e){e&&(Lc(t,e.providerId),t.providerData.push(e))}function Lc(t,e){G(t.providerData,function(t){return t.providerId==e})}function Mc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Fr(t,e,n)}function xc(t,e){t!=e&&(Vr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,providerData:[]}),e.metadata?Fr(t,"metadata",function(t){return new yc(t.a,t.b)}(e.metadata)):Fr(t,"metadata",new yc),F(e.providerData,function(e){Pc(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.h,e.h),Fr(t,"refreshToken",t.h.a))}function Uc(t){return t.F().then(function(e){var n=t.isAnonymous;return function(t,e){return Es(t.c,ns,{idToken:e}).then(T(t.wc,t))}(t,e).then(function(){return n||Mc(t,"isAnonymous",!1),e})})}function qc(t,e){e[Na]&&t.ra!=e[Na]&&(pc(t.h,e),t.dispatchEvent(new vc("tokenChanged")),Nc(t,e[Na]),Mc(t,"refreshToken",t.h.a))}function Fc(t,e){return Uc(t).then(function(){if(j(Oc(t),e))return Cc(t).then(function(){throw new $r("provider-already-linked")})})}function Vc(t,e,n){return Br({user:t,credential:fo(e),additionalUserInfo:e=Ni(e),operationType:n})}function Bc(t,e){return qc(t,e),t.reload().then(function(){return t})}function jc(t,e,n,r,i){if(!Er())return Zt(new $r("operation-not-supported-in-this-environment"));if(t.i&&!i)return Zt(t.i);var o=Ai(n.providerId),a=_r(t.uid+":::"),s=null;(!Sr()||cr())&&t.u&&n.isOAuthProvider&&(s=xs(t.u,t.l,t.o,e,n,null,a,k.SDK_VERSION||null));var u=ir(s,o&&o.Ba,o&&o.Aa);return r=r().then(function(){if(Gc(t),!i)return t.F().then(function(){})}).then(function(){return $u(t.a,u,e,n,a,!!s)}).then(function(){return new Wt(function(n,r){t.ha(e,null,new $r("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=a,t.b=t.a.Ea(t,e,u,a)})}).then(function(t){return u&&rr(u),t?Br(t):null}).s(function(t){throw u&&rr(u),t}),Wc(t,r,i)}function Kc(t,e,n,r,i){if(!Er())return Zt(new $r("operation-not-supported-in-this-environment"));if(t.i&&!i)return Zt(t.i);var o=null,a=_r(t.uid+":::");return r=r().then(function(){if(Gc(t),!i)return t.F().then(function(){})}).then(function(){return t.aa=a,Cc(t)}).then(function(e){return t.ba&&(e=(e=t.ba).b.set(Hc,t.w(),e.a)),e}).then(function(){return t.a.Ca(e,n,a)}).s(function(e){if(o=e,t.ba)return Yc(t.ba);throw o}).then(function(){if(o)throw o}),Wc(t,r,i)}function Gc(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new $r("internal-error");throw new $r("auth-domain-config-required")}}function Wc(t,e,n){var r=function(t,e,n){return t.i&&!n?(e.cancel(),Zt(t.i)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.i||t.dispatchEvent(new vc("userInvalidated")),t.i=e),e})}(t,e,n);return t.G.push(r),r.ia(function(){K(t.G,r)}),r}function Qc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Na]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-S())/1e3;var r=new bc(e,n,t);return t.providerData&&F(t.providerData,function(t){t&&Pc(r,Br(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function zc(t){this.a=t,this.b=gu()}nc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},nc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(oc(this,!0,null,t.a),$t()):e.xa(n,r)?function(t,e,n){n=n.xa(e.c,e.b);var r=e.g,i=e.f,o=e.h,a=!!e.c.match(/Redirect$/);n(r,i,o).then(function(e){oc(t,a,e,null)}).s(function(e){oc(t,a,null,e)})}(this,t,e):Zt(new $r("invalid-auth-event")):(oc(this,!1,null,null),$t())}else Zt(new $r("invalid-auth-event"))},nc.prototype.Za=function(){this.g&&!this.i&&oc(this,!1,null,null)},nc.prototype.fa=function(){var t=this;return new Wt(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new $r("timeout");t.a&&t.a.cancel(),t.a=ln(Ju.get()).then(function(){t.b||(t.g=!0,oc(t,!0,null,e))})}(t))})},ac.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ha(t.c,null,t.a,t.b),$t()):e.xa(n,r)?function(t,e){var n=t.b,r=t.c;e.xa(r,n)(t.g,t.f,t.h).then(function(t){e.ha(r,t,null,n)}).s(function(t){e.ha(r,null,t,n)})}(t,e):Zt(new $r("invalid-auth-event"))}else Zt(new $r("invalid-auth-event"))},uc.prototype.confirm=function(t){return t=lo(this.verificationId,t),this.a(t)},lc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop();e.b=ln(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then(function(){return t=a.document,e=null,Or()||!t?$t():new Wt(function(n){e=function(){Or()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},lc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},fc.prototype.w=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},fc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Zt(new $r("user-token-expired")):t||!this.b||S()>this.c-3e4?this.a?mc(this,{grant_type:"refresh_token",refresh_token:this.a}):$t(null):$t({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},yc.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},A(vc,Me),A(bc,an),bc.prototype.pa=function(t){this.ka=t,Ra(this.c,t)},bc.prototype.ea=function(){return this.ka},bc.prototype.ya=function(){return Q(this.O)},bc.prototype.Ha=function(){this.A.b&&(this.A.stop(),this.A.start())},Fr(bc.prototype,"providerId","firebase"),(t=bc.prototype).reload=function(){var t=this;return Wc(this,Rc(this).then(function(){return Uc(t).then(function(){return Cc(t)}).then(kc)}))},t.ac=function(t){return this.F(t).then(function(t){return new hc(t)})},t.F=function(t){var e=this;return Wc(this,Rc(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new $r("internal-error");return t.accessToken!=e.ra&&(Nc(e,t.accessToken),e.dispatchEvent(new vc("tokenChanged"))),Mc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.wc=function(t){if(!(t=t.users)||!t.length)throw new $r("internal-error");Dc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?V(t,function(t){return new gc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Pc(this,e[n]);Mc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.xc=function(t){return Ur("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return Wc(this,t.f(this.c,this.uid).then(function(t){return qc(e,t),n=Vc(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},t.oc=function(t){return Ur("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(t){var e=this,n=null;return Wc(this,Fc(this,t.providerId).then(function(){return e.F()}).then(function(n){return t.b(e.c,n)}).then(function(t){return n=Vc(e,t,"link"),Bc(e,t)}).then(function(){return n}))},t.pc=function(t,e){var n=this;return Wc(this,Fc(this,"phone").then(function(){return cc(Ic(n),t,e,T(n.fb,n))}))},t.yc=function(t,e){var n=this;return Wc(this,$t().then(function(){return cc(Ic(n),t,e,T(n.hb,n))}),!0)},t.rb=function(t){var e=this;return Wc(this,this.F().then(function(n){return e.c.rb(n,t)}).then(function(t){return qc(e,t),e.reload()}))},t.Pc=function(t){var e=this;return Wc(this,this.F().then(function(n){return t.b(e.c,n)}).then(function(t){return qc(e,t),e.reload()}))},t.sb=function(t){var e=this;return Wc(this,this.F().then(function(n){return e.c.sb(n,t)}).then(function(t){return qc(e,t),e.reload()}))},t.tb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Rc(this);var e=this;return Wc(this,this.F().then(function(n){return e.c.tb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return qc(e,t),Mc(e,"displayName",t.displayName||null),Mc(e,"photoURL",t.photoUrl||null),F(e.providerData,function(t){"password"===t.providerId&&(Fr(t,"displayName",e.displayName),Fr(t,"photoURL",e.photoURL))}),Cc(e)}).then(kc))},t.Nc=function(t){var e=this;return Wc(this,Uc(this).then(function(n){return j(Oc(e),t)?function(t,e,n){return Es(t,Za,{idToken:e,deleteProvider:n})}(e.c,n,[t]).then(function(t){var n={};return F(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),F(Oc(e),function(t){n[t]||Lc(e,t)}),n[ho.PROVIDER_ID]||Fr(e,"phoneNumber",null),Cc(e)}):Cc(e).then(function(){throw new $r("no-such-provider")})}))},t.delete=function(){var t=this;return Wc(this,this.F().then(function(e){return Es(t.c,$a,{idToken:e})}).then(function(){t.dispatchEvent(new vc("userDeleted"))})).then(function(){for(var e=0;e<t.G.length;e++)t.G[e].cancel("app-deleted");wc(t,null),Tc(t,null),t.G=[],t.D=!0,Ac(t),Fr(t,"refreshToken",null),t.a&&t.a.unsubscribe(t)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?T(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?T(this.Cb,this):"linkViaRedirect"==t&&(this.aa||null)==e?T(this.Bb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?T(this.Cb,this):null},t.qc=function(t){var e=this;return jc(this,"linkViaPopup",t,function(){return Fc(e,t.providerId).then(function(){return Cc(e)})},!1)},t.zc=function(t){return jc(this,"reauthViaPopup",t,function(){return $t()},!0)},t.rc=function(t){var e=this;return Kc(this,"linkViaRedirect",t,function(){return Fc(e,t.providerId)},!1)},t.Ac=function(t){return Kc(this,"reauthViaRedirect",t,function(){return $t()},!0)},t.Bb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Wc(this,this.F().then(function(i){return Wa(r.c,{requestUri:t,postBody:n,sessionId:e,idToken:i})}).then(function(t){return i=Vc(r,t,"link"),Bc(r,t)}).then(function(){return i}))},t.Cb=function(t,e,n){var r=this;this.b&&(this.b.cancel(),this.b=null);var i=null;return Wc(this,$t().then(function(){return qi(Qa(r.c,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=Vc(r,t,"reauthenticate"),qc(r,t),r.i=null,r.reload()}).then(function(){return i}),!0)},t.kb=function(t){var e=this,n=null;return Wc(this,this.F().then(function(e){return n=e,void 0===t||H(t)?{}:fi(new ni(t))}).then(function(t){return e.c.kb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.w()},t.w=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.o,authDomain:this.u,stsTokenManager:this.h.w(),redirectEventId:this.aa||null};return this.metadata&&J(t,this.metadata.w()),F(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var Hc={name:"redirectUser",B:"session"};function Yc(t){return wu(t.b,Hc,t.a)}function Xc(t){this.a=t,this.b=gu(),this.c=null,this.f=function(t){var e=Zc("local"),n=Zc("session"),r=Zc("none");return function(t,e,n){var r=bu(e,n),i=vu(t,e.B);return t.get(e,n).then(function(o){var s=null;try{s=Cr(a.localStorage.getItem(r))}catch(t){}if(s&&!o)return a.localStorage.removeItem(r),t.set(e,s,n);s&&o&&"localStorage"!=i.type&&a.localStorage.removeItem(r)})}(t.b,e,t.a).then(function(){return t.b.get(n,t.a)}).then(function(i){return i?n:t.b.get(r,t.a).then(function(n){return n?r:t.b.get(e,t.a).then(function(n){return n?e:t.b.get($c,t.a).then(function(t){return t?Zc(t):e})})})}).then(function(e){return t.c=e,Jc(t,e.B)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener(Zc("local"),this.a,T(this.g,this))}function Jc(t,e){var n,r=[];for(n in mu)mu[n]!==e&&r.push(wu(t.b,Zc(mu[n]),t.a));return r.push(wu(t.b,$c,t.a)),function(t){return new Wt(function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)te(t[s],I(o,s),a);else e(i)})}(r)}Xc.prototype.g=function(){var t=this,e=Zc("local");rh(this,function(){return $t().then(function(){return t.c&&"local"!=t.c.B?t.b.get(e,t.a):null}).then(function(n){if(n)return Jc(t,"local").then(function(){t.c=e})})})};var $c={name:"persistence",B:"session"};function Zc(t){return{name:"authUser",B:t}}function th(t,e){return rh(t,function(){return t.b.set(t.c,e.w(),t.a)})}function eh(t){return rh(t,function(){return wu(t.b,t.c,t.a)})}function nh(t,e){return rh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Qc(t||{})})})}function rh(t,e){return t.f=t.f.then(e,e),t.f}function ih(t){if(this.l=!1,Fr(this,"settings",new sc),Fr(this,"app",t),!lh(this).options||!lh(this).options.apiKey)throw new $r("invalid-api-key");t=k.SDK_VERSION?gr(k.SDK_VERSION):null,this.c=new Sa(lh(this).options&&lh(this).options.apiKey,Ei(bi),t),this.N=[],this.o=[],this.I=[],this.Rb=k.INTERNAL.createSubscribe(T(this.kc,this)),this.O=void 0,this.Sb=k.INTERNAL.createSubscribe(T(this.mc,this)),ch(this,null),this.h=new Xc(lh(this).options.apiKey+":"+lh(this).name),this.A=new zc(lh(this).options.apiKey+":"+lh(this).name),this.V=mh(this,function(t){var e=lh(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(Hc,t.a).then(function(t){return t&&e&&(t.authDomain=e),Qc(t||{})})}(t.A,lh(t).options.authDomain).then(function(e){return(t.D=e)&&(e.ba=t.A),Yc(t.A)});return mh(t,e)}(t).then(function(){return nh(t.h,e)}).then(function(e){return e?(e.ba=t.A,t.D&&(t.D.aa||null)==(e.aa||null)?e:e.reload().then(function(){return th(t.h,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:eh(t.h)})):null}).then(function(e){ch(t,e||null)});return mh(t,n)}(this)),this.i=mh(this,function(t){return t.V.then(function(){return t.fa()}).s(function(){}).then(function(){if(!t.l)return t.ka()}).s(function(){}).then(function(){if(!t.l){t.X=!0;var e=t.h;e.b.addListener(Zc("local"),e.a,t.ka)}})}(this)),this.X=!1,this.ka=T(this.Kc,this),this.Ha=T(this.Z,this),this.ra=T(this.Zb,this),this.sa=T(this.ic,this),this.ta=T(this.jc,this),function(t){var e=lh(t).options.authDomain,n=lh(t).options.apiKey;e&&Er()&&(t.Qb=t.V.then(function(){if(!t.l){if(t.a=ec(e,n,lh(t).name),t.a.subscribe(t),fh(t)&&_c(fh(t)),t.D){_c(t.D);var r=t.D;r.pa(t.ea()),wc(r,t),Ec(r=t.D,t.G),Tc(r,t),t.D=null}return t.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=T(this.delete,this),this.INTERNAL.logFramework=T(this.sc,this),this.u=0,an.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),t.W=null}(this),this.G=[]}function oh(t){Me.call(this,"languageCodeChanged"),this.g=t}function ah(t){Me.call(this,"frameworkChanged"),this.c=t}function sh(t){return t.Qb||Zt(new $r("auth-domain-config-required"))}function uh(t,e){var n={};return n.apiKey=lh(t).options.apiKey,n.authDomain=lh(t).options.authDomain,n.appName=lh(t).name,t.V.then(function(){return function(t,e,n,r){var i=new bc(t,e);return n&&(i.ba=n),r&&Ec(i,r),i.reload().then(function(){return i})}(n,e,t.A,t.ya())}).then(function(e){return fh(t)&&e.uid==fh(t).uid?(xc(fh(t),e),t.Z(e)):(ch(t,e),_c(e),t.Z(e))}).then(function(){dh(t)})}function ch(t,e){fh(t)&&(function(t,e){G(t.N,function(t){return t==e})}(fh(t),t.Ha),Xe(fh(t),"tokenChanged",t.ra),Xe(fh(t),"userDeleted",t.sa),Xe(fh(t),"userInvalidated",t.ta),Ac(fh(t))),e&&(e.N.push(t.Ha),ze(e,"tokenChanged",t.ra),ze(e,"userDeleted",t.sa),ze(e,"userInvalidated",t.ta),0<t.u&&Sc(e)),Fr(t,"currentUser",e),e&&(e.pa(t.ea()),wc(e,t),Ec(e,t.G),Tc(e,t))}function hh(t,e){var n=null,r=null;return mh(t,e.then(function(e){return n=fo(e),r=Ni(e),uh(t,e)}).then(function(){return Br({user:fh(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function lh(t){return t.app}function fh(t){return t.currentUser}function ph(t){return fh(t)&&fh(t)._lat||null}function dh(t){if(t.X){for(var e=0;e<t.o.length;e++)t.o[e]&&t.o[e](ph(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e](ph(t))}}function mh(t,e){return t.N.push(e),e.ia(function(){K(t.N,e)}),e}function yh(){}function gh(){this.a={},this.b=1e12}Xc.prototype.nb=function(t){var e=null,n=this;return function(t){var e=new $r("invalid-persistence-type"),n=new $r("unsupported-persistence-type");t:{for(r in mu)if(mu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(lr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!wr()&&"none"!==t)throw n}}(t),rh(this,function(){return t!=n.c.B?n.b.get(n.c,n.a).then(function(r){return e=r,Jc(n,t)}).then(function(){if(n.c=Zc(t),e)return n.b.set(n.c,e,n.a)}):$t()})},A(ih,an),A(oh,Me),A(ah,Me),(t=ih.prototype).nb=function(t){return mh(this,t=this.h.nb(t))},t.pa=function(t){this.W===t||this.l||(this.W=t,Ra(this.c,this.W),this.dispatchEvent(new oh(this.ea())))},t.ea=function(){return this.W},t.Qc=function(){var t=a.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.sc=function(t){this.G.push(t),Oa(this.c,k.SDK_VERSION?gr(k.SDK_VERSION,this.G):null),this.dispatchEvent(new ah(this.G))},t.ya=function(){return Q(this.G)},t.toJSON=function(){return{apiKey:lh(this).options.apiKey,authDomain:lh(this).options.authDomain,appName:lh(this).name,currentUser:fh(this)&&fh(this).w()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?T(this.Yb,this):null},t.Yb=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.b&&(this.b.cancel(),this.b=null);var i=null,o=null,a=Ga(r.c,t).then(function(t){return i=fo(t),o=Ni(t),t});return mh(this,t=r.V.then(function(){return a}).then(function(t){return uh(r,t)}).then(function(){return Br({user:fh(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Ic=function(t){if(!Er())return Zt(new $r("operation-not-supported-in-this-environment"));var e=this,n=Ai(t.providerId),r=_r(),i=null;(!Sr()||cr())&&lh(this).options.authDomain&&t.isOAuthProvider&&(i=xs(lh(this).options.authDomain,lh(this).options.apiKey,lh(this).name,"signInViaPopup",t,null,r,k.SDK_VERSION||null));var o=ir(i,n&&n.Ba,n&&n.Aa);return mh(this,n=sh(this).then(function(e){return $u(e,o,"signInViaPopup",t,r,!!i)}).then(function(){return new Wt(function(t,n){e.ha("signInViaPopup",null,new $r("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.b=e.a.Ea(e,"signInViaPopup",o,r)})}).then(function(t){return o&&rr(o),t?Br(t):null}).s(function(t){throw o&&rr(o),t}))},t.Jc=function(t){if(!Er())return Zt(new $r("operation-not-supported-in-this-environment"));var e=this;return mh(this,sh(this).then(function(){return rh(t=e.h,function(){return t.b.set($c,t.c.B,t.a)});var t}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},t.fa=function(){if(!Er())return Zt(new $r("operation-not-supported-in-this-environment"));var t=this;return mh(this,sh(this).then(function(){return t.a.fa()}).then(function(t){return t?Br(t):null}))},t.Oc=function(t){if(!t)return Zt(new $r("null-user"));var e=this,n={};n.apiKey=lh(this).options.apiKey,n.authDomain=lh(this).options.authDomain,n.appName=lh(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.o};var i=t.h,o={};return o[Na]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-S())/1e3,e=new bc(e,o),n&&(e.ba=n),r&&Ec(e,r),xc(e,t),e}(t,n,e.A,e.ya());return mh(this,this.i.then(function(){if(lh(e).options.apiKey!=t.l)return r.reload()}).then(function(){return fh(e)&&t.uid==fh(e).uid?(xc(fh(e),t),e.Z(t)):(ch(e,r),_c(r),e.Z(r))}).then(function(){dh(e)}))},t.pb=function(){var t=this;return mh(this,this.i.then(function(){return fh(t)?(ch(t,null),eh(t.h).then(function(){dh(t)})):$t()}))},t.Kc=function(){var t=this;return nh(this.h,lh(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=fh(t)&&e){n=fh(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return xc(fh(t),e),fh(t).F();(fh(t)||e)&&(ch(t,e),e&&(_c(e),e.ba=t.A),t.a&&t.a.subscribe(t),dh(t))}})},t.Z=function(t){return th(this.h,t)},t.Zb=function(){dh(this),this.Z(fh(this))},t.ic=function(){this.pb()},t.jc=function(){this.pb()},t.kc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(fh(e))})},t.mc=function(t){var e=this;!function(t,e){t.I.push(e),mh(t,t.i.then(function(){!t.l&&j(t.I,e)&&t.O!==t.getUid()&&(t.O=t.getUid(),e(ph(t)))}))}(this,function(){t.next(fh(e))})},t.uc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){y(t)?t(fh(r)):y(t.next)&&t.next(fh(r))}),this.Rb(t,e,n)},t.tc=function(t,e,n){var r=this;return this.X&&Promise.resolve().then(function(){r.O=r.getUid(),y(t)?t(fh(r)):y(t.next)&&t.next(fh(r))}),this.Sb(t,e,n)},t.$b=function(t){var e=this;return mh(this,this.i.then(function(){return fh(e)?fh(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Ec=function(t){var e=this;return this.i.then(function(){return hh(e,Es(e.c,ys,{token:t}))}).then(function(t){var n=t.user;return Mc(n,"isAnonymous",!1),e.Z(n),t})},t.Fc=function(t,e){var n=this;return this.i.then(function(){return hh(n,Es(n.c,gs,{email:t,password:e}))})},t.Ub=function(t,e){var n=this;return this.i.then(function(){return hh(n,Es(n.c,Xa,{email:t,password:e}))})},t.Ra=function(t){var e=this;return this.i.then(function(){return hh(e,t.la(e.c))})},t.Dc=function(t){return Ur("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ra(t)},t.ob=function(){var t=this;return this.i.then(function(){var e=fh(t);if(e&&e.isAnonymous){var n=Br({providerId:null,isNewUser:!1});return Br({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return hh(t,t.c.ob()).then(function(e){var n=e.user;return Mc(n,"isAnonymous",!0),t.Z(n),e})})},t.getUid=function(){return fh(this)&&fh(this).uid||null},t.Tb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&fh(this)&&Sc(fh(this))},t.Bc=function(t){var e=this;F(this.o,function(n){n==t&&e.u--}),0>this.u&&(this.u=0),0==this.u&&fh(this)&&Ac(fh(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.o.push(t),mh(this,this.i.then(function(){e.l||j(e.o,t)&&t(ph(e))}))},t.removeAuthTokenListener=function(t){G(this.o,function(e){return e==t})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(Zc("local"),t.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Za()),Promise.resolve()},t.Xb=function(t){return mh(this,function(t,e){return Es(t,Ja,{identifier:e,continueUri:Tr()?tr():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.c,t))},t.nc=function(t){return!!ao(t)},t.mb=function(t,e){var n=this;return mh(this,$t().then(function(){var t=new ni(e);if(!t.c)throw new $r("argument-error",oi+" must be true when sending sign in link to email");return fi(t)}).then(function(e){return n.c.mb(t,e)}).then(function(){}))},t.Rc=function(t){return this.Ka(t).then(function(t){return t.data.email})},t.$a=function(t,e){return mh(this,this.c.$a(t,e).then(function(){}))},t.Ka=function(t){return mh(this,this.c.Ka(t).then(function(t){return new Kr(t)}))},t.Xa=function(t){return mh(this,this.c.Xa(t).then(function(){}))},t.lb=function(t,e){var n=this;return mh(this,$t().then(function(){return void 0===e||H(e)?{}:fi(new ni(e))}).then(function(e){return n.c.lb(t,e)}).then(function(){}))},t.Hc=function(t,e){return mh(this,cc(this,t,e,T(this.Ra,this)))},t.Gc=function(t,e){var n=this;return mh(this,$t().then(function(){var r=oo(t,e||tr());return n.Ra(r)}))},yh.prototype.render=function(){},yh.prototype.reset=function(){},yh.prototype.getResponse=function(){},yh.prototype.execute=function(){};var vh=null;function bh(t,e){return(e=wh(e))&&t.a[e]||null}function wh(t){return(t=void 0===t?1e12:t)?t.toString():null}function Eh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Kn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():ze(this.f,"click",this.i)}function Th(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Ih(){}gh.prototype.render=function(t,e){return this.a[this.b.toString()]=new Eh(t,e),this.b++},gh.prototype.reset=function(t){var e=bh(this,t);t=wh(t),e&&t&&(e.delete(),delete this.a[t])},gh.prototype.getResponse=function(t){return(t=bh(this,t))?t.getResponse():null},gh.prototype.execute=function(t){(t=bh(this,t))&&t.execute()},Eh.prototype.getResponse=function(){return Th(this),this.b},Eh.prototype.execute=function(){Th(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(t){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()},6e4)},500))},Eh.prototype.delete=function(){Th(this),this.g=!0,clearTimeout(this.a),this.a=null,Xe(this.f,"click",this.i)},Ih.prototype.g=function(){return vh||(vh=new gh),$t(vh)},Ih.prototype.c=function(){};var Sh=null;function Ah(){this.b=a.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Nh=new $(et,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Ch=new Rr(3e4,6e4);Ah.prototype.g=function(t){var e=this;return new Wt(function(n,r){var i=setTimeout(function(){r(new $r("network-request-failed"))},Ch.get());!a.grecaptcha||t!==e.f&&!e.b?(a[e.a]=function(){if(a.grecaptcha){e.f=t;var o=a.grecaptcha.render;a.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(a.grecaptcha)}else clearTimeout(i),r(new $r("internal-error"));delete a[e.a]},$t(ga(ot(Nh,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(i),r(new $r("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(i),n(a.grecaptcha))})},Ah.prototype.c=function(){this.b--};var _h=null;function Dh(t,e,n,r,i,o,s){if(Fr(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.l=e,this.g=null,s?(Sh||(Sh=new Ih),s=Sh):(_h||(_h=new Ah),s=_h),this.o=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Oh])throw new $r("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Ph],!a.document)throw new $r("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Kn(e)||!this.i&&Kn(e).hasChildNodes())throw new $r("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new Sa(t,o||null,i||null),this.v=r||function(){return null};var u=this;this.m=[];var c=this.a[kh];this.a[kh]=function(t){if(Lh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=br(c,a);"function"==typeof e&&e(t)}};var h=this.a[Rh];this.a[Rh]=function(){if(Lh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=br(h,a);"function"==typeof t&&t()}}}var kh="callback",Rh="expired-callback",Oh="sitekey",Ph="size";function Lh(t,e){for(var n=0;n<t.m.length;n++)try{t.m[n](e)}catch(t){}}function Mh(t,e){return t.h.push(e),e.ia(function(){K(t.h,e)}),e}function xh(t){if(t.D)throw new $r("internal-error","RecaptchaVerifier instance has been destroyed.")}function Uh(t,e,n){var r=!1;try{this.b=n||k.app()}catch(t){throw new $r("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new $r("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=k.SDK_VERSION?gr(k.SDK_VERSION,o):null,Dh.call(this,n,t,e,function(){try{var t=i.b.auth().ea()}catch(e){t=null}return t},o,Ei(bi),r)}function qh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new $r("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],0>i||i>=Fh.length)throw new $r("internal-error","Argument validator received an unsupported number of arguments.");n=Fh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new $r("argument-error",t+" failed: "+r)}(t=Dh.prototype).za=function(){var t=this;return this.f?this.f:this.f=Mh(this,$t().then(function(){if(Tr()&&!hr())return sr();throw new $r("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.o.g(t.v())}).then(function(e){return t.g=e,Es(t.u,ss,{})}).then(function(e){t.a[Oh]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){xh(this);var t=this;return Mh(this,this.za().then(function(){if(null===t.c){var e=t.l;if(!t.i){var n=Kn(e);e=Qn("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){xh(this);var t=this;return Mh(this,this.render().then(function(e){return new Wt(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){G(t.m,function(t){return t==e})}(t,i),n(e))};t.m.push(i),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){xh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){xh(this),this.D=!0,this.o.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Kn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},A(Uh,Dh);var Fh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Vh(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:s}}function Bh(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:u}}function jh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:g}}function Kh(t,e){return{name:t||"",K:"a function",optional:!!e,M:y}}function Gh(t,e){return{name:t||"",K:"null",optional:!!e,M:p}}function Wh(t){return{name:t?t+"Credential":"credential",K:t?"a valid "+t+" credential":"a valid credential",optional:!1,M:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.la||!n)}}}function Qh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&s(t.type)&&y(t.verify))}}}function zh(t,e,n,r){return{name:n||"",K:t.K+" or "+e.K,optional:!!r,M:function(n){return t.M(n)||e.M(n)}}}function Hh(t,e){for(var n in e){var r=e[n].name;t[r]=Jh(r,t[n],e[n].j)}}function Yh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:I(function(t){return this[t]},n),set:I(function(t,e,n,r){qh(t,[n],[r],!0),this[e]=r},r,n,e[n].vb),enumerable:!0})}}function Xh(t,e,n,r){t[e]=Jh(e,n,r)}function Jh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return qh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}Hh(ih.prototype,{Xa:{name:"applyActionCode",j:[Vh("code")]},Ka:{name:"checkActionCode",j:[Vh("code")]},$a:{name:"confirmPasswordReset",j:[Vh("code"),Vh("newPassword")]},Ub:{name:"createUserWithEmailAndPassword",j:[Vh("email"),Vh("password")]},Xb:{name:"fetchSignInMethodsForEmail",j:[Vh("email")]},fa:{name:"getRedirectResult",j:[]},nc:{name:"isSignInWithEmailLink",j:[Vh("emailLink")]},tc:{name:"onAuthStateChanged",j:[zh(jh(),Kh(),"nextOrObserver"),Kh("opt_error",!0),Kh("opt_completed",!0)]},uc:{name:"onIdTokenChanged",j:[zh(jh(),Kh(),"nextOrObserver"),Kh("opt_error",!0),Kh("opt_completed",!0)]},lb:{name:"sendPasswordResetEmail",j:[Vh("email"),zh(jh("opt_actionCodeSettings",!0),Gh(null,!0),"opt_actionCodeSettings",!0)]},mb:{name:"sendSignInLinkToEmail",j:[Vh("email"),jh("actionCodeSettings")]},nb:{name:"setPersistence",j:[Vh("persistence")]},Dc:{name:"signInAndRetrieveDataWithCredential",j:[Wh()]},ob:{name:"signInAnonymously",j:[]},Ra:{name:"signInWithCredential",j:[Wh()]},Ec:{name:"signInWithCustomToken",j:[Vh("token")]},Fc:{name:"signInWithEmailAndPassword",j:[Vh("email"),Vh("password")]},Gc:{name:"signInWithEmailLink",j:[Vh("email"),Vh("emailLink",!0)]},Hc:{name:"signInWithPhoneNumber",j:[Vh("phoneNumber"),Qh()]},Ic:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Jc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Oc:{name:"updateCurrentUser",j:[zh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof bc)}},Gh(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Vh(null,!0)]},Qc:{name:"useDeviceLanguage",j:[]},Rc:{name:"verifyPasswordResetCode",j:[Vh("code")]}}),Yh(ih.prototype,{lc:{name:"languageCode",vb:zh(Vh(),Gh(),"languageCode")}}),ih.Persistence=mu,ih.Persistence.LOCAL="local",ih.Persistence.SESSION="session",ih.Persistence.NONE="none",Hh(bc.prototype,{delete:{name:"delete",j:[]},ac:{name:"getIdTokenResult",j:[Bh("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Bh("opt_forceRefresh",!0)]},oc:{name:"linkAndRetrieveDataWithCredential",j:[Wh()]},fb:{name:"linkWithCredential",j:[Wh()]},pc:{name:"linkWithPhoneNumber",j:[Vh("phoneNumber"),Qh()]},qc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},rc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},xc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Wh()]},hb:{name:"reauthenticateWithCredential",j:[Wh()]},yc:{name:"reauthenticateWithPhoneNumber",j:[Vh("phoneNumber"),Qh()]},zc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},kb:{name:"sendEmailVerification",j:[zh(jh("opt_actionCodeSettings",!0),Gh(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Vh(null,!0)]},Nc:{name:"unlink",j:[Vh("provider")]},rb:{name:"updateEmail",j:[Vh("email")]},sb:{name:"updatePassword",j:[Vh("password")]},Pc:{name:"updatePhoneNumber",j:[Wh("phone")]},tb:{name:"updateProfile",j:[jh("profile")]}}),Hh(gh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Hh(yh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Hh(Wt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),Yh(sc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",vb:Bh("appVerificationDisabledForTesting")}}),Hh(uc.prototype,{confirm:{name:"confirm",j:[Vh("verificationCode")]}}),Xh(Ui,"fromJSON",function(t){t=s(t)?JSON.parse(t):t;for(var e,n=[Gi,ro,uo,Bi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[zh(Vh(),jh(),"json")]),Xh(io,"credential",function(t,e){return new no(t,e)},[Vh("email"),Vh("password")]),Hh(no.prototype,{w:{name:"toJSON",j:[Vh(null,!0)]}}),Hh(Hi.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Da:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Hi,"credential",Yi,[zh(Vh(),jh(),"token")]),Xh(io,"credentialWithLink",oo,[Vh("email"),Vh("emailLink")]),Hh(Xi.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Da:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(Xi,"credential",Ji,[zh(Vh(),jh(),"token")]),Hh($i.prototype,{ua:{name:"addScope",j:[Vh("scope")]},Da:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh($i,"credential",Zi,[zh(Vh(),zh(jh(),Gh()),"idToken"),zh(Vh(),Gh(),"accessToken",!0)]),Hh(to.prototype,{Da:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Xh(to,"credential",eo,[zh(Vh(),jh(),"token"),Vh("secret",!0)]),Hh(zi.prototype,{ua:{name:"addScope",j:[Vh("scope")]},credential:{name:"credential",j:[zh(Vh(),zh(jh(),Gh()),"optionsOrIdToken"),zh(Vh(),Gh(),"accessToken",!0)]},Da:{name:"setCustomParameters",j:[jh("customOAuthParameters")]}}),Hh(ji.prototype,{w:{name:"toJSON",j:[Vh(null,!0)]}}),Hh(Fi.prototype,{w:{name:"toJSON",j:[Vh(null,!0)]}}),Xh(ho,"credential",lo,[Vh("verificationId"),Vh("verificationCode")]),Hh(ho.prototype,{Va:{name:"verifyPhoneNumber",j:[Vh("phoneNumber"),Qh()]}}),Hh(so.prototype,{w:{name:"toJSON",j:[Vh(null,!0)]}}),Hh($r.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),Hh(Eo.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),Hh(wo.prototype,{toJSON:{name:"toJSON",j:[Vh(null,!0)]}}),Hh(Uh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===k||!k.INTERNAL||!k.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:ih,AuthCredential:Ui,Error:$r};Xh(t,"EmailAuthProvider",io,[]),Xh(t,"FacebookAuthProvider",Hi,[]),Xh(t,"GithubAuthProvider",Xi,[]),Xh(t,"GoogleAuthProvider",$i,[]),Xh(t,"TwitterAuthProvider",to,[]),Xh(t,"OAuthProvider",zi,[Vh("providerId")]),Xh(t,"SAMLAuthProvider",Qi,[Vh("providerId")]),Xh(t,"PhoneAuthProvider",ho,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof ih)}}]),Xh(t,"RecaptchaVerifier",Uh,[zh(Vh(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),jh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof k.app.App)}}]),k.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:T((t=new ih(t)).getUid,t),getToken:T(t.$b,t),addAuthTokenListener:T(t.Tb,t),removeAuthTokenListener:T(t.Bc,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),k.INTERNAL.extendNamespace({User:bc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var R,O="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},P=P||{},L=O;function M(t){return"string"==typeof t}function x(t){return"number"==typeof t}function U(t,e){t=t.split("."),e=e||L;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function q(){}function F(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function V(t){return"array"==F(t)}function B(t){var e=F(t);return"array"==e||"object"==e&&"number"==typeof t.length}function j(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var K="closure_uid_"+(1e9*Math.random()>>>0),G=0;function W(t,e,n){return t.call.apply(t.bind,arguments)}function Q(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function z(t,e,n){return(z=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?W:Q).apply(null,arguments)}function H(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var Y=Date.now||function(){return+new Date};function X(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function J(){this.j=this.j,this.i=this.i}J.prototype.j=!1,J.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[K]||(this[K]=++G)},J.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var $=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(M(t))return M(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=M(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function tt(t){return Array.prototype.concat.apply([],arguments)}function et(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function nt(t){return/^[\s\xa0]*$/.test(t)}var rt,it=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function ot(t,e){return-1!=t.indexOf(e)}function at(t,e){return t<e?-1:t>e?1:0}t:{var st=L.navigator;if(st){var ut=st.userAgent;if(ut){rt=ut;break t}}rt=""}function ct(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function ht(t){var e,n={};for(e in t)n[e]=t[e];return n}var lt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ft(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<lt.length;o++)n=lt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function pt(t){return pt[" "](t),t}pt[" "]=q;var dt,mt,yt=ot(rt,"Opera"),gt=ot(rt,"Trident")||ot(rt,"MSIE"),vt=ot(rt,"Edge"),bt=vt||gt,wt=ot(rt,"Gecko")&&!(ot(rt.toLowerCase(),"webkit")&&!ot(rt,"Edge"))&&!(ot(rt,"Trident")||ot(rt,"MSIE"))&&!ot(rt,"Edge"),Et=ot(rt.toLowerCase(),"webkit")&&!ot(rt,"Edge");function Tt(){var t=L.document;return t?t.documentMode:void 0}t:{var It="",St=(mt=rt,wt?/rv:([^\);]+)(\)|;)/.exec(mt):vt?/Edge\/([\d\.]+)/.exec(mt):gt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(mt):Et?/WebKit\/(\S+)/.exec(mt):yt?/(?:Version)[ \/]?(\S+)/.exec(mt):void 0);if(St&&(It=St?St[1]:""),gt){var At=Tt();if(null!=At&&At>parseFloat(It)){dt=String(At);break t}}dt=It}var Nt,Ct={};function _t(t){return function(t,e){var n=Ct;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=it(String(dt)).split("."),r=it(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=at(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||at(0==a[2].length,0==s[2].length)||at(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}var Dt=L.document;Nt=Dt&&gt?Tt()||("CSS1Compat"==Dt.compatMode?parseInt(dt,10):5):void 0;var kt=!gt||9<=Number(Nt),Rt=gt&&!_t("9"),Ot=function(){if(!L.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{L.addEventListener("test",q,e),L.removeEventListener("test",q,e)}catch(t){}return t}();function Pt(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function Lt(t,e){if(Pt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(wt){t:{try{pt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=M(t.pointerType)?t.pointerType:Mt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Pt.prototype.b=function(){this.Ja=!1},X(Lt,Pt);var Mt={2:"touch",3:"pen",4:"mouse"};Lt.prototype.b=function(){Lt.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Rt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var xt="closure_listenable_"+(1e6*Math.random()|0),Ut=0;function qt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Ut,this.X=this.Z=!1}function Ft(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Vt(t){this.src=t,this.a={},this.b=0}function Bt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=$(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Ft(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function jt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Vt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=jt(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new qt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Kt="closure_lm_"+(1e6*Math.random()|0),Gt={};function Wt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(V(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=Zt(r);return e&&e[xt]?e.Ba(n,r,j(i)?!!i.capture:!!i,o):Qt(e,n,r,!0,i,o)}(t,e,n,r,i);if(V(e)){for(var o=0;o<e.length;o++)Wt(t,e[o],n,r,i);return null}return n=Zt(n),t&&t[xt]?t.Aa(e,n,j(r)?!!r.capture:!!r,i):Qt(t,e,n,!1,r,i)}function Qt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=j(i)?!!i.capture:!!i;if(a&&!kt)return null;var s=Jt(t);if(s||(t[Kt]=s=new Vt(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=Xt,e=kt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Ot||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ht(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function zt(t){if(!x(t)&&t&&!t.X){var e=t.src;if(e&&e[xt])Bt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ht(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Jt(e))?(Bt(n,t),0==n.b&&(n.src=null,e[Kt]=null)):Ft(t)}}}function Ht(t){return t in Gt?Gt[t]:Gt[t]="on"+t}function Yt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&zt(t),n.call(r,e)}function Xt(t,e){return!!t.X||(kt?Yt(t,new Lt(e,this)):Yt(t,e=new Lt(e||U("window.event"),this)))}function Jt(t){return(t=t[Kt])instanceof Vt?t:null}var $t="__closure_events_fn_"+(1e9*Math.random()>>>0);function Zt(t){return"function"==F(t)?t:(t[$t]||(t[$t]=function(e){return t.handleEvent(e)}),t[$t])}function te(){J.call(this),this.c=new Vt(this),this.J=this,this.B=null}function ee(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Bt(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}X(te,J),te.prototype[xt]=!0,(R=te.prototype).addEventListener=function(t,e,n,r){Wt(this,t,e,n,r)},R.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(V(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=j(i)?!!i.capture:!!i,r=Zt(r),e&&e[xt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=jt(a=e.a[n],r,i,o))&&(Ft(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):e&&(e=Jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=jt(n,r,i,o)),(r=-1<e?n[e]:null)&&zt(r))}(this,t,e,n,r)},R.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(M(t))t=new Pt(t,n);else if(t instanceof Pt)t.target=t.target||n;else{var i=t;ft(t=new Pt(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=ee(a,r,!0,t)&&i}if(i=ee(a=t.a=n,r,!0,t)&&i,i=ee(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=ee(a=t.a=e[o],r,!1,t)&&i;return i},R.G=function(){if(te.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ft(n[r]);delete e.a[t],e.b--}}this.B=null},R.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},R.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var ne=L.JSON.stringify;function re(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function ie(){this.b=this.a=null}re.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var oe,ae=new re(function(){return new ue},function(t){t.reset()});function se(){var t=fe,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function ue(){this.next=this.b=this.a=null}function ce(t){L.setTimeout(function(){throw t},0)}function he(t,e){oe||function(){var t=L.Promise.resolve(void 0);oe=function(){t.then(pe)}}(),le||(oe(),le=!0),fe.add(t,e)}ie.prototype.add=function(t,e){var n=ae.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},ue.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},ue.prototype.reset=function(){this.next=this.b=this.a=null};var le=!1,fe=new ie;function pe(){for(var t;t=se();){try{t.a.call(t.b)}catch(t){ce(t)}var e=ae;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}le=!1}function de(t,e){te.call(this),this.b=t||1,this.a=e||L,this.f=z(this.gb,this),this.g=Y()}function me(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ye(t,e,n){if("function"==F(t))n&&(t=z(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=z(t.handleEvent,t)}return 2147483647<Number(e)?-1:L.setTimeout(t,e||0)}function ge(t,e,n){J.call(this),this.f=null!=n?z(t,n):t,this.c=e,this.b=z(this.ab,this),this.a=[]}function ve(t){t.U=ye(t.b,t.c),t.f.apply(null,t.a)}function be(t){J.call(this),this.b=t,this.a={}}X(de,te),(R=de.prototype).ba=!1,R.L=null,R.gb=function(){if(this.ba){var t=Y()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(me(this),this.start()))}},R.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Y())},R.G=function(){de.N.G.call(this),me(this),delete this.a},X(ge,J),(R=ge.prototype).ea=!1,R.U=null,R.Ua=function(t){this.a=arguments,this.U?this.ea=!0:ve(this)},R.G=function(){ge.N.G.call(this),this.U&&(L.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},R.ab=function(){this.U=null,this.ea&&(this.ea=!1,ve(this))},X(be,J);var we=[];function Ee(t,e,n,r){V(n)||(n&&(we[0]=n.toString()),n=we);for(var i=0;i<n.length;i++){var o=Wt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Te(t){ct(t.a,function(t,e){this.a.hasOwnProperty(e)&&zt(t)},t),t.a={}}function Ie(){}be.prototype.G=function(){be.N.G.call(this),Te(this)},be.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Se=new te;function Ae(t){Pt.call(this,"serverreachability",t)}function Ne(t){Se.dispatchEvent(new Ae(Se,t))}function Ce(t){Pt.call(this,"statevent",t)}function _e(t){Se.dispatchEvent(new Ce(Se,t))}function De(t){Pt.call(this,"timingevent",t)}function ke(t,e){if("function"!=F(t))throw Error("Fn must not be null and must be a function");return L.setTimeout(function(){t()},e)}X(Ae,Pt),X(Ce,Pt),X(De,Pt);var Re={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},Oe={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Pe(){}function Le(t){var e;return(e=t.a)||(e=t.a={}),e}function Me(){}Pe.prototype.a=null;var xe,Ue={OPEN:"a",ib:"b",Na:"c",rb:"d"};function qe(){Pt.call(this,"d")}function Fe(){Pt.call(this,"c")}function Ve(){}function Be(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new be(this),this.O=je,t=bt?125:void 0,this.P=new de(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}X(qe,Pt),X(Fe,Pt),X(Ve,Pe),xe=new Ve;var je=45e3,Ke={},Ge={};function We(t,e,n){t.F=1,t.f=gn(hn(e)),t.l=n,t.H=!0,ze(t,null)}function Qe(t,e,n,r){t.F=1,t.f=gn(hn(e)),t.l=null,t.H=n,ze(t,r)}function ze(t,e){t.v=Y(),Xe(t),t.D=hn(t.f),yn(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new ge(z(t.Ka,t,t.a),t.J)),Ee(t.I,t.a,"readystatechange",t.eb),e=t.h?ht(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),Ne(1)}function He(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Ye(t,n);if(i==Ge){4==e&&(t.c=4,_e(14),r=!1);break}if(i==Ke){t.c=4,_e(15),r=!1;break}en(t,i)}4==e&&0==n.length&&(t.c=1,_e(16),r=!1),t.b=t.b&&r,r||(tn(t),Ze(t))}function Ye(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Ge:(n=Number(e.substring(n,r)),isNaN(n)?Ke:(r+=1)+n>e.length?Ge:(e=e.substr(r,n),t.A=r+n,e))}function Xe(t){t.R=Y()+t.O,Je(t,t.O)}function Je(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=ke(z(t.bb,t),e)}function $e(t){t.i&&(L.clearTimeout(t.i),t.i=null)}function Ze(t){t.g.Da()||t.m||t.g.na(t)}function tn(t){$e(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,me(t.P),Te(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function en(t,e){try{t.g.Ga(t,e),Ne(4)}catch(t){}}function nn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(B(t)||M(t))Z(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(B(t)||M(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(M(t))return t.split("");if(B(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function rn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof rn)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function on(t,e){sn(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&an(t))}function an(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];sn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)sn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function sn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(R=Be.prototype).setTimeout=function(t){this.O=t},R.eb=function(t){t=t.target;var e=this.B;e&&3==cr(t)?e.Ua():this.Ka(t)},R.Ka=function(t){try{if(t==this.a)t:{var e=cr(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!bt&&!this.a.aa())){this.m||4!=e||7==n||Ne(8==n||0>=r?3:2),$e(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=hr(this.a,"X-HTTP-Initial-Response");if(a&&!nt(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,_e(12),tn(this),Ze(this);break t}this.s=!0,en(this,s)}this.H?(He(this,e,o),bt&&this.b&&3==e&&(Ee(this.I,this.P,"tick",this.cb),this.P.start())):en(this,o),4==e&&tn(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,Xe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,_e(12)):(this.c=0,_e(13)),tn(this),Ze(this)}}}catch(t){}},R.cb=function(){if(this.a){var t=cr(this.a),e=this.a.aa();this.A<e.length&&($e(this),He(this,t,e),this.b&&4!=t&&Xe(this))}},R.cancel=function(){this.m=!0,tn(this)},R.bb=function(){this.i=null;var t=Y();0<=t-this.R?(2!=this.F&&(Ne(3),_e(17)),tn(this),this.c=2,Ze(this)):Je(this,this.R-t)},(R=rn.prototype).C=function(){an(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},R.K=function(){return an(this),this.a.concat()},R.get=function(t,e){return sn(this.b,t)?this.b[t]:e},R.set=function(t,e){sn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},R.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var un=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function cn(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof cn?(this.h=void 0!==e?e:t.h,ln(this,t.f),this.j=t.j,fn(this,t.b),pn(this,t.i),this.a=t.a,dn(this,Rn(t.c)),this.g=t.g):t&&(n=String(t).match(un))?(this.h=!!e,ln(this,n[1]||"",!0),this.j=vn(n[2]||""),fn(this,n[3]||"",!0),pn(this,n[4]),this.a=vn(n[5]||"",!0),dn(this,n[6]||"",!0),this.g=vn(n[7]||"")):(this.h=!!e,this.c=new Nn(null,this.h))}function hn(t){return new cn(t)}function ln(t,e,n){t.f=n?vn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function fn(t,e,n){t.b=n?vn(e,!0):e}function pn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function dn(t,e,n){e instanceof Nn?(t.c=e,function(t,e){e&&!t.f&&(Cn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(_n(this,e),kn(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=bn(e,Sn)),t.c=new Nn(e,t.h))}function mn(t,e,n){t.c.set(e,n)}function yn(t,e,n){V(n)||(n=[String(n)]),kn(t.c,e,n)}function gn(t){return mn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Y()).toString(36)),t}function vn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function bn(t,e,n){return M(t)?(t=encodeURI(t).replace(e,wn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function wn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}cn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(bn(e,En,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(bn(e,En,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(bn(n,"/"==n.charAt(0)?In:Tn,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",bn(n,An)),t.join("")},cn.prototype.resolve=function(t){var e=hn(this),n=!!t.f;n?ln(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?fn(e,t.b):n=null!=t.i;var r=t.a;if(n)pn(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(ot(i,"./")||ot(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?dn(e,Rn(t.c)):n=!!t.g,n&&(e.g=t.g),e};var En=/[#\/\?@]/g,Tn=/[#\?:]/g,In=/[#\?]/g,Sn=/[#\?@]/g,An=/#/g;function Nn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Cn(t){t.a||(t.a=new rn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function _n(t,e){Cn(t),e=On(t,e),sn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,on(t.a,e))}function Dn(t,e){return Cn(t),e=On(t,e),sn(t.a.b,e)}function kn(t,e,n){_n(t,e),0<n.length&&(t.c=null,t.a.set(On(t,e),et(n)),t.b+=n.length)}function Rn(t){var e=new Nn;return e.c=t.c,t.a&&(e.a=new rn(t.a),e.b=t.b),e}function On(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Pn(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Ln(t){var e=t.a.F.a;if(null!=e)_e(4),e?(_e(10),Tr(t.a,t,!1)):(_e(11),Tr(t.a,t,!0));else{t.b=new Be(t,void 0,void 0),t.b.h=t.h,e=Cr(e=t.a,e.Y()?t.f:null,t.i),_e(4),yn(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&mn(e,n,r),Qe(t.b,e,!1,t.f)}}function Mn(){this.a=this.b=null}function xn(){this.a=new rn}function Un(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[K]||(t[K]=++G)):e.charAt(0)+t}function qn(t,e){this.b=t,this.a=e}function Fn(t){this.g=t||Vn,L.PerformanceNavigationTiming?t=0<(t=L.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(L.ka&&L.ka.Ea&&L.ka.Ea()&&L.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new xn),this.b=null,this.c=[]}(R=Nn.prototype).add=function(t,e){Cn(this),this.c=null,t=On(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},R.forEach=function(t,e){Cn(this),this.a.forEach(function(n,r){Z(n,function(n){t.call(e,n,r,this)},this)},this)},R.K=function(){Cn(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},R.C=function(t){Cn(this);var e=[];if(M(t))Dn(this,t)&&(e=tt(e,this.a.get(On(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=tt(e,t[n])}return e},R.set=function(t,e){return Cn(this),this.c=null,Dn(this,t=On(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},R.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},R.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},X(function(){},function(){}),(R=Pn.prototype).M=null,R.$=function(t){return this.a.$(t)},R.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},R.Da=function(){return!1},R.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=hr(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=hr(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void Ar(e,2)}this.f=r[0]}else(e=this.a).m=this.c,Ar(e,2)}else 1==this.M&&(this.g?_e(6):"11111"==e?(_e(5),this.g=!0,(!gt||10<=Number(Nt))&&(this.c=200,this.b.cancel(),_e(11),Tr(this.a,this,!0))):(_e(7),this.g=!1))},R.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Ln(this)):1==this.M&&(this.g?(_e(11),Tr(this.a,this,!0)):(_e(10),Tr(this.a,this,!1)));else{0==this.M?_e(8):1==this.M&&_e(9);var t=this.a;t.m=this.c,Ar(t,2)}},R.Y=function(){return this.a.Y()},R.ma=function(){return this.a.ma()},xn.prototype.add=function(t){this.a.set(Un(t),t)},xn.prototype.C=function(){return this.a.C()};var Vn=10;function Bn(t,e){!t.a&&(ot(e,"spdy")||ot(e,"quic")||ot(e,"h2"))&&(t.f=t.g,t.a=new xn,t.b&&(Wn(t,t.b),t.b=null))}function jn(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Kn(t){return t.b?1:t.a?t.a.a.c:0}function Gn(t,e){return t.b?t=t.b==e:t.a?(e=Un(e),t=sn(t.a.a.b,e)):t=!1,t}function Wn(t,e){t.a?t.a.add(e):t.b=e}function Qn(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Un(e),n=sn(t.a.a.b,n)),n&&on(t.a.a,Un(e)))}function zn(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return Z(t.a.C(),function(t){e=e.concat(t.j)}),e}return et(t.c)}function Hn(){}function Yn(){this.a=new Hn}function Xn(t,e,n){var r=n||"";try{nn(t,function(t,n){var i=t;j(t)&&(i=ne(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Jn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Fn.prototype.cancel=function(){var t;this.c=zn(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Z(this.a.C(),function(t){t.cancel()}),(t=this.a.a).b={},t.a.length=0,t.c=0)},Hn.prototype.stringify=function(t){return L.JSON.stringify(t,void 0)},Hn.prototype.parse=function(t){return L.JSON.parse(t,void 0)};var $n=L.JSON.parse;function Zn(t){te.call(this),this.headers=new rn,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=tr,this.D=this.F=!1}X(Zn,te);var tr="",er=/^https?$/i,nr=["POST","PUT"];function rr(t){return"content-type"==t.toLowerCase()}function ir(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,or(t),sr(t)}function or(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function ar(t){if(t.b&&void 0!==P&&(!t.s[1]||4!=cr(t)||2!=t.T()))if(t.l&&4==cr(t))ye(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==cr(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(un)[1]||null;if(!o&&L.self&&L.self.location){var a=L.self.location.protocol;o=a.substr(0,a.length-1)}i=!er.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",or(t))}finally{sr(t)}}}function sr(t,e){if(t.a){ur(t);var n=t.a,r=t.s[0]?q:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function ur(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(L.clearTimeout(t.m),t.m=null)}function cr(t){return t.a?t.a.readyState:0}function hr(t,e){return t.a?t.a.getResponseHeader(e):null}function lr(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return ct(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),M(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return mn(t,e,n),t}function fr(t){this.f=[],this.F=new Mn,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!U("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=U("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=U("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=U("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=U("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new Fn(t&&t.concurrentRequestLimit),this.ja=new Yn,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function pr(t){if(dr(t),3==t.u){var e=t.P++,n=hn(t.B);mn(n,"SID",t.H),mn(n,"RID",e),mn(n,"TYPE","terminate"),vr(t,n),(e=new Be(t,e,void 0)).F=2,e.f=gn(hn(n)),n=!1,L.navigator&&L.navigator.sendBeacon&&(n=L.navigator.sendBeacon(e.f.toString(),"")),!n&&L.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Y(),Xe(e)}Nr(t)}function dr(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(L.clearTimeout(t.l),t.l=null),Ir(t),t.b.cancel(),t.h&&(x(t.h)&&L.clearTimeout(t.h),t.h=null)}function mr(t,e){t.f.push(new qn(t.Ra++,e)),3==t.u&&yr(t)}function yr(t){jn(t.b)||t.h||(t.h=!0,he(t.Ia,t),t.A=0)}function gr(t,e){var n;n=e?e.W:t.P++;var r=hn(t.B);mn(r,"SID",t.H),mn(r,"RID",n),mn(r,"AID",t.O),vr(t,r),t.g&&t.i&&lr(r,t.g,t.i),n=new Be(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=br(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Wn(t.b,n),We(n,r,e)}function vr(t,e){t.c&&nn({},function(t,n){mn(e,n,t)})}function br(t,e,n){n=Math.min(t.f.length,n);var r=t.c?z(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),s=!1;else try{Xn(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function wr(t){t.a||t.l||(t.S=1,he(t.Ha,t),t.v=0)}function Er(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=ke(z(t.Ha,t),Sr(t,t.v)),t.v++,!0)}function Tr(t,e,n){var r=e.l;r&&Bn(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Cr(t,null,t.ha),yr(t)}function Ir(t){null!=t.s&&(L.clearTimeout(t.s),t.s=null)}function Sr(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function Ar(t,e){if(2==e){var n=null;t.c&&(n=null);var r=z(t.fb,t);n||(n=new cn("//www.google.com/images/cleardot.gif"),L.location&&"http"==L.location.protocol||ln(n,"https"),gn(n)),function(t,e){var n=new Ie;if(L.Image){var r=new Image;r.onload=H(Jn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=H(Jn,n,r,"TestLoadImage: error",!1,e),r.onabort=H(Jn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=H(Jn,n,r,"TestLoadImage: timeout",!1,e),L.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else _e(2);t.u=0,t.c&&t.c.ta(e),Nr(t),dr(t)}function Nr(t){t.u=0,t.m=-1,t.c&&(0==zn(t.b).length&&0==t.f.length||(t.b.c.length=0,et(t.f),t.f.length=0),t.c.sa())}function Cr(t,e,n){var r=function(t){return t instanceof cn?hn(t):new cn(t,void 0)}(n);if(""!=r.b)e&&fn(r,e+"."+r.b),pn(r,r.i);else{var i,o=L.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new cn(null,void 0);return t&&ln(i,t),e&&fn(i,e),n&&pn(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&ct(t.V,function(t,e){mn(r,e,t)}),e=t.j,n=t.I,e&&n&&mn(r,e,n),mn(r,"VER",t.wa),vr(t,r),r}function _r(){}function Dr(){if(gt&&!(10<=Number(Nt)))throw Error("Environmental error: no available transport.")}function kr(t,e){te.call(this),this.a=new fr(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!nt(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!nt(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Pr(this)}function Rr(t){qe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Or(){Fe.call(this),this.status=1}function Pr(t){this.a=t}(R=Zn.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Le(this.H):Le(xe),this.a.onreadystatechange=z(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void ir(this,t)}t=n||"";var i=new rn(this.headers);r&&nn(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=rr,n=t.length,r=M(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:M(t)?t.charAt(e):t[e]}(i.K()),n=L.FormData&&t instanceof L.FormData,!(0<=$(nr,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{ur(this),0<this.o&&((this.D=function(t){return gt&&_t(9)&&x(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=z(this.Ca,this)):this.m=ye(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){ir(this,t)}},R.Ca=function(){void 0!==P&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},R.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),sr(this))},R.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),sr(this,!0)),Zn.N.G.call(this)},R.Fa=function(){this.j||(this.w||this.l||this.g?ar(this):this.$a())},R.$a=function(){ar(this)},R.T=function(){try{return 2<cr(this)?this.a.status:-1}catch(t){return-1}},R.za=function(){try{return 2<cr(this)?this.a.statusText:""}catch(t){return""}},R.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},R.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),$n(e)}},R.ya=function(){return this.h},R.Ya=function(){return M(this.f)?this.f:String(this.f)},(R=fr.prototype).wa=8,R.u=1,R.Da=function(){return 0==this.u},R.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new Be(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?ft(r=ht(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&M(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=br(this,n,e),mn(i=hn(this.B),"RID",t),mn(i,"CVER",22),this.o&&this.j&&mn(i,"X-HTTP-Session-Id",this.j),vr(this,i),this.g&&r&&lr(i,this.g,r),Wn(this.b,n),this.W?(mn(i,"$req",e),mn(i,"SID","null"),n.S=!0,We(n,i,null)):We(n,i,e),this.u=2}}else 3==this.u&&(t?gr(this,t):0==this.f.length||jn(this.b)||gr(this))},R.Ha=function(){this.l=null,this.a=new Be(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=hn(this.pa);mn(t,"RID","rpc"),mn(t,"SID",this.H),mn(t,"CI",this.ia?"0":"1"),mn(t,"AID",this.O),vr(this,t),mn(t,"TYPE","xmlhttp"),this.g&&this.i&&lr(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Qe(this.a,t,!0,this.ga)},R.Ga=function(t,e){if(0!=this.u&&(this.a==t||Gn(this.b,t)))if(this.m=t.o,!t.s&&Gn(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(V(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Ir(this),this.a.cancel(),this.a=null}Er(this),_e(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=ke(z(this.Za,this),6e3));if(1>=Kn(this.b)&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else Ar(this,11)}else if((t.s||this.a==t)&&Ir(this),!nt(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&x(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=hr(r,"X-Client-Wire-Protocol"))&&Bn(this.b,i),this.j&&(r=hr(r,"X-HTTP-Session-Id")))&&(this.I=r,mn(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Cr(this,this.Y()?this.ga:null,this.ha),r.s?(Qn(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&($e(r),Xe(r)),this.a=r):wr(this),0<this.f.length&&yr(this)}else"stop"!=r[0]&&"close"!=r[0]||Ar(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?Ar(this,7):pr(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},R.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Er(this),_e(19))},R.na=function(t){var e=null;if(this.a==t){Ir(this),this.a=null;var n=2}else{if(!Gn(this.b,t))return;e=t.j,Qn(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Y()-t.v,Se.dispatchEvent(new De(Se,t.l?t.l.length:0,e,this.A)),yr(this)):wr(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Kn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa)||(t.h=ke(z(t.Ia,t,e),Sr(t,t.A)),t.A++,0)))}(this,t)||2==n&&Er(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:Ar(this,5);break;case 4:Ar(this,10);break;case 3:Ar(this,6);break;default:Ar(this,2)}}},R.fb=function(t){_e(t?2:1)},R.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Zn(this.La)).F=this.R,t},R.ma=function(){return!!this.c&&!0},R.Y=function(){return this.R},(R=_r.prototype).va=function(){},R.ua=function(){},R.ta=function(){},R.sa=function(){},R.Ta=function(){},Dr.prototype.a=function(t,e){return new kr(t,e)},X(kr,te),(R=kr.prototype).addEventListener=function(t,e,n,r){kr.N.addEventListener.call(this,t,e,n,r)},R.removeEventListener=function(t,e,n,r){kr.N.removeEventListener.call(this,t,e,n,r)},R.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;_e(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Pn(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=lr(e,t.g,t.i)),(t=t.w).i=n,e=Cr(t.a,null,t.i),_e(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Ln(t)):(yn(e,"MODE","init"),!t.a.o&&t.a.j&&yn(e,"X-HTTP-Session-Id",t.a.j),t.b=new Be(t,void 0,void 0),t.b.h=t.h,Qe(t.b,e,!1,null),t.M=0)},R.close=function(){pr(this.a)},R.Xa=function(t){if(M(t)){var e={};e.__data__=t,mr(this.a,e)}else this.h?((e={}).__data__=ne(t),mr(this.a,e)):mr(this.a,t)},R.G=function(){this.a.c=null,delete this.f,pr(this.a),delete this.a,kr.N.G.call(this)},X(Rr,qe),X(Or,Fe),X(Pr,_r),Pr.prototype.va=function(){this.a.dispatchEvent("a")},Pr.prototype.ua=function(t){this.a.dispatchEvent(new Rr(t))},Pr.prototype.ta=function(t){this.a.dispatchEvent(new Or(t))},Pr.prototype.sa=function(){this.a.dispatchEvent("b")};var Lr=H(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},Dr);Dr.prototype.createWebChannel=Dr.prototype.a,kr.prototype.send=kr.prototype.Xa,kr.prototype.open=kr.prototype.Wa,kr.prototype.close=kr.prototype.close,Re.NO_ERROR=0,Re.TIMEOUT=8,Re.HTTP_ERROR=6,Oe.COMPLETE="complete",Me.EventType=Ue,Ue.OPEN="a",Ue.CLOSE="b",Ue.ERROR="c",Ue.MESSAGE="d",te.prototype.listen=te.prototype.Aa,Zn.prototype.listenOnce=Zn.prototype.Ba,Zn.prototype.getLastError=Zn.prototype.Ya,Zn.prototype.getLastErrorCode=Zn.prototype.ya,Zn.prototype.getStatus=Zn.prototype.T,Zn.prototype.getStatusText=Zn.prototype.za,Zn.prototype.getResponseJson=Zn.prototype.Va,Zn.prototype.getResponseText=Zn.prototype.aa,Zn.prototype.send=Zn.prototype.ca;var Mr,xr={createWebChannelTransport:Lr,ErrorCode:Re,EventType:Oe,WebChannel:Me,XhrIo:Zn},Ur=xr.createWebChannelTransport,qr=xr.ErrorCode,Fr=xr.EventType,Vr=xr.WebChannel,Br=xr.XhrIo,jr=k.SDK_VERSION,Kr=new b("@firebase/firestore");function Gr(){return Kr.logLevel===p.DEBUG?Mr.DEBUG:Kr.logLevel===p.SILENT?Mr.SILENT:Mr.ERROR}function Wr(t){switch(t){case Mr.DEBUG:Kr.logLevel=p.DEBUG;break;case Mr.ERROR:Kr.logLevel=p.ERROR;break;case Mr.SILENT:Kr.logLevel=p.SILENT;break;default:Kr.error("Firestore ("+jr+"): Invalid value passed to `setLogLevel`")}}function Qr(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Kr.logLevel<=p.DEBUG){var i=n.map(Hr);Kr.debug.apply(Kr,["Firestore ("+jr+") ["+t+"]: "+e].concat(i))}}function zr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Kr.logLevel<=p.ERROR){var r=e.map(Hr);Kr.error.apply(Kr,["Firestore ("+jr+"): "+t].concat(r))}}function Hr(t){if("string"==typeof t)return t;var e=Jr.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function Yr(t){var e="FIRESTORE ("+jr+") INTERNAL ASSERTION FAILED: "+t;throw zr(e),new Error(e)}function Xr(t,e){t||Yr(e)}!function(t){t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT"}(Mr||(Mr={}));var Jr=function(){function t(){}return t.setPlatform=function(e){t.platform&&Yr("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||Yr("Platform not set"),t.platform},t}();function $r(){return Jr.getPlatform().emptyByteString}var Zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ti=function(t){function n(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return e(n,t),n}(Error);function ei(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new ti(Zr.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function ni(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ri(t,e){return void 0!==t?t:e}function ii(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function oi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ai(t){for(var e in Xr(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function si(t,e){if(0!==e.length)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Si(e.length,"argument")+".")}function ui(t,e,n){if(e.length!==n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires "+Si(n,"argument")+", but was called with "+Si(e.length,"argument")+".")}function ci(t,e,n){if(e.length<n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Si(n,"argument")+", but was called with "+Si(e.length,"argument")+".")}function hi(t,e,n,r){if(e.length<n||e.length>r)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Si(e.length,"argument")+".")}function li(t,e,n,r){gi(t,e,Ii(n)+" argument",r)}function fi(t,e,n,r){void 0!==r&&li(t,e,n,r)}function pi(t,e,n,r){gi(t,e,n+" option",r)}function di(t,e,n,r){void 0!==r&&pi(t,e,n,r)}function mi(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+bi(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+bi(r[o]))}(t,e,n,r,i)}function yi(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(bi(u))}var c=bi(r);throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function gi(t,e,n,r){if(!("object"===e?vi(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=bi(r);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function vi(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function bi(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Yr("Unknown wrong type: "+typeof t)}function wi(t,e,n){if(void 0===n)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Ii(e)+" argument, but it was undefined.")}function Ei(t,e,n){oi(e,function(e,r){if(n.indexOf(e)<0)throw new ti(Zr.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function Ti(t,e,n,r){var i=bi(r);return new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Ii(n)+" argument to be a "+e+", but it was: "+i)}function Ii(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Si(t,e){return t+" "+e+(1===t?"":"s")}var Ai=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Xr(20===e.length,"Invalid auto ID: "+e),e},t}();function Ni(t,e){return t<e?-1:t>e?1:0}function Ci(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function _i(t){return t+"\0"}function Di(){if("undefined"==typeof Uint8Array)throw new ti(Zr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ki(){if(!Jr.getPlatform().base64Available)throw new ti(Zr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ri,Oi=function(){function t(t){ki(),this._binaryString=t}return t.fromBase64String=function(e){ui("Blob.fromBase64String",arguments,1),li("Blob.fromBase64String","string",1,e),ki();try{return new t(Jr.getPlatform().atob(e))}catch(t){throw new ti(Zr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(ui("Blob.fromUint8Array",arguments,1),Di(),!(e instanceof Uint8Array))throw Ti("Blob.fromUint8Array","Uint8Array",1,e);return new t(Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join(""))},t.prototype.toBase64=function(){return ui("Blob.toBase64",arguments,0),ki(),Jr.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){ui("Blob.toUint8Array",arguments,0),Di();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return Ni(this._binaryString,t._binaryString)},t}(),Pi=ei(Oi,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Li=function(){return function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}}(),Mi="(default)",xi=function(){function t(t,e){this.projectId=t,this.database=e||Mi}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===Mi},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return Ni(this.projectId,t.projectId)||Ni(this.database,t.database)},t}(),Ui=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),qi=function(){function t(t,e,n){this.init(t,e,n)}return t.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&Yr("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Yr("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},t.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):"string"==typeof e?n.push(e):Yr("Unknown parameter type for Path.child(): "+e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,Xr(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return Xr(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return Xr(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return Xr(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Fi=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.canonicalString=function(){return this.toArray().join("/")},n.prototype.toString=function(){return this.canonicalString()},n.fromString=function(t){if(t.indexOf("//")>=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new n(t.split("/").filter(function(t){return t.length>0}))},n.EMPTY_PATH=new n([]),n}(qi),Vi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Bi=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.isValidIdentifier=function(t){return Vi.test(t)},n.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},n.prototype.toString=function(){return this.canonicalString()},n.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},n.keyField=function(){return new n(["__name__"])},n.fromServerFormat=function(t){for(var e=[],r="",i=0,o=function(){if(0===r.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new ti(Zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new ti(Zr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)},n.EMPTY_PATH=new n([]),n}(qi),ji=function(){function t(e){this.path=e,Xr(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Fi.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Fi.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Fi(e.slice()))},t.fromPathString=function(e){return new t(Fi.fromString(e))},t.EMPTY=new t(new Fi([])),t}(),Ki=function(){return function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}}();!function(t){t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection"}(Ri||(Ri={}));var Gi=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ki,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ti(Zr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),Wi=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var e=this;this.verifyNotFailed();var n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw zr("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Xr(e>=0,"Attempted to schedule an operation with a negative delay of "+e),Xr(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=Gi.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&Yr("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){Xr(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){Xr(t===Ri.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==Ri.All&&i.timerId===t)break}return e.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Xr(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Qi="",zi="",Hi="",Yi="";function Xi(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=$i(e)),e=Ji(t.get(n),e);return $i(e)}function Ji(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Qi+Hi;break;case Qi:n+=Qi+Yi;break;default:n+=o}}return n}function $i(t){return t+Qi+zi}function Zi(t){var e=t.length;if(Xr(e>=2,"Invalid path "+t),2===e)return Xr(t.charAt(0)===Qi&&t.charAt(1)===zi,"Non-empty path "+t+" had length 2"),Fi.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Qi,o);switch((a<0||a>n)&&Yr('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case zi:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Hi:i+=t.substring(o,a),i+="\0";break;case Yi:i+=t.substring(o,a+1);break;default:Yr('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Fi(r)}var to=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ti(Zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Ni(this.nanoseconds,t.nanoseconds):Ni(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),eo=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new to(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new to(0,0)),t}(),no=function(){function t(t,e){this.comparator=t,this.root=e||io.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,io.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,io.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ro(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ro(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ro(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ro(this.root,t,this.comparator,!0)},t}(),ro=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){Xr(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),io=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Yr("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Yr("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Yr("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),oo=function(){function t(){this.size=0}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new io(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();io.EMPTY=new oo;var ao=function(){function t(t){this.comparator=t,this.data=new no(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new so(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new so(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),so=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),uo=new no(ji.comparator);function co(){return uo}function ho(){return co()}var lo=new no(ji.comparator);function fo(){return lo}var po=new no(ji.comparator);function mo(){return po}var yo=new ao(ji.comparator);function go(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=yo,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var vo=new ao(Ni);function bo(){return vo}var wo=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r,Xr(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&Xr(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Xr(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&Xr(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime))}for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},go())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ci(this.mutations,t.mutations)&&Ci(this.baseMutations,t.baseMutations)},t}(),Eo=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){Xr(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=mo(),a=e.mutations,s=0;s<a.length;s++)o=o.insert(a[s].key,r[s].version);return new t(e,n,r,i,o)},t}(),To=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Yr("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++){r(o[i])}return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Io=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return Xr(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Co(t).iterate({index:pa.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=No(n),Do(t).put(e)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=No(e),Do(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=_o(t),a=Co(t);return a.add({}).next(function(s){Xr("number"==typeof s,"Auto-generated key is not a number");var u=new wo(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l],d=da.key(i.userId,p.key.path,s);h.push(a.put(c)),h.push(o.put(d,da.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,p.key.path.popLast()))}return To.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Co(t).get(e).next(function(t){return t?(Xr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?To.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Co(t).iterate({index:pa.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Xr(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()}).next(function(){return o})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Co(t).loadAll(pa.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=da.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return _o(t).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2],h=Zi(u);if(s===n.userId&&e.path.isEqual(h))return Co(t).get(c).next(function(t){if(!t)throw Yr("Dangling document-mutation reference found: "+r+" which points to "+c);Xr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});a.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ao(Ni),i=[];return e.forEach(function(e){var o=da.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=_o(t).iterate({range:a},function(t,i,o){var a=t[0],s=t[1],u=t[2],c=Zi(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(s)}),To.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;Xr(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Xr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=da.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new ao(Ni);return _o(t).iterate({range:a},function(t,e,o){var a=t[0],u=t[1],c=t[2],h=Zi(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,s)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Co(t).get(e).next(function(t){if(null===t)throw Yr("Dangling document-mutation reference found, which points to "+e);Xr(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),To.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return Ao(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),To.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return To.resolve();var r=IDBKeyRange.lowerBound(da.prefixForUser(e.userId)),i=[];return _o(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=Zi(t[1]);i.push(o)}else r.done()}).next(function(){Xr(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return So(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return Do(t).get(this.userId).next(function(t){return t||new fa(e.userId,-1,"")})},t}();function So(t,e,n){var r=da.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return _o(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],s=t[1];t[2];o===e&&s===i&&(a=!0),r.done()}).next(function(){return a})}function Ao(t,e,n){var r=t.store(pa.store),i=t.store(da.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Xr(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=da.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return To.waitFor(o).next(function(){return c})}function No(t){return t instanceof Uint8Array?(Xr("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function Co(t){return Ga.getStore(t,pa.store)}function _o(t){return Ga.getStore(t,da.store)}function Do(t){return Ga.getStore(t,fa.store)}var ko,Ro=1;!function(t){t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine"}(ko||(ko={}));var Oo=function(){function t(t,e){this.generatorId=t,Xr((t&Ro)===t,"Generator ID "+t+" contains more than "+Ro+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<Ro,t},t.prototype.after=function(t){return this.seek(t+(1<<Ro)),this.next()},t.prototype.seek=function(t){Xr((t&Ro)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(ko.QueryCache,2)},t.forSyncEngine=function(){return new t(ko.SyncEngine)},t}(),Po="SimpleDb",Lo=function(){function t(e){this.db=e,12.2===t.getIOSVersion(a())&&zr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.openOrCreate=function(e,n,r){return Xr(t.isAvailable(),"IndexedDB not supported in current environment."),Qr(Po,"Opening database:",e),new To(function(i,o){var a=window.indexedDB.open(e,n);a.onsuccess=function(e){var n=e.target.result;i(new t(n))},a.onblocked=function(){o(new ti(Zr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new ti(Zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},a.onupgradeneeded=function(t){Qr(Po,'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result,i=new xo(a.transaction);r.createOrUpgrade(n,i,t.oldVersion,ua).next(function(){Qr(Po,"Database upgrade to version "+ua+" complete")})}}).toPromise()},t.delete=function(t){return Qr(Po,"Removing database:",t),qo(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var e=a(),n=t.getIOSVersion(e),r=0<n&&n<10,i=t.getAndroidVersion(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.getStore=function(t,e){return t.store(e)},t.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},t.prototype.runTransaction=function(t,e,n){var r=xo.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),To.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},t.prototype.close=function(){this.db.close()},t}(),Mo=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return qo(this.dbCursor.delete())},t}(),xo=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Ki,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=Vo(t.target.error);e.completionDeferred.reject(n)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Qr(Po,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return Xr(!!e,"Object store not part of transaction: "+t),new Uo(e)},t}(),Uo=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Qr(Po,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(Qr(Po,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),qo(n)},t.prototype.add=function(t){return Qr(Po,"ADD",this.store.name,t,t),qo(this.store.add(t))},t.prototype.get=function(t){var e=this;return qo(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Qr(Po,"GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Qr(Po,"DELETE",this.store.name,t),qo(this.store.delete(t))},t.prototype.count=function(){return Qr(Po,"COUNT",this.store.name),qo(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){Qr(Po,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new To(function(n,r){e.onerror=function(t){var e=Vo(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new To(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Mo(i),a=e(i.primaryKey,i.value,o);if(a instanceof To){var s=a.catch(function(t){return o.done(),To.reject(t)});n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return To.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Xr(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function qo(t){return new To(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Vo(t.target.error);n(e)}})}var Fo=!1;function Vo(t){var e=Lo.getIOSVersion(a());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new ti("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Fo||(Fo=!0,setTimeout(function(){throw r},0)),r}}return t}var Bo=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=Oo.forQueryCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return eo.fromTimestamp(new to(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return Go(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return jo(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return Xr(e.targetCount>0,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return jo(t).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return To.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return jo(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return Ko(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,Ga.getStore(n,Ea.store)).put(Ea.key,e);var n},t.prototype.saveQueryData=function(t,e){return jo(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return jo(t).iterate({range:i,index:ba.queryTargetsIndexName},function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.query)&&(o=a,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Wo(t);return e.forEach(function(e){var a=Xi(e.path);i.push(o.put(new wa(n,a))),i.push(r.referenceDelegate.addReference(t,e))}),To.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Wo(t);return To.forEach(e,function(e){var o=Xi(e.path);return To.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Wo(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Wo(t),i=go();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Zi(t[1]),o=new ji(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Xi(e.path),r=IDBKeyRange.bound([n],[_i(n)],!1,!0),i=0;return Wo(t).iterate({index:wa.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1];0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return jo(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function jo(t){return Ga.getStore(t,ba.store)}function Ko(t){return Lo.getStore(t,Ea.store).get(Ea.key).next(function(t){return Xr(null!==t,"Missing metadata row."),t})}function Go(t){return Ko(t).next(function(t){return t.highestListenSequenceNumber})}function Wo(t){return Ga.getStore(t,wa.store)}var Qo=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return ji.comparator(t.key,e.key)},t}(),zo=function(t){function n(e,n,r,i,o){var a=t.call(this,e,n)||this;return a.data=r,a.proto=o,a.hasLocalMutations=!!i.hasLocalMutations,a.hasCommittedMutations=!!i.hasCommittedMutations,a}return e(n,t),n.prototype.field=function(t){return this.data.field(t)},n.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},n.prototype.value=function(){return this.data.value()},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},n.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),n.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Yr("Trying to compare documents on fields that don't exist")},n}(Qo),Ho=function(t){function n(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return e(n,t),n.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(Qo),Yo=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(n.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),n.prototype.isEqual=function(t){return t instanceof n&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n}(Qo),Xo=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){oi(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}})},t.prototype.isEmpty=function(){return ai(this.inner)},t}(),Jo=function(){function t(){this.changes=co(),this.documentSizes=new Xo(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?To.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return Xr(null!==this.changes,"Changes have already been applied."),this.changes},t}(),$o="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",Zo=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=Lo.getStore(t,Sa.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(e.length>0){for(var i=na(t),o=go(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(ia(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(ra(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return To.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=na(t),r=ia(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return oa(t)}):To.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return na(t).get(ia(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return na(t).get(ia(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:oa(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=ho();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=ho(),i=new no(ji.comparator);return this.forEachDbEntry(t,e,function(t,e){e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i=i.insert(t,oa(e))):(r=r.insert(t,null),i=i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return To.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return na(t).iterate({range:r},function(t,e,r){for(var a=ji.fromSegments(t);o&&ji.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;Xr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=fo(),i=e.path.length+1,o=e.path.toArray(),a=IDBKeyRange.lowerBound(o);return na(t).iterate({range:a},function(t,o,a){if(t.length===i){var s=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(s.key.path)?s instanceof zo&&e.matches(s)&&(r=r.insert(s.key,s)):a.done()}}).next(function(){return r})},t.prototype.getNewDocumentChanges=function(t){var e=this;Xr(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=go(),r=co(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=ra(t);return a.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(a).next(function(){return To.reject(new ti(Zr.DATA_LOSS,$o))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new Ho(n,eo.forDeletedDoc());r=r.insert(n,e)}))}),To.waitFor(i)}).next(function(){return r})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return ra(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},t.prototype.newChangeBuffer=function(){return new ea(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return ta(t).get(va.key).next(function(t){return Xr(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return ta(t).put(va.key,e)},t.prototype.updateSize=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.setMetadata(t,r)})},t}();function ta(t){return Ga.getStore(t,va.store)}var ea=function(t){function n(e){var n=t.call(this)||this;return n.documentCache=e,n}return e(n,t),n.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentCache.serializer.toDbRemoteDocument(n),a=e.documentSizes.get(t);Xr(void 0!==a,"Attempting to change document "+t.toString()+" without having read it first");var s=oa(o);r+=s-a,i.push({key:t,doc:o})}),this.documentCache.addEntries(t,i,r)},n.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},n.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},n}(Jo);function na(t){return Ga.getStore(t,ga.store)}function ra(t){return Ga.getStore(t,Sa.store)}function ia(t){return t.path.toArray()}function oa(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Yr("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var aa=function(){function t(){this.collectionParentIndex=new sa}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),To.resolve()},t.prototype.getCollectionParents=function(t,e){return To.resolve(this.collectionParentIndex.getEntries(e))},t}(),sa=function(){function t(){this.index={}}return t.prototype.add=function(t){Xr(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ao(Fi.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new ao(Fi.comparator)).toArray()},t}(),ua=8,ca=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Xr(n<r&&n>=0&&r<=ua,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&r>=1&&(function(t){t.createObjectStore(la.store)}(t),function(t){t.createObjectStore(fa.store,{keyPath:fa.keyPath}),t.createObjectStore(pa.store,{keyPath:pa.keyPath,autoIncrement:!0}).createIndex(pa.userMutationsIndex,pa.userMutationsKeyPath,{unique:!0}),t.createObjectStore(da.store)}(t),Ia(t),function(t){t.createObjectStore(ga.store)}(t));var o=To.resolve();return n<3&&r>=3&&(0!==n&&(!function(t){t.deleteObjectStore(wa.store),t.deleteObjectStore(ba.store),t.deleteObjectStore(Ea.store)}(t),Ia(t)),o=o.next(function(){return function(t){var e=t.store(Ea.store),n=new Ea(0,0,eo.MIN.toTimestamp(),0);return e.put(Ea.key,n)}(e)})),n<4&&r>=4&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(pa.store).loadAll().next(function(n){t.deleteObjectStore(pa.store);var r=t.createObjectStore(pa.store,{keyPath:pa.keyPath,autoIncrement:!0});r.createIndex(pa.userMutationsIndex,pa.userMutationsKeyPath,{unique:!0});var i=e.store(pa.store),o=n.map(function(t){return i.put(t)});return To.waitFor(o)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(Aa.store,{keyPath:Aa.keyPath})}(t),function(t){t.createObjectStore(Sa.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&r>=5&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&r>=6&&(o=o.next(function(){return function(t){t.createObjectStore(va.store)}(t),i.addDocumentGlobal(e)})),n<7&&r>=7&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&r>=8&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(ga.store).iterate(function(t,n){e+=oa(n)}).next(function(){var n=new va(e);return t.store(va.store).put(va.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(fa.store),r=t.store(pa.store);return n.loadAll().next(function(n){return To.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(pa.userMutationsIndex,i).next(function(r){return To.forEach(r,function(r){Xr(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return Ao(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(wa.store),n=t.store(ga.store);return Go(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new Fi(n),a=function(t){return[0,Xi(t)]}(o);r.push(e.get(a).next(function(n){return n?To.resolve():function(n){return e.put(new wa(0,Xi(n),t))}(o)}))}).next(function(){return To.waitFor(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Ta.store,{keyPath:Ta.keyPath});var n=e.store(Ta.store),r=new sa,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Xi(i)})}};return e.store(ga.store).iterate({keysOnly:!0},function(t,e){var n=new Fi(t);return i(n.popLast())}).next(function(){return e.store(da.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],Zi(n));return i(r.popLast())})})},t}();var ha=function(){return function(t,e){this.seconds=t,this.nanoseconds=e}}(),la=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var fa=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),pa=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var da=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Xi(e)]},t.key=function(t,e,n){return[t,Xi(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var ma=function(){return function(t,e){this.path=t,this.readTime=e}}(),ya=function(){return function(t,e){this.path=t,this.version=e}}(),ga=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),va=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var ba=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),wa=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,Xr(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),Ea=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),Ta=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function Ia(t){t.createObjectStore(wa.store,{keyPath:wa.keyPath}).createIndex(wa.documentTargetsIndex,wa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ba.store,{keyPath:ba.keyPath}).createIndex(ba.queryTargetsIndexName,ba.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ea.store)}var Sa=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}();var Aa=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}();var Na,Ca=[fa.store,pa.store,da.store,ga.store,ba.store,la.store,Ea.store,wa.store].concat([Aa.store,Sa.store]).concat([va.store]).concat([Ta.store]),_a=function(){function t(){this.collectionParentsCache=new sa}return t.prototype.addToCollectionParentIndex=function(t,e){if(Xr(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Xr(e.length>=1,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return Da(t).put({collectionId:n,parent:Xi(r)})}return To.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[_i(e),""],!1,!0);return Da(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Zi(o.parent))}return n})},t}();function Da(t){return Ga.getStore(t,Ta.store)}!function(t){t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution"}(Na||(Na={}));var ka=function(){function t(t,e,n,r,i,o){void 0===i&&(i=eo.MIN),void 0===o&&(o=$r()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return t.prototype.copy=function(e){return new t(this.query,this.targetId,this.purpose,void 0===e.sequenceNumber?this.sequenceNumber:e.sequenceNumber,void 0===e.snapshotVersion?this.snapshotVersion:e.snapshotVersion,void 0===e.resumeToken?this.resumeToken:e.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},t}(),Ra=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=ji.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Ho(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=ji.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new Yo(e,n)}return Yr("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof zo){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new ga(null,null,e,n)}if(t instanceof Ho){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);n=t.hasCommittedMutations;return new ga(null,new ma(r,i),null,n)}if(t instanceof Yo){r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return new ga(new ya(r,i),null,null,!0)}return Yr("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new ha(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new to(t.seconds,t.nanoseconds);return eo.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new pa(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=to.fromMillis(t.localWriteTimeMs);return new wo(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Xi(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=go(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new ji(Zi(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new ka(e,t.targetId,Na.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){Xr(Na.Listen===t.purpose,"Only queries with purpose "+Na.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),t.resumeToken instanceof Uint8Array?(Xr("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new ba(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function Oa(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Ni(n,i);return 0===a?Ni(r,o):a}var Pa=function(){function t(t){this.maxElements=t,this.buffer=new ao(Oa),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Oa(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),La={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ma=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),xa=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}return t.prototype.start=function(){Xr(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Ma.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;Xr(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Qr("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Ri.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Wa)})},t}(),Ua=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return To.resolve(Ui.INVALID);var r=new Pa(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Ma.COLLECTION_DISABLED?(Qr("LruGarbageCollector","Garbage collection skipped; disabled"),To.resolve(La)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Qr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),La):n.runGarbageCollection(t,e)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Qr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){(u=Date.now(),Gr()<=Mr.DEBUG)&&Qr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms");return To.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),qa=function(){return function(){}}(),Fa="IndexedDbPersistence",Va="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ba="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",ja="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",Ka=function(t){function n(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return e(n,t),n}(qa),Ga=function(){function t(e,n,r,i,o,a,s){if(this.persistenceKey=e,this.clientId=n,this.queue=i,this.multiClientParams=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!t.isAvailable())throw new ti(Zr.UNIMPLEMENTED,ja);if(this.referenceDelegate=new Xa(this,a),this.dbName=e+t.MAIN_DATABASE,this.serializer=new Ra(o),this.document=r.document,this.allowTabSynchronization=void 0!==s,this.queryCache=new Bo(this.referenceDelegate,this.serializer),this.indexManager=new _a,this.remoteDocumentCache=new Zo(this.serializer,this.indexManager,this.allowTabSynchronization),!r.window||!r.window.localStorage)throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof Ka)return Lo.getStore(t.simpleDbTransaction,e);throw Yr("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e,n,o,a,s,u){return r(this,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return[4,(r=new t(e,n,o,a,s,u)).start()];case 1:return i.sent(),[2,r]}})})},t.createMultiClientIndexedDbPersistence=function(e,n,o,a,s,u,c){return r(this,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return[4,(r=new t(e,n,o,a,s,u,c)).start()];case 1:return i.sent(),[2,r]}})})},t.prototype.start=function(){var t=this;return Xr(!this.started,"IndexedDbPersistence double-started!"),Xr(null!==this.window,"Expected 'window' to be defined"),Lo.openOrCreate(this.dbName,ua,new ca(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()}).then(function(){return t.simpleDb.runTransaction("readonly",[Ea.store],function(e){return Go(e).next(function(e){var n=t.multiClientParams?t.multiClientParams.sequenceNumberSyncer:void 0;t.listenSequence=new Ui(e,n)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},t.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",Ca,function(e){return t.remoteDocumentCache.start(e)})},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return r(e,void 0,void 0,function(){return i(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener(function(n){return r(e,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return r(e,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",Ca,function(e){return za(e).put(new Aa(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},t.prototype.verifyPrimaryLease=function(t){var e=this;return Qa(t).get(la.key).next(function(t){return To.resolve(e.isLocalClient(t))})},t.prototype.removeClientMetadata=function(t){return za(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return r(this,void 0,void 0,function(){var e,n,r=this;return i(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),n=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=t.getStore(i,Aa.store);return o.loadAll().next(function(t){e=r.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)})}).next(function(){return To.forEach(n,function(t){return o.delete(t.clientId)})}).next(function(){if((e=e.filter(function(t){return t.clientId!==r.clientId})).length>0){var t=e.map(function(t){return t.lastProcessedDocumentChangeId||0}),n=Math.min.apply(Math,t);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})]);case 1:i.sent(),n.forEach(function(t){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(t.clientId))}),i.label=2;case 2:return[2]}})})},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Ri.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return Qa(t).get(la.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,Ba);return!1}}return!(!e.networkEnabled||!e.inForeground)||za(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&Qr(Fa,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[la.store,Aa.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[Aa.store],function(e){return za(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},t.clearPersistence=function(e){return r(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return t.isAvailable()?(n=e+t.MAIN_DATABASE,[4,Lo.delete(n)]):[2,Promise.resolve()];case 1:return r.sent(),[2]}})})},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return Xr(this.started,"Cannot initialize MutationQueue before persistence is started."),Io.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},t.prototype.getQueryCache=function(){return Xr(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},t.prototype.getRemoteDocumentCache=function(){return Xr(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.getIndexManager=function(){return Xr(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},t.prototype.runTransaction=function(t,e,n){var r=this;return Qr(Fa,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",Ca,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw zr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new ti(Zr.FAILED_PRECONDITION,Va);return n(new Ka(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new Ka(i,r.listenSequence.next()))})})},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Qa(t).get(la.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new ti(Zr.FAILED_PRECONDITION,Ba)})},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new la(this.clientId,this.allowTabSynchronization,Date.now());return Qa(t).put(la.key,e)},t.isAvailable=function(){return Lo.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Qa(t);return n.get(la.key).next(function(t){return e.isLocalClient(t)?(Qr(Fa,"Releasing primary lease."),n.delete(la.key)):To.resolve()})},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(t>n)||(zr("Detected an update time that is in the future: "+t+" > "+n),!1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Xr(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Xr("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Qr(Fa,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return zr(Fa,"Failed to get zombied client id.",t),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){zr("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function Wa(t){return r(this,void 0,void 0,function(){return i(this,function(e){if(!function(t){return t.code===Zr.FAILED_PRECONDITION&&t.message===Va}(t))throw t;return Qr(Fa,"Unexpectedly lost primary lease"),[2]})})}function Qa(t){return t.store(la.store)}function za(t){return t.store(Aa.store)}var Ha,Ya,Xa=function(){function t(t,e){this.db=t,this.garbageCollector=new Ua(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return Ja(t,e)},t.prototype.removeReference=function(t,e){return Ja(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return Ja(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?To.resolve(!0):function(t,e){var n=!1;return Do(t).iterateSerial(function(r){return So(t,r,e).next(function(t){return t&&(n=!0),To.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=0,o=[];return this.forEachOrphanedDocument(t,function(a,s){if(s<=e){var u=n.isPinned(t,a).next(function(e){if(!e)return r++,n.removeOrphanedDocument(t,a).next(function(t){i+=t})});o.push(u)}}).next(function(){return To.waitFor(o)}).next(function(){return n.db.getRemoteDocumentCache().updateSize(t,-i)}).next(function(){return r})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return To.waitFor([Wo(t).delete((n=e,[0,Xi(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Ja(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=Wo(t),i=Ui.INVALID;return r.iterate({index:wa.documentTargetsIndex},function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==Ui.INVALID&&e(new ji(Zi(n)),i),i=s,n=a):i=Ui.INVALID}).next(function(){i!==Ui.INVALID&&e(new ji(Zi(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Ja(t,e){return Wo(t).put(function(t,e){return new wa(0,Xi(t.path),e)}(e,t.currentSequenceNumber))}!function(t){t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue"}(Ha||(Ha={})),function(t){t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous"}(Ya||(Ya={}));var $a=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(Ya.Estimate,n);case"previous":return new t(Ya.Previous,n);case"none":case void 0:return new t(Ya.Default,n);default:return Yr("fromSnapshotOptions() called with invalid options.")}},t}(),Za=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return Xr(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Ni(this.typeOrder,t.typeOrder)},t}(),ts=function(t){function n(){var e=t.call(this)||this;return e.typeOrder=Ha.NullValue,e.internalValue=null,e}return e(n,t),n.prototype.value=function(t){return null},n.prototype.isEqual=function(t){return t instanceof n},n.prototype.compareTo=function(t){return t instanceof n?0:this.defaultCompareTo(t)},n.INSTANCE=new n,n}(Za),es=function(t){function n(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ha.BooleanValue,n}return e(n,t),n.prototype.value=function(t){return this.internalValue},n.prototype.isEqual=function(t){return t instanceof n&&this.internalValue===t.internalValue},n.prototype.compareTo=function(t){return t instanceof n?Ni(this,t):this.defaultCompareTo(t)},n.of=function(t){return t?n.TRUE:n.FALSE},n.TRUE=new n(!0),n.FALSE=new n(!1),n}(Za),ns=function(t){function n(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ha.NumberValue,n}return e(n,t),n.prototype.value=function(t){return this.internalValue},n.prototype.compareTo=function(t){return t instanceof n?(e=this.internalValue,r=t.internalValue,e<r?-1:e>r?1:e===r?0:isNaN(e)?isNaN(r)?0:-1:1):this.defaultCompareTo(t);var e,r},n}(Za);function rs(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var is,os=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.isEqual=function(t){return t instanceof n&&rs(this.internalValue,t.internalValue)},n}(ns),as=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.isEqual=function(t){return t instanceof n&&rs(this.internalValue,t.internalValue)},n.NAN=new n(NaN),n.POSITIVE_INFINITY=new n(1/0),n.NEGATIVE_INFINITY=new n(-1/0),n}(ns),ss=function(t){function n(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ha.StringValue,n}return e(n,t),n.prototype.value=function(t){return this.internalValue},n.prototype.isEqual=function(t){return t instanceof n&&this.internalValue===t.internalValue},n.prototype.compareTo=function(t){return t instanceof n?Ni(this.internalValue,t.internalValue):this.defaultCompareTo(t)},n}(Za),us=function(t){function n(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ha.TimestampValue,n}return e(n,t),n.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},n.prototype.isEqual=function(t){return t instanceof n&&this.internalValue.isEqual(t.internalValue)},n.prototype.compareTo=function(t){return t instanceof n?this.internalValue._compareTo(t.internalValue):t instanceof cs?-1:this.defaultCompareTo(t)},n}(Za),cs=function(t){function n(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=Ha.TimestampValue,r}return e(n,t),n.prototype.value=function(t){return t&&t.serverTimestampBehavior===Ya.Estimate?new us(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===Ya.Previous&&this.previousValue?this.previousValue.value(t):null},n.prototype.isEqual=function(t){return t instanceof n&&this.localWriteTime.isEqual(t.localWriteTime)},n.prototype.compareTo=function(t){return t instanceof n?this.localWriteTime._compareTo(t.localWriteTime):t instanceof us?1:this.defaultCompareTo(t)},n.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},n}(Za),hs=function(t){function n(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ha.BlobValue,n}return e(n,t),n.prototype.value=function(t){return this.internalValue},n.prototype.isEqual=function(t){return t instanceof n&&this.internalValue.isEqual(t.internalValue)},n.prototype.compareTo=function(t){return t instanceof n?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},n}(Za),ls=function(t){function n(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=Ha.RefValue,r}return e(n,t),n.prototype.value=function(t){return this.key},n.prototype.isEqual=function(t){return t instanceof n&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},n.prototype.compareTo=function(t){if(t instanceof n){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:ji.comparator(this.key,t.key)}return this.defaultCompareTo(t)},n}(Za),fs=function(t){function n(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ha.GeoPointValue,n}return e(n,t),n.prototype.value=function(t){return this.internalValue},n.prototype.isEqual=function(t){return t instanceof n&&this.internalValue.isEqual(t.internalValue)},n.prototype.compareTo=function(t){return t instanceof n?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},n}(Za),ps=function(t){function n(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ha.ObjectValue,n}return e(n,t),n.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},n.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},n.prototype.isEqual=function(t){if(t instanceof n){for(var e=this.internalValue.getIterator(),r=t.internalValue.getIterator();e.hasNext()&&r.hasNext();){var i=e.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!e.hasNext()&&!r.hasNext()}return!1},n.prototype.compareTo=function(t){if(t instanceof n){for(var e=this.internalValue.getIterator(),r=t.internalValue.getIterator();e.hasNext()&&r.hasNext();){var i=e.getNext(),o=r.getNext(),a=Ni(i.key,o.key)||i.value.compareTo(o.value);if(a)return a}return Ni(e.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},n.prototype.set=function(t,e){if(Xr(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var r=this.child(t.firstSegment());r instanceof n||(r=n.EMPTY);var i=r.set(t.popFirst(),e);return this.setChild(t.firstSegment(),i)},n.prototype.delete=function(t){if(Xr(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new n(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof n){var r=e.delete(t.popFirst());return new n(this.internalValue.insert(t.firstSegment(),r))}return this},n.prototype.contains=function(t){return null!==this.field(t)},n.prototype.field=function(t){Xr(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof n?e.internalValue.get(t):null}),e},n.prototype.fieldMask=function(){var t=new ao(Bi.comparator);return this.internalValue.forEach(function(e,r){var i=new Bi([e]);if(r instanceof n){var o=r.fieldMask().fields;o.isEmpty()?t=t.add(i):o.forEach(function(e){t=t.add(i.child(e))})}else t=t.add(i)}),ms.fromSet(t)},n.prototype.toString=function(){return this.internalValue.toString()},n.prototype.child=function(t){return this.internalValue.get(t)||void 0},n.prototype.setChild=function(t,e){return new n(this.internalValue.insert(t,e))},n.EMPTY=new n(new no(Ni)),n}(Za),ds=function(t){function n(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ha.ArrayValue,n}return e(n,t),n.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},n.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++){if(n[e].isEqual(t))return!0}return!1},n.prototype.forEach=function(t){this.internalValue.forEach(t)},n.prototype.isEqual=function(t){if(t instanceof n){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},n.prototype.compareTo=function(t){if(t instanceof n){for(var e=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<e;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return Ni(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},n.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},n}(Za),ms=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new ao(Bi.comparator);return e.forEach(function(t){return n=n.add(t)}),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),ys=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),gs=function(){return function(t,e){this.version=t,this.transformResults=e}}();!function(t){t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete"}(is||(is={}));var vs=function(){function t(t,e){this.updateTime=t,this.exists=e,Xr(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof zo&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof zo:(Xr(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),bs=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&Xr(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof zo?t.version:eo.MIN},t}(),ws=function(t){function n(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=is.Set,i}return e(n,t),n.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Xr(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new zo(this.key,n,this.value,{hasCommittedMutations:!0})},n.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=bs.getPostMutationVersion(t);return new zo(this.key,r,this.value,{hasLocalMutations:!0})},n.prototype.extractBaseValue=function(t){return null},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},n}(bs),Es=function(t){function n(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=is.Patch,o}return e(n,t),n.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Xr(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Yo(this.key,e.version);var n=this.patchDocument(t);return new zo(this.key,e.version,n,{hasCommittedMutations:!0})},n.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=bs.getPostMutationVersion(t),i=this.patchDocument(t);return new zo(this.key,r,i,{hasLocalMutations:!0})},n.prototype.extractBaseValue=function(t){return null},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},n.prototype.patchDocument=function(t){var e;return e=t instanceof zo?t.data:ps.EMPTY,this.patchObject(e)},n.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}}),t},n}(bs),Ts=function(t){function n(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=is.Transform,r.precondition=vs.exists(!0),r}return e(n,t),n.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Xr(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Yo(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new zo(this.key,i,o,{hasCommittedMutations:!0})},n.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data,i);return new zo(this.key,r.version,o,{hasLocalMutations:!0})},n.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof zo?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?ps.EMPTY.set(i.field,a):e.set(i.field,a))}return e},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&Ci(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},n.prototype.requireDocument=function(t){Xr(t instanceof zo,"Unknown MaybeDocument type "+t);var e=t;return Xr(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},n.prototype.serverTransformResults=function(t,e){var n=[];Xr(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof zo&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},n.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof zo&&(u=e.field(a.field)),null===u&&n instanceof zo&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},n.prototype.transformObject=function(t,e){Xr(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},n}(bs),Is=function(t){function n(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=is.Delete,r}return e(n,t),n.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Xr(null==e.transformResults,"Transform results received by DeleteMutation."),new Ho(this.key,e.version,{hasCommittedMutations:!0})},n.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Xr(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Ho(this.key,eo.forDeletedDoc())):t},n.prototype.extractBaseValue=function(t){return null},n.prototype.isEqual=function(t){return t instanceof n&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},n}(bs),Ss=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++){t=i[r].applyToLocalView(e,t)}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=ho();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++){e=o[i].applyToLocalView(t,e)}r=r.insert(t,e)}),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=co();return i.forEach(function(t,e){e||(e=new Ho(t,eo.forDeletedDoc())),o=o.insert(t,e)}),o})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new ji(e)).next(function(t){var e=fo();return t instanceof zo&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;Xr(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=fo();return this.indexManager.getCollectionParents(t,r).next(function(o){return To.forEach(o,function(o){var a=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,a).next(function(t){t.forEach(function(t,e){i=i.insert(t,e)})})}).next(function(){return i})})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r,i=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(r){return n=r,i.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return r=e,i.addMissingBaseDocuments(t,r,n).next(function(t){n=t;for(var e=0,i=r;e<i.length;e++)for(var o=i[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof zo?n.insert(c,l):n.remove(c)}})}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},t.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=go(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Es&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof zo&&(c=c.insert(t,e))}),c})},t}(),As=function(){function t(){this.refsByKey=new ao(Ns.compareByKey),this.refsByTarget=new ao(Ns.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new Ns(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new Ns(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=ji.EMPTY,r=new Ns(n,t),i=new Ns(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=ji.EMPTY,n=new Ns(e,t),r=new Ns(e,t+1),i=go();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Ns(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Ns=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return ji.comparator(t.key,e.key)||Ni(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return Ni(t.targetOrBatchId,e.targetOrBatchId)||ji.comparator(t.key,e.key)},t}(),Cs=function(){function t(t,e){this.persistence=t,this.localViewReferences=new As,this.queryDataByTarget={},Xr(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new Ss(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return t.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new Ss(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],a=go(),s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p];o.push(c.batchId);for(var m=0,y=c.mutations;m<y.length;m++){f=y[m];a=a.add(f.key)}}return e.localDocuments.getDocuments(n,a).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},t.prototype.localWrite=function(t){var e=this,n=to.now(),r=t.reduce(function(t,e){return t.add(e.key)},go());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return e.localDocuments.getDocuments(i,r).next(function(r){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a],c=u.extractBaseValue(r.get(u.key));null!=c&&o.push(new Es(u.key,c,c.fieldMask(),vs.exists(!0)))}return e.mutationQueue.addMutationBatch(i,n,o,t).next(function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}})})})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):To.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return Xr(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(i){var o=[],a=go();ii(e.targetChanges,function(r,s){var u=n.queryDataByTarget[r];if(u){s.addedDocuments.forEach(function(t){a=a.add(t)}),s.modifiedDocuments.forEach(function(t){a=a.add(t)}),o.push(n.queryCache.removeMatchingKeys(i,s.removedDocuments,r).next(function(){return n.queryCache.addMatchingKeys(i,s.addedDocuments,r)}));var c=s.resumeToken;if(c.length>0){var h=u;u=u.copy({resumeToken:c,snapshotVersion:e.snapshotVersion}),n.queryDataByTarget[r]=u,t.shouldPersistQueryData(h,u,s)&&o.push(n.queryCache.updateQueryData(i,u))}}});var s=co(),u=go();e.documentUpdates.forEach(function(t,e){u=u.add(t)}),o.push(r.getEntries(i,u).next(function(t){e.documentUpdates.forEach(function(u,c){var h=t.get(u);null==h||c.version.isEqual(eo.MIN)||a.has(c.key)&&!h.hasPendingWrites||c.version.compareTo(h.version)>=0?(r.addEntry(c),s=s.insert(u,c)):Qr("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.resolvedLimboDocuments.has(u)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))})}));var c=e.snapshotVersion;if(!c.isEqual(eo.MIN)){var h=n.queryCache.getLastRemoteSnapshotVersion(i).next(function(t){return Xr(c.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+c+" < "+t),n.queryCache.setTargetsMetadata(i,i.currentSequenceNumber,c)});o.push(h)}return To.waitFor(o).next(function(){return r.apply(i)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(i,s)})})},t.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0))},t.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return To.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),To.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,To.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new ka(t,i,Na.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return Xr(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r,r})})},t.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){Xr(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,a=n.queryDataByTarget[o],s=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?To.resolve():To.forEach(s,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,a)})})})},t.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=To.resolve();return o.forEach(function(r){a=a.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,a=e.docVersions.get(r);Xr(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):Xr(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),a.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},t.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),_s=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=$r(),this.batchesByDocumentKey=new ao(Ns.compareByKey)}return t.prototype.checkEmpty=function(t){return To.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Xr(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Xr(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,To.resolve()},t.prototype.getLastStreamToken=function(t){return To.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,To.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){Xr(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;(this.nextBatchId++,this.mutationQueue.length>0)&&Xr(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new wo(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Ns(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return To.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return To.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Xr(null!=n,"Failed to find local mutation batch."),To.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return To.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(t){return To.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Ns(e,0),i=new Ns(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){Xr(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);Xr(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),To.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ao(Ni);return e.forEach(function(t){var e=new Ns(t,0),i=new Ns(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){Xr(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),To.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Xr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;ji.isDocumentKey(i)||(i=i.child(""));var o=new Ns(new ji(i),0),a=new ao(Ni);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),To.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Xr(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return To.forEach(e.mutations,function(i){var o=new Ns(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new Ns(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return To.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Xr(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),To.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Xr(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Xr(n.batchId===t,"If found batch must match"),n},t}(),Ds=function(){function t(t){this.persistence=t,this.queries=new Xo(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=eo.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new As,this.targetCount=0,this.targetIdGenerator=Oo.forQueryCache()}return t.prototype.getTargetCount=function(t){return To.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),To.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return To.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return To.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,To.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),To.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return Xr(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,To.resolve()},t.prototype.updateQueryData=function(t,e){return Xr(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),To.resolve()},t.prototype.removeQueryData=function(t,e){return Xr(this.targetCount>0,"Removing a target from an empty cache"),Xr(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,To.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(a,s){s.sequenceNumber<=e&&!n[s.targetId]&&(r.queries.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),To.waitFor(o).next(function(){return i})},t.prototype.getQueryCount=function(t){return To.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return To.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return Yr("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),To.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),To.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),To.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return To.resolve(n)},t.prototype.containsKey=function(t,e){return To.resolve(this.references.containsKey(e))},t}();var ks=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new no(ji.comparator),this.newDocumentChanges=go(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,To.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,To.resolve(n.size)):To.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return To.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return To.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=ho();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),To.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=ho(),i=new no(ji.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),To.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){Xr(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=fo(),r=new ji(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof zo&&e.matches(s)&&(n=n.insert(s.key,s))}return To.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return To.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var e=this,n=co();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new Ho(t,eo.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=go(),To.resolve(n)},t.prototype.newChangeBuffer=function(){return new Rs(this.sizer,this)},t.prototype.getSize=function(t){return To.resolve(this.size)},t}(),Rs=function(t){function n(e,n){var r=t.call(this)||this;return r.sizer=e,r.documentCache=n,r}return e(n,t),n.prototype.applyChanges=function(t){var e=this,n=this.assertChanges(),r=0,i=[];return n.forEach(function(t,n){var o=e.documentSizes.get(t);Xr(void 0!==o,"Attempting to change document "+t.toString()+" without having read it first");var a=e.sizer(n);r+=a-o,i.push({maybeDocument:n,size:a})}),this.documentCache.addEntries(t,i,r)},n.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},n.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},n}(Jo),Os=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Ui(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new Ds(this);this.indexManager=new aa,this.remoteDocumentCache=new ks(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n,r){return new t(e,function(t){return new Ms(t,new Ra(n),r)})},t.createEagerPersistence=function(e){return new t(e,function(t){return new Ls(t)})},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(t){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new _s(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getQueryCache=function(){return this.queryCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;Qr("MemoryPersistence","Starting transaction:",t);var i=new Ps(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},t.prototype.mutationQueuesContainKey=function(t,e){return To.or((n=this.mutationQueues,r=[],oi(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),Ps=function(){return function(t){this.currentSequenceNumber=t}}(),Ls=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),To.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),To.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),To.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache();return To.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(e){return e?To.resolve():n.removeEntry(t,r).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return To.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return To.resolve(n.inMemoryPins.containsKey(e))}])},t}(),Ms=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new Xo(function(t){return Xi(t.path)}),this.garbageCollector=new Ua(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return To.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return To.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?To.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache();return i.forEachDocumentKey(t,function(o){return n.isPinned(t,o,e).next(function(e){return e?To.resolve():(r++,i.removeEntry(t,o).next())})}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),To.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),To.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),To.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),To.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Yr("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return To.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return To.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return To.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),xs=Number,Us=xs.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),qs=xs.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Fs=xs.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Vs(t){return null==t}function Bs(t){return Fs(t)&&t<=qs&&t>=Us}var js,Ks=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&Qr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}();!function(t){t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff"}(js||(js={}));var Gs,Ws,Qs=1e3,zs=6e4,Hs=1.5,Ys=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=js.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Ks(t,e,Qs,Hs,zs)}return t.prototype.isStarted=function(){return this.state===js.Starting||this.state===js.Open||this.state===js.Backoff},t.prototype.isOpen=function(){return this.state===js.Open},t.prototype.start=function(){this.state!==js.Error?(Xr(this.state===js.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(js.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){Xr(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=js.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return this.isOpen()?[2,this.close(js.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return r(this,void 0,void 0,function(){return i(this,function(n){switch(n.label){case 0:return Xr(this.isStarted(),"Only started streams should be closed."),Xr(t===js.Error||Vs(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==js.Error?this.backoff.reset():e&&e.code===Zr.RESOURCE_EXHAUSTED?(zr(e.toString()),zr("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Zr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;Xr(this.state===js.Initial,"Must be in initial state to auth"),this.state=js.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new ti(Zr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;Xr(this.state===js.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Xr(e.state===js.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=js.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;Xr(this.state===js.Error,"Should only perform backoff when in Error state"),this.state=js.Backoff,this.backoff.backoffAndRun(function(){return r(t,void 0,void 0,function(){return i(this,function(t){return Xr(this.state===js.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=js.Initial,this.start(),Xr(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return Xr(this.isStarted(),"Can't handle server close on non-started stream"),Qr("PersistentStream","close with error: "+t),this.stream=null,this.close(js.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(Qr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Xs=function(t){function n(e,n,r,i,o){var a=t.call(this,e,Ri.ListenStreamConnectionBackoff,Ri.ListenStreamIdle,n,r,o)||this;return a.serializer=i,a}return e(n,t),n.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},n.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},n.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},n.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},n}(Ys),Js=function(t){function n(e,n,r,i,o){var a=t.call(this,e,Ri.WriteStreamConnectionBackoff,Ri.WriteStreamIdle,n,r,o)||this;return a.serializer=i,a.handshakeComplete_=!1,a}return e(n,t),Object.defineProperty(n.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),n.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},n.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},n.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},n.prototype.onMessage=function(t){if(Xr(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Xr(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},n.prototype.writeHandshake=function(){Xr(this.isOpen(),"Writing handshake requires an opened stream"),Xr(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},n.prototype.writeMutations=function(t){var e=this;Xr(this.isOpen(),"Writing mutations requires an opened stream"),Xr(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Xr(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},n}(Ys),$s=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Js(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Xs(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=co();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);Xr(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===Zr.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),Zs=function(){function t(t){this.datastore=t,this.readVersions=mo(),this.mutations=[],this.committed=!1,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return r(this,void 0,void 0,function(){var e,n=this;return i(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new ti(Zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach(function(t){t instanceof Ho||t instanceof zo?n.recordVersion(t):Yr("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},t.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},t.prototype.delete=function(t){this.write([new Is(t,this.precondition(t))]),this.writtenDocs.add(t)},t.prototype.commit=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach(function(e){t=t.remove(e.key)}),!t.isEmpty())throw new ti(Zr.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t instanceof zo)e=t.version;else{if(!(t instanceof Ho))throw Yr("Document in a transaction was a "+t.constructor.name);e=eo.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new ti(Zr.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?vs.updateTime(e):vs.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(!this.writtenDocs.has(t)&&e){if(e.isEqual(eo.forDeletedDoc()))throw new ti(Zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return vs.updateTime(e)}return vs.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},t.prototype.ensureCommitNotCalled=function(){Xr(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline"}(Gs||(Gs={})),function(t){t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState"}(Ws||(Ws={}));var tu,eu=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Gs.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Gs.Unknown),Xr(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Ri.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Xr(t.state===Gs.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Gs.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===Gs.Online?(this.setAndBroadcast(Gs.Unknown),Xr(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Xr(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Gs.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Gs.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(zr(e),this.shouldWarnClientIsOffline=!1):Qr("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}();function nu(t){switch(t){case Zr.OK:return Yr("Treated status OK as error");case Zr.CANCELLED:case Zr.UNKNOWN:case Zr.DEADLINE_EXCEEDED:case Zr.RESOURCE_EXHAUSTED:case Zr.INTERNAL:case Zr.UNAVAILABLE:case Zr.UNAUTHENTICATED:return!1;case Zr.INVALID_ARGUMENT:case Zr.NOT_FOUND:case Zr.ALREADY_EXISTS:case Zr.PERMISSION_DENIED:case Zr.FAILED_PRECONDITION:case Zr.ABORTED:case Zr.OUT_OF_RANGE:case Zr.UNIMPLEMENTED:case Zr.DATA_LOSS:return!0;default:return Yr("Unknown status code: "+t)}}function ru(t){if(void 0===t)return zr("GRPC error has no .code"),Zr.UNKNOWN;switch(t){case tu.OK:return Zr.OK;case tu.CANCELLED:return Zr.CANCELLED;case tu.UNKNOWN:return Zr.UNKNOWN;case tu.DEADLINE_EXCEEDED:return Zr.DEADLINE_EXCEEDED;case tu.RESOURCE_EXHAUSTED:return Zr.RESOURCE_EXHAUSTED;case tu.INTERNAL:return Zr.INTERNAL;case tu.UNAVAILABLE:return Zr.UNAVAILABLE;case tu.UNAUTHENTICATED:return Zr.UNAUTHENTICATED;case tu.INVALID_ARGUMENT:return Zr.INVALID_ARGUMENT;case tu.NOT_FOUND:return Zr.NOT_FOUND;case tu.ALREADY_EXISTS:return Zr.ALREADY_EXISTS;case tu.PERMISSION_DENIED:return Zr.PERMISSION_DENIED;case tu.FAILED_PRECONDITION:return Zr.FAILED_PRECONDITION;case tu.ABORTED:return Zr.ABORTED;case tu.OUT_OF_RANGE:return Zr.OUT_OF_RANGE;case tu.UNIMPLEMENTED:return Zr.UNIMPLEMENTED;case tu.DATA_LOSS:return Zr.DATA_LOSS;default:return Yr("Unknown status code: "+t)}}function iu(t){if(void 0===t)return tu.OK;switch(t){case Zr.OK:return tu.OK;case Zr.CANCELLED:return tu.CANCELLED;case Zr.UNKNOWN:return tu.UNKNOWN;case Zr.DEADLINE_EXCEEDED:return tu.DEADLINE_EXCEEDED;case Zr.RESOURCE_EXHAUSTED:return tu.RESOURCE_EXHAUSTED;case Zr.INTERNAL:return tu.INTERNAL;case Zr.UNAVAILABLE:return tu.UNAVAILABLE;case Zr.UNAUTHENTICATED:return tu.UNAUTHENTICATED;case Zr.INVALID_ARGUMENT:return tu.INVALID_ARGUMENT;case Zr.NOT_FOUND:return tu.NOT_FOUND;case Zr.ALREADY_EXISTS:return tu.ALREADY_EXISTS;case Zr.PERMISSION_DENIED:return tu.PERMISSION_DENIED;case Zr.FAILED_PRECONDITION:return tu.FAILED_PRECONDITION;case Zr.ABORTED:return tu.ABORTED;case Zr.OUT_OF_RANGE:return tu.OUT_OF_RANGE;case Zr.UNIMPLEMENTED:return tu.UNIMPLEMENTED;case Zr.DATA_LOSS:return tu.DATA_LOSS;default:return Yr("Unknown status code: "+t)}}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}(tu||(tu={}));var ou,au,su=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||ji.comparator(e.key,n.key)}:function(t,e){return ji.comparator(t.key,e.key)},this.keyedMap=fo(),this.sortedSet=new no(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();!function(t){t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata"}(ou||(ou={})),function(t){t[t.Local=0]="Local",t[t.Synced=1]="Synced"}(au||(au={}));var uu,cu=function(){function t(){this.changeMap=new no(ji.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==ou.Added&&n.type===ou.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===ou.Metadata&&n.type!==ou.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===ou.Modified&&n.type===ou.Modified?this.changeMap=this.changeMap.insert(e,{type:ou.Modified,doc:t.doc}):t.type===ou.Modified&&n.type===ou.Added?this.changeMap=this.changeMap.insert(e,{type:ou.Added,doc:t.doc}):t.type===ou.Removed&&n.type===ou.Added?this.changeMap=this.changeMap.remove(e):t.type===ou.Removed&&n.type===ou.Modified?this.changeMap=this.changeMap.insert(e,{type:ou.Removed,doc:n.doc}):t.type===ou.Added&&n.type===ou.Removed?this.changeMap=this.changeMap.insert(e,{type:ou.Modified,doc:t.doc}):Yr("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),hu=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:ou.Added,doc:t})}),new t(e,n,su.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),lu=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=fu.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(eo.MIN,i,bo(),co(),go())},t}(),fu=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t($r(),n,go(),go(),go())},t}(),pu=function(){return function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r}}(),du=function(){return function(t,e){this.targetId=t,this.existenceFilter=e}}();!function(t){t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset"}(uu||(uu={}));var mu=function(){return function(t,e,n,r){void 0===n&&(n=$r()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}(),yu=function(){function t(){this.pendingResponses=0,this.documentChanges=bu(),this._resumeToken=$r(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=go(),e=go(),n=go();return this.documentChanges.forEach(function(r,i){switch(i){case ou.Added:t=t.add(r);break;case ou.Modified:e=e.add(r);break;case ou.Removed:n=n.add(r);break;default:Yr("Encountered invalid change type: "+i)}}),new fu(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=bu()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),gu=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=co(),this.pendingDocumentTargetMapping=vu(),this.pendingTargetResets=new ao(Ni)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof zo?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Ho&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case uu.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case uu.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case uu.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),Xr(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case uu.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case uu.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Yr("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):ii(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new ji(i.path);this.removeDocumentFromTarget(e,o,new Ho(o,eo.forDeletedDoc()))}else Xr(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};ii(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new ji(o.query.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new Ho(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=go();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===Na.LimboResolution||(i=!1,!1)}),i&&(r=r.add(t))});var i=new lu(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=co(),this.pendingDocumentTargetMapping=vu(),this.pendingTargetResets=new ao(Ni),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?ou.Modified:ou.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,ou.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new yu),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new ao(Ni),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||Qr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;Xr(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new yu,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function vu(){return new no(ji.comparator)}function bu(){return new no(ji.comparator)}var wu="RemoteStore",Eu=function(){function t(t,e,n,o,a){var s=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=a,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return r(s,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Qr(wu,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new eu(n,o),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Gs.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Gs.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(Qr(wu,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return Qr(wu,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(Gs.Unknown),[2]}})})},t.prototype.listen=function(t){Xr(!ni(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){Xr(ni(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),ai(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Gs.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){Xr(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new gu(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!ai(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){return ii(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){return void 0===t&&Xr(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(Gs.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return r(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(Gs.Online),t instanceof mu&&t.state===uu.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof pu?this.watchChangeAggregator.handleDocumentChange(t):t instanceof du?this.watchChangeAggregator.handleExistenceFilter(t):(Xr(t instanceof mu,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(eo.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;Xr(!t.isEqual(eo.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return ii(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.copy({resumeToken:r.resumeToken,snapshotVersion:t}))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.copy({resumeToken:$r()}),e.sendUnwatchRequest(t);var r=new ka(n.query,t,Na.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;Xr(!!t.cause,"Handling target error without a cause");var n=t.cause,o=Promise.resolve();return t.targetIds.forEach(function(t){o=o.then(function(){return r(e,void 0,void 0,function(){return i(this,function(e){return ni(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),o},t.prototype.fillWritePipeline=function(){return r(this,void 0,void 0,function(){var t,e;return i(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){Xr(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){Xr(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(Wa)},t.prototype.onMutationResult=function(t,e){var n=this;Xr(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Eo.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return r(this,void 0,void 0,function(){var e=this;return i(this,function(n){return void 0===t&&Xr(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){return nu(t.code)?(Qr(wu,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=$r(),[2,this.localStore.setLastStreamToken($r()).catch(Wa)]):[2]})})},t.prototype.handleWriteError=function(t){return r(this,void 0,void 0,function(){var e,n=this;return i(this,function(r){return nu(i=t.code)&&i!==Zr.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2];var i})})},t.prototype.createTransaction=function(){return new Zs(this.datastore)},t.prototype.restartNetwork=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Gs.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},t.prototype.handleCredentialChange=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Qr(wu,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.applyPrimaryState=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(Gs.Unknown),e.label=4;case 4:return[2]}})})},t}(),Tu=function(){function t(t,e){if(ui("GeoPoint",arguments,2),li("GeoPoint","number",1,t),li("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new ti(Zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ti(Zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return Ni(this._lat,t._lat)||Ni(this._long,t._long)},t}(),Iu=function(){function t(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[Mu]:this.memoizedOrderBy=[new Lu(t),Mu];else{Xr(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:Ou.ASCENDING;this.memoizedOrderBy.push(a===Ou.ASCENDING?Mu:xu)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){Xr(null==this.getInequalityFilterField()||!(e instanceof Nu)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Xr(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){Xr(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.withLimit=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}Vs(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),Vs(this.limit)||(t+=", limit: "+this.limit),this.explicitOrderBy.length>0&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Xr(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimit=function(){return!Vs(this.limit)},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Nu&&n.isInequality())return n.field}return null},t.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof Nu&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.isDocumentQuery=function(){return ji.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):ji.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){Xr(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),Su=function(){return function(){}}(),Au=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;case"in":return t.IN;case"array-contains-any":return t.ARRAY_CONTAINS_ANY;default:return Yr("Unknown FieldFilter operator: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t.IN=new t("in"),t.ARRAY_CONTAINS_ANY=new t("array-contains-any"),t}(),Nu=function(t){function n(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return e(n,t),n.create=function(t,e,r){if(t.isKeyField())return e===Au.IN?(Xr(r instanceof ds,"Comparing on key with IN, but filter value not an ArrayValue"),Xr(r.internalValue.every(function(t){return t instanceof ls}),"Comparing on key with IN, but an array value was not a RefValue"),new _u(t,r)):(Xr(r instanceof ls,"Comparing on key, but filter value not a RefValue"),Xr(e!==Au.ARRAY_CONTAINS&&e!==Au.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new Cu(t,e,r));if(r.isEqual(ts.INSTANCE)){if(e!==Au.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new n(t,e,r)}if(r.isEqual(as.NAN)){if(e!==Au.EQUAL)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new n(t,e,r)}return e===Au.ARRAY_CONTAINS?new Du(t,r):e===Au.IN?(Xr(r instanceof ds,"IN filter has invalid value: "+r.toString()),new ku(t,r)):e===Au.ARRAY_CONTAINS_ANY?(Xr(r instanceof ds,"ARRAY_CONTAINS_ANY filter has invalid value: "+r.toString()),new Ru(t,r)):new n(t,e,r)},n.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},n.prototype.matchesComparison=function(t){switch(this.op){case Au.LESS_THAN:return t<0;case Au.LESS_THAN_OR_EQUAL:return t<=0;case Au.EQUAL:return 0===t;case Au.GREATER_THAN:return t>0;case Au.GREATER_THAN_OR_EQUAL:return t>=0;default:return Yr("Unknown FieldFilter operator: "+this.op)}},n.prototype.isInequality=function(){return[Au.LESS_THAN,Au.LESS_THAN_OR_EQUAL,Au.GREATER_THAN,Au.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0},n.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},n.prototype.isEqual=function(t){return t instanceof n&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},n.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},n}(Su),Cu=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.matches=function(t){var e=this.value,n=ji.comparator(t.key,e.key);return this.matchesComparison(n)},n}(Nu),_u=function(t){function n(e,n){var r=t.call(this,e,Au.IN,n)||this;return r.value=n,r}return e(n,t),n.prototype.matches=function(t){return this.value.internalValue.some(function(e){return t.key.isEqual(e.key)})},n}(Nu),Du=function(t){function n(e,n){return t.call(this,e,Au.ARRAY_CONTAINS,n)||this}return e(n,t),n.prototype.matches=function(t){var e=t.field(this.field);return e instanceof ds&&e.contains(this.value)},n}(Nu),ku=function(t){function n(e,n){var r=t.call(this,e,Au.IN,n)||this;return r.value=n,r}return e(n,t),n.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},n}(Nu),Ru=function(t){function n(e,n){var r=t.call(this,e,Au.ARRAY_CONTAINS_ANY,n)||this;return r.value=n,r}return e(n,t),n.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof ds&&n.internalValue.some(function(t){return e.value.contains(t)})},n}(Nu),Ou=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),Pu=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){Xr(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Xr(o instanceof ls,"Bound has a non-key value where the key path is being used."),n=ji.comparator(o.key,e.key);else{var a=e.field(i.field);Xr(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===Ou.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},t}(),Lu=function(){function t(t,e){this.field=t,void 0===e&&(e=Ou.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?zo.compareByKey(t,e):zo.compareByField(this.field,t,e);switch(this.dir){case Ou.ASCENDING:return n;case Ou.DESCENDING:return-1*n;default:return Yr("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),Mu=new Lu(Bi.keyField(),Ou.ASCENDING),xu=new Lu(Bi.keyField(),Ou.DESCENDING),Uu=function(){function t(){}return t.prototype.applyToLocalView=function(t,e){return new cs(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),qu=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=Bu(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new ds(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&Ci(e.elements,this.elements)},t}(),Fu=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=Bu(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new ds(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&Ci(e.elements,this.elements)},t}(),Vu=function(){function t(t){this.operand=t}return t.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof os&&this.operand instanceof os){var r=n.internalValue+this.operand.internalValue;return new os(r)}r=n.internalValue+this.operand.internalValue;return new as(r)},t.prototype.applyToRemoteDocument=function(t,e){return Xr(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.computeBaseValue=function(t){return t instanceof ns?t:new os(0)},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function Bu(t){return t instanceof ds?t.internalValue.slice():[]}var ju,Ku,Gu=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),Wu=((ju={})[Ou.ASCENDING.name]="ASCENDING",ju[Ou.DESCENDING.name]="DESCENDING",ju),Qu=((Ku={})[Au.LESS_THAN.name]="LESS_THAN",Ku[Au.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",Ku[Au.GREATER_THAN.name]="GREATER_THAN",Ku[Au.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",Ku[Au.EQUAL.name]="EQUAL",Ku[Au.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",Ku[Au.IN.name]="IN",Ku[Au.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",Ku),zu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Hu(t,e){Xr(!Vs(t),e+" is missing")}function Yu(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Yr("can't parse "+t)}var Xu=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Zr.UNKNOWN:ru(t.code);return new ti(e,t.message||"")},t.prototype.toInt32Value=function(t){return Vs(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return Vs(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Xr(!!t,"Cannot deserialize null or undefined timestamp.");var e=Yu(t.seconds||"0"),n=t.nanos||0;return new to(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=zu.exec(t);if(Xr(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new to(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(Xr(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Oi.fromBase64String(t)):(Xr(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Oi.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return Xr(!!t,"Trying to deserialize version that isn't set"),eo.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=Fi.fromString(t);return Xr(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return Xr(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Xr(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new ji(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Fi.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new Fi(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new Fi(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return Xr(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof ts)return{nullValue:"NULL_VALUE"};if(t instanceof es)return{booleanValue:t.value()};if(t instanceof os)return{integerValue:""+t.value()};if(t instanceof as){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof ss?{stringValue:t.value()}:t instanceof ps?{mapValue:this.toMapValue(t)}:t instanceof ds?{arrayValue:this.toArrayValue(t)}:t instanceof us?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof fs?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof hs?{bytesValue:this.toBytes(t.value())}:t instanceof ls?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Yr("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return ts.INSTANCE;if("booleanValue"in t)return es.of(t.booleanValue);if("integerValue"in t)return new os(Yu(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return as.NAN;if("Infinity"===t.doubleValue)return as.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return as.NEGATIVE_INFINITY}return new as(t.doubleValue)}if("stringValue"in t)return new ss(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){Hu(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new ds(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return Hu(t.timestampValue,"timestampValue"),new us(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){Hu(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new fs(new Tu(r,i))}if("bytesValue"in t){Hu(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new hs(o)}if("referenceValue"in t){Hu(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new xi(a.get(1),a.get(3)),u=new ji(this.extractLocalPathFromResourceName(a));return new ls(s,u)}return Yr("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return Xr(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new zo(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=t,r=ps.EMPTY;return oi(n,function(t,n){r=r.set(new Bi([t]),e.fromValue(n))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){Xr(!!t.found,"Tried to deserialize a found document from a missing document."),Hu(t.found.name,"doc.found.name"),Hu(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new zo(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){Xr(!!t.missing,"Tried to deserialize a missing document from a found document."),Xr(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Ho(e,n)},t.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Yr("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case uu.Added:return"ADD";case uu.Current:return"CURRENT";case uu.NoChange:return"NO_CHANGE";case uu.Removed:return"REMOVE";case uu.Reset:return"RESET";default:return Yr("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof du)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof pu){if(t.newDoc instanceof zo){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Ho){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof mu){var n=void 0;return t.cause&&(n={code:iu(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Yr("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e;if("targetChange"in t){Hu(t.targetChange,"targetChange");var n=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=t.targetChange.resumeToken||this.emptyByteString(),o=t.targetChange.cause,a=o&&this.fromRpcStatus(o);e=new mu(n,r,i,a||null)}else if("documentChange"in t){Hu(t.documentChange,"documentChange"),Hu(t.documentChange.document,"documentChange.name"),Hu(t.documentChange.document.name,"documentChange.document.name"),Hu(t.documentChange.document.updateTime,"documentChange.document.updateTime");var s=t.documentChange,u=this.fromName(s.document.name),c=this.fromVersion(s.document.updateTime),h=this.fromFields(s.document.fields||{}),l=new zo(u,c,h,{},s.document),f=s.targetIds||[],p=s.removedTargetIds||[];e=new pu(f,p,l.key,l)}else if("documentDelete"in t){Hu(t.documentDelete,"documentDelete"),Hu(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;u=this.fromName(d.document),c=d.readTime?this.fromVersion(d.readTime):eo.forDeletedDoc(),l=new Ho(u,c),p=d.removedTargetIds||[];e=new pu([],p,l.key,l)}else if("documentRemove"in t){Hu(t.documentRemove,"documentRemove"),Hu(t.documentRemove.document,"documentRemove");var m=t.documentRemove;u=this.fromName(m.document),p=m.removedTargetIds||[];e=new pu([],p,u,null)}else{if(!("filter"in t))return Yr("Unknown change type "+JSON.stringify(t));Hu(t.filter,"filter"),Hu(t.filter.targetId,"filter.targetId");var y=t.filter,g=y.count||0,v=new Gu(g),b=y.targetId;e=new du(b,v)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?uu.NoChange:"ADD"===t?uu.Added:"REMOVE"===t?uu.Removed:"CURRENT"===t?uu.Current:"RESET"===t?uu.Reset:Yr("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return eo.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?eo.MIN:e.readTime?this.fromVersion(e.readTime):eo.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof ws)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Is)e={delete:this.toName(t.key)};else if(t instanceof Es)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Ts))return Yr("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):vs.NONE;if(t.update){Hu(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Es(r,i,o,n)}return new ws(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new Is(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Xr(!0===n.exists,'Transforms only support precondition "exists == true"'),new Ts(r,a)}return Yr("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return Xr(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Yr("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?vs.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?vs.exists(t.exists):vs.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new gs(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(Xr(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Uu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof qu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Fu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Vu)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Yr("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)Xr("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=Uu.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new qu(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t){r=t.removeAllFromArray.values||[];n=new Fu(r.map(function(t){return e.fromValue(t)}))}else if("increment"in t){var i=this.fromValue(t.increment);Xr(i instanceof ns,"NUMERIC_ADD transform requires a NumberValue"),n=new Vu(i)}else Yr("Unknown transform proto: "+JSON.stringify(t));var o=Bi.fromServerFormat(t.fieldPath);return new ys(o,n)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Xr(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Iu.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Xr(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Xr(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Xr(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new Iu(e,i,s,a,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case Na.Listen:return null;case Na.ExistenceFilterMismatch:return"existence-filter-mismatch";case Na.LimboResolution:return"limbo-document";default:return Yr("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof Nu?e.toUnaryOrFieldFilter(t):Yr("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Yr("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new Pu(r,n)},t.prototype.toDirection=function(t){return Wu[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return Ou.ASCENDING;case"DESCENDING":return Ou.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Qu[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return Au.EQUAL;case"GREATER_THAN":return Au.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return Au.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return Au.LESS_THAN;case"LESS_THAN_OR_EQUAL":return Au.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return Au.ARRAY_CONTAINS;case"IN":return Au.IN;case"ARRAY_CONTAINS_ANY":return Au.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Yr("Unspecified operator");default:return Yr("Unknown operator")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return Bi.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new Lu(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.fromFieldFilter=function(t){return Nu.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryOrFieldFilter=function(t){if(t.op===Au.EQUAL){if(t.value.isEqual(as.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(ts.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return Nu.create(e,Au.EQUAL,as.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return Nu.create(n,Au.EQUAL,ts.INSTANCE);case"OPERATOR_UNSPECIFIED":return Yr("Unspecified filter");default:return Yr("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Bi.fromServerFormat(t)});return ms.fromArray(e)},t}(),Ju=function(){return function(){this.listeners=[]}}(),$u=function(){function t(t){this.syncEngine=t,this.queries=new Xo(function(t){return t.canonicalId()}),this.onlineState=Gs.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new Ju,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t,t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return r(this,void 0,void 0,function(){var e,n,r,o;return i(this,function(i){return e=t.query,n=!1,(r=this.queries.get(e))&&(o=r.listeners.indexOf(t))>=0&&(r.listeners.splice(o,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++){s[a].onViewSnapshot(r)}o.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t,this.queries.forEach(function(e,n){for(var r=0,i=n.listeners;r<i.length;r++){i[r].applyOnlineStateChange(t)}})},t}(),Zu=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=Gs.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(Xr(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==ou.Metadata&&e.push(i)}t=new hu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(Xr(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Gs.Offline;return this.options.waitForSyncWhenOnline&&n?(Xr(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Gs.Offline},t.prototype.shouldRaiseEvent=function(t){if(t.docChanges.length>0)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){Xr(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=hu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),tc=function(){function t(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return t.fromSnapshot=function(e,n){for(var r=go(),i=go(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case ou.Added:r=r.add(s.doc.key);break;case ou.Removed:i=i.add(s.doc.key)}}return new t(e,r,i)},t}(),ec=function(){return function(t){this.key=t}}(),nc=function(){return function(t){this.key=t}}(),rc=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=go(),this.mutatedKeys=go(),this.documentSet=new su(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new cu,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof zo?e:null;h&&(Xr(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data.isEqual(h.data)?l!==f&&(r.track({type:ou.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:ou.Modified,doc:h}),p=!0,u&&n.query.docComparator(h,u)>0&&(s=!0)):!c&&h?(r.track({type:ou.Added,doc:h}),p=!0):c&&!h&&(r.track({type:ou.Removed,doc:c}),p=!0,u&&(s=!0));p&&(h?(a=a.add(h),o=f?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))}),this.query.hasLimit())for(;a.size>this.query.limit;){var c=a.last();a=a.delete(c.key),o=o.delete(c.key),r.track({type:ou.Removed,doc:c})}return Xr(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;Xr(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case ou.Added:return 1;case ou.Modified:case ou.Metadata:return 2;case ou.Removed:return 0;default:return Yr("Unknown ChangeType: "+t)}};return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?au.Synced:au.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new hu(this.query,t.documentSet,i,o,t.mutatedKeys,s===au.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Gs.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new cu,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Xr(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=go(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new nc(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new ec(t))}),n},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=go();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return hu.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===au.Local)},t}();var ic=function(){return function(t,e,n){this.query=t,this.targetId=e,this.view=n}}(),oc=function(){return function(t){this.key=t}}(),ac=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new Xo(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new no(ji.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new As,this.mutationUserCallbacks={},this.limboTargetIdGenerator=Oo.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Gs.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){Xr(null!==t,"SyncEngine listener cannot be null"),Xr(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return r(this,void 0,void 0,function(){var e,n,r,o,a;return i(this,function(i){switch(i.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return o=i.sent(),a=this.sharedClientState.addLocalQueryTarget(o.targetId),e=o.targetId,[4,this.initializeViewAndComputeSnapshot(o,"current"===a)];case 3:n=i.sent(),this.isPrimary&&this.remoteStore.listen(o),i.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e){return r(this,void 0,void 0,function(){var n,r,o,a,s,u,c,h;return i(this,function(i){switch(i.label){case 0:return n=t.query,[4,this.localStore.executeQuery(n)];case 1:return r=i.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return o=i.sent(),a=new rc(n,o),s=a.computeDocChanges(r),u=fu.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&this.onlineState!==Gs.Offline),Xr(0===(c=a.applyChanges(s,!0===this.isPrimary,u)).limboChanges.length,"View returned limbo docs before target ack from the server."),Xr(!!c.snapshot,"applyChanges for new view should always return a snapshot"),h=new ic(n,t.targetId,a),this.queryViewsByQuery.set(n,h),this.queryViewsByTarget[t.targetId]=h,[2,c.snapshot]}})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){return r(this,void 0,void 0,function(){var e,n,r;return i(this,function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t.query)];case 1:return e=i.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return n=i.sent(),r=t.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(t.targetId,r.limboChanges),[2,r]}})})},t.prototype.unlisten=function(t){return r(this,void 0,void 0,function(){var e,n=this;return i(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),Xr(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Wa)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){return r(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}})})},t.prototype.runTransaction=function(t,e){return void 0===e&&(e=5),r(this,void 0,void 0,function(){var n,r,o,a;return i(this,function(i){switch(i.label){case 0:if(Xr(e>=0,"Got negative number of retries for transaction."),n=this.remoteStore.createTransaction(),Vs(r=t(n))||!r.catch||!r.then)return[2,Promise.reject(Error("Transaction callback must return a Promise"))];i.label=1;case 1:return i.trys.push([1,4,,5]),[4,r];case 2:return o=i.sent(),[4,n.commit()];case 3:return i.sent(),[2,o];case 4:return a=i.sent(),e>0&&this.isRetryableTransactionError(a)?[2,this.runTransaction(t,e-1)]:[2,Promise.reject(a)];case 5:return[2]}})})},t.prototype.applyRemoteEvent=function(t){return r(this,void 0,void 0,function(){var e,n=this;return i(this,function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),oi(t.targetChanges,function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(Xr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?Xr(r.receivedDocument,"Received change for limbo target document without add."):e.removedDocuments.size>0&&(Xr(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Wa(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Ws.RemoteStore||!this.isPrimary&&e===Ws.SharedClientState){var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);Xr(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return r(this,void 0,void 0,function(){var n,r,o,a,s,u,c=this;return i(this,function(i){switch(i.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],o=(o=new no(ji.comparator)).insert(r,new Ho(r,eo.forDeletedDoc())),a=go().add(r),s=new lu(eo.MIN,{},new ao(Ni),o,a),[2,this.applyRemoteEvent(s)]):[3,1];case 1:return Xr(!!(u=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(u.query,!1).then(function(){return c.removeAndCleanupQuery(u)}).catch(Wa)];case 2:i.sent(),this.syncEngineListener.onWatchError(u.query,e),i.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return r(this,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(Qr("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Yr("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){return r(this,void 0,void 0,function(){var e,n;return i(this,function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Wa(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.rejectFailedWrite=function(t,e){return r(this,void 0,void 0,function(){var n;return i(this,function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Wa(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new no(Ni)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Xr(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof ec)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof nc){Qr("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else Yr("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Qr("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Iu.atPath(e.path);this.limboResolutionsByTarget[n]=new oc(e),this.remoteStore.listen(new ka(r,n,Na.LimboResolution,Ui.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return r(this,void 0,void 0,function(){var n,r,o,a=this;return i(this,function(i){switch(i.label){case 0:return n=[],r=[],o=[],this.queryViewsByQuery.forEach(function(i,s){o.push(Promise.resolve().then(function(){var e=s.view.computeDocChanges(t);return e.needsRefill?a.localStore.executeQuery(s.query).then(function(t){return s.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[s.targetId],o=s.view.applyChanges(t,!0===a.isPrimary,i);if(a.updateTrackedLimbos(s.targetId,o.limboChanges),o.snapshot){a.isPrimary&&a.sharedClientState.updateQueryState(s.targetId,o.snapshot.fromCache?"not-current":"current"),n.push(o.snapshot);var u=tc.fromSnapshot(s.targetId,o.snapshot);r.push(u)}}))}),[4,Promise.all(o)];case 1:return i.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return i.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){Xr(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return r(this,void 0,void 0,function(){var e,n;return i(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?[4,this.localStore.handleUserChange(t)]:[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return r(this,void 0,void 0,function(){var e,n,r,o,a,s,u,c=this;return i(this,function(i){switch(i.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return i.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=i.sent(),r=0,o=n;r<o.length;r++)a=o[r],this.remoteStore.listen(a);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,s=[],u=Promise.resolve(),ii(this.queryViewsByTarget,function(t,e){c.sharedClientState.isLocalQueryTarget(t)?s.push(t):u=u.then(function(){return c.unlisten(e.query)}),c.remoteStore.unlisten(e.targetId)}),[4,u]);case 4:return i.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)];case 5:return i.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:i.sent(),i.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;ii(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new no(ji.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return r(this,void 0,void 0,function(){var e,n,r,o,a,s,u,c,h;return i(this,function(i){switch(i.label){case 0:e=[],n=[],r=0,o=t,i.label=1;case 1:return r<o.length?(a=o[r],s=void 0,(u=this.queryViewsByTarget[a])?[4,this.localStore.releaseQuery(u.query,!0)]:[3,5]):[3,11];case 2:return i.sent(),[4,this.localStore.allocateQuery(u.query)];case 3:return s=i.sent(),[4,this.synchronizeViewAndComputeSnapshot(u)];case 4:return(c=i.sent()).snapshot&&n.push(c.snapshot),[3,9];case 5:return Xr(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(a)];case 6:return Xr(!!(h=i.sent()),"Query data for target "+a+" not found"),[4,this.localStore.allocateQuery(h)];case 7:return s=i.sent(),[4,this.initializeViewAndComputeSnapshot(s,!1)];case 8:i.sent(),i.label=9;case 9:e.push(s),i.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},t.prototype.isRetryableTransactionError=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!nu(e)}return!1},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return r(this,void 0,void 0,function(){var r,o,a,s,u;return i(this,function(i){switch(i.label){case 0:if(this.isPrimary)return Qr("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,11];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return i.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return r=i.sent(),o=lu.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,o)];case 3:return i.sent(),[3,11];case 4:return a=i.sent(),(c=a).code!==Zr.DATA_LOSS||c.message!==$o?[3,6]:(s=[],ii(this.queryViewsByTarget,function(t){return s.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(s)]);case 5:return i.sent(),[3,7];case 6:throw a;case 7:return[3,8];case 8:return u=this.queryViewsByTarget[t],this.removeAndCleanupQuery(u),[4,this.localStore.releaseQuery(u.query,!0)];case 9:return i.sent(),this.syncEngineListener.onWatchError(u.query,n),[3,11];case 10:Yr("Unexpected target state: "+e),i.label=11;case 11:return[2]}var c})})},t.prototype.applyActiveTargetsChange=function(t,e){return r(this,void 0,void 0,function(){var n,r,o,a,s,u,c,h,l,f=this;return i(this,function(p){switch(p.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,p.label=1;case 1:return n<r.length?(l=r[n],Xr(!this.queryViewsByTarget[l],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(l)]):[3,6];case 2:return Xr(!!(o=p.sent()),"Query data for active target "+l+" not found"),[4,this.localStore.allocateQuery(o)];case 3:return a=p.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 4:p.sent(),this.remoteStore.listen(a),p.label=5;case 5:return n++,[3,1];case 6:s=function(t){var e;return i(this,function(n){switch(n.label){case 0:return(e=u.queryViewsByTarget[t])?[4,u.localStore.releaseQuery(e.query,!1).then(function(){f.remoteStore.unlisten(t),f.removeAndCleanupQuery(e)}).catch(Wa)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},u=this,c=0,h=e,p.label=7;case 7:return c<h.length?(l=h[c],[5,s(l)]):[3,10];case 8:p.sent(),p.label=9;case 9:return c++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?go().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:go()},t}(),sc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),uc="SharedClientState",cc="firestore_clients",hc="firestore_mutations",lc="firestore_targets",fc="firestore_online_state",pc="firestore_sequence_number",dc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,Xr(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),a=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new ti(i.error.code,i.error.message)),o?new t(e,n,i.state,a):(zr(uc,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),mc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,Xr(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new ti(r.error.code,r.error.message)),i?new t(e,r.state,o):(zr(uc,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),yc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=bo(),a=0;i&&a<r.activeTargetIds.length;++a)i=Bs(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(zr(uc,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),gc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&n.onlineState in Gs&&"string"==typeof n.clientId?new t(n.clientId,Gs[n.onlineState]):(zr(uc,"Failed to parse online state: "+e),null)},t}(),vc=function(){function t(){this.activeTargetIds=bo()}return t.prototype.addQueryTarget=function(t){Xr(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),bc=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new ti(Zr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey=pc+"_"+r,this.activeClients[this.localClientId]=new vc,this.clientStateKeyRe=new RegExp("^"+cc+"_"+a+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+hc+"_"+a+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+lc+"_"+a+"_(\\d+)$"),this.onlineStateKey=fc+"_"+r,this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return r(this,void 0,void 0,function(){var t,e,n,r,o,a,s,u,c,h,l,f=this;return i(this,function(i){switch(i.label){case 0:return Xr(!this.started,"WebStorageSharedClientState already started"),Xr(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Xr(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(r)))&&(a=yc.fromWebStorageEntry(r,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=bo();return oi(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=mc.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Qr(uc,"READ",t,e),e},t.prototype.setItem=function(t,e){Qr(uc,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Qr(uc,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(Qr(uc,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void zr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return r(e,void 0,void 0,function(){var e,n,r,o,a,s;return i(this,function(i){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(o=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(o)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(a=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(a)]}else t.key===this.sequenceNumberKey&&(Xr(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(s=function(t){var e=Ui.INVALID;if(null!=t)try{var n=JSON.parse(t);Xr("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){zr(uc,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Ui.INVALID&&this.sequenceNumberHandler(s));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new dc(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Gs[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new mc(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.toWebStorageClientStateKey=function(t){return Xr(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),cc+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageQueryTargetMetadataKey=function(t){return lc+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageMutationBatchKey=function(t){var e=hc+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Xr(null!==n,"Cannot parse client state key '"+t+"'"),yc.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Xr(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return dc.fromWebStorageEntry(new sc(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Xr(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return mc.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return gc.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){return t.user.uid!==this.currentUser.uid?(Qr(uc,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,o=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var a=this.getAllActiveQueryTargets(),s=[],u=[];return a.forEach(function(t){return r(n,void 0,void 0,function(){return i(this,function(e){return o.has(t)||s.push(t),[2]})})}),o.forEach(function(t){return r(n,void 0,void 0,function(){return i(this,function(e){return a.has(t)||u.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(s,u)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}();var wc=function(){function t(){this.localState=new vc,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new vc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),Ec=function(){function t(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}return t.prototype.lruParams=function(){return Ma.withCacheSize(this.cacheSizeBytes)},t}(),Tc=function(){return function(){}}(),Ic=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=Ai.newId(),this._clientShutdown=!1}return t.prototype.start=function(t){var e=this;this.verifyNotShutdown();var n=new Ki,r=new Ki,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof Ec?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof ti?t.code===Zr.FAILED_PRECONDITION||t.code===Zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)},t.prototype.verifyNotShutdown=function(){if(this._clientShutdown)throw new ti(Zr.FAILED_PRECONDITION,"The client has already been shutdown.")},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,o=Ga.buildStoragePrefix(this.databaseInfo),a=new Xu(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return r(n,void 0,void 0,function(){var n,r;return i(this,function(i){switch(i.label){case 0:if(e.synchronizeTabs&&!bc.isAvailable(this.platform))throw new ti(Zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return r=e.lruParams(),e.synchronizeTabs?(this.sharedClientState=new bc(this.asyncQueue,this.platform,o,this.clientId,t),[4,Ga.createMultiClientIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,r,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return n=i.sent(),[3,4];case 2:return this.sharedClientState=new wc,[4,Ga.createIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,r)];case 3:n=i.sent(),i.label=4;case 4:return this.persistence=n,[2,n.referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=Os.createEagerPersistence(this.clientId),this.sharedClientState=new wc,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return Qr("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(o){return r(n,void 0,void 0,function(){var n,a,s,u,c,h=this;return i(this,function(l){switch(l.label){case 0:return this.localStore=new Cs(this.persistence,t),e&&(this.lruScheduler=new xa(e,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),a=this.platform.newSerializer(this.databaseInfo.databaseId),s=new $s(this.asyncQueue,o,this.credentials,a),u=function(t){return h.syncEngine.applyOnlineStateChange(t,Ws.RemoteStore)},c=function(t){return h.syncEngine.applyOnlineStateChange(t,Ws.SharedClientState)},this.remoteStore=new Eu(this.localStore,s,this.asyncQueue,u,n),this.syncEngine=new ac(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=c,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new $u(this.syncEngine),[4,this.sharedClientState.start()];case 1:return l.sent(),[4,this.remoteStore.start()];case 2:return l.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return r(h,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return l.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return r(h,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,this.shutdown()];case 1:return t.sent(),[2]}})})})];case 4:return l.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Qr("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(){var t=this;return this.asyncQueue.enqueue(function(){return r(t,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this._clientShutdown?[3,4]:(this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()]);case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:t.sent(),this.credentials.removeChangeListener(),this._clientShutdown=!0,t.label=4;case 4:return[2]}})})})},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotShutdown();var i=new Zu(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.verifyNotShutdown(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof zo)return t;if(t instanceof Ho)return null;throw new ti(Zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=go(),r=new rc(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},t.prototype.write=function(t){var e=this;this.verifyNotShutdown();var n=new Ki;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},Object.defineProperty(t.prototype,"clientShutdown",{get:function(){return this._clientShutdown},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;return this.verifyNotShutdown(),this.asyncQueue.enqueue(function(){return r(e,void 0,void 0,function(){return i(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),Sc=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Ac=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+Si(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(li("FieldPath","string",n,t[n]),0===t[n].length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Bi(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Ti("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(Bi.keyField().canonicalString()),t}(),Nc=new RegExp("[~\\*/\\[\\]]");var Cc=function(){return function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}}}(),_c=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){Xr(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(sc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){Xr(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),Dc=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var t=this;Xr(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new ti(Zr.ABORTED,"getToken aborted due to token change.");return n?(Xr("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new Cc(n.accessToken,t.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){Xr(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){Xr(null!=this.tokenListener,"removeChangeListener() called twice"),Xr(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Xr(null===t||"string"==typeof t,"Received invalid UID: "+t),new sc(t)},t}(),kc=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=sc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),Rc=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new kc(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(sc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Oc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var Pc,Lc=function(){function t(t){this._methodName=t}return t.delete=function(){return si("FieldValue.delete",arguments),Mc.instance},t.serverTimestamp=function(){return si("FieldValue.serverTimestamp",arguments),xc.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ci("FieldValue.arrayUnion",arguments,1),new Uc(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ci("FieldValue.arrayRemove",arguments,1),new qc(t)},t.increment=function(t){return li("FieldValue.increment","number",1,t),ui("FieldValue.increment",arguments,1),new Fc(t)},t.prototype.isEqual=function(t){return this===t},t}(),Mc=function(t){function n(){return t.call(this,"FieldValue.delete")||this}return e(n,t),n.instance=new n,n}(Lc),xc=function(t){function n(){return t.call(this,"FieldValue.serverTimestamp")||this}return e(n,t),n.instance=new n,n}(Lc),Uc=function(t){function n(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return e(n,t),n}(Lc),qc=function(t){function n(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return e(n,t),n}(Lc),Fc=function(t){function n(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return e(n,t),n}(Lc),Vc=ei(Lc,"Use FieldValue.<field>() instead."),Bc=/^__.*__$/,jc=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Es(t,this.data,this.fieldMask,e)):n.push(new ws(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Ts(t,this.fieldTransforms)),n},t}(),Kc=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new Es(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new Ts(t,this.fieldTransforms)),n},t}();function Gc(t){switch(t){case Pc.Set:case Pc.MergeSet:case Pc.Update:return!0;case Pc.Argument:return!1;default:throw Yr("Unexpected case for UserDataSource: "+t)}}!function(t){t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument"}(Pc||(Pc={}));var Wc=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new ti(Zr.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(Gc(this.dataSource)&&Bc.test(t))throw this.createError("Document fields cannot begin and end with __")},t}(),Qc=function(){return function(t,e){this.databaseId=t,this.key=e}}(),zc=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Wc(Pc.Set,t,Bi.EMPTY_PATH);Yc("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new jc(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new Wc(Pc.MergeSet,t,Bi.EMPTY_PATH);Yc("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new ao(Bi.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof Ac)l=h._internalPath;else{if("string"!=typeof h)throw Yr("Expected stringOrFieldPath to be a string or a FieldPath");l=Jc(t,h)}if(!r.contains(l))throw new ti(Zr.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=ms.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=ms.fromArray(r.fieldMask),o=r.fieldTransforms;return new jc(a,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new Wc(Pc.Update,t,Bi.EMPTY_PATH);Yc("Data must be an object, but it was:",r,e);var i=new ao(Bi.comparator),o=ps.EMPTY;oi(e,function(e,a){var s=Jc(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof Mc)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}});var a=ms.fromSet(i);return new Kc(o,a,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Wc(Pc.Update,t,Bi.EMPTY_PATH),o=[Xc(t,e)],a=[n];if(r.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Xc(t,r[s])),a.push(r[s+1]);var u=new ao(Bi.comparator),c=ps.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof Mc)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=ms.fromSet(u);return new Kc(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new Wc(Pc.Argument,t,Bi.EMPTY_PATH),r=this.parseData(e,n);return Xr(null!=r,"Parsed data should not be null."),Xr(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=$c(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(Hc(t=this.runPreConverter(t,e)))return Yc("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof Lc)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new no(Ni);return ai(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):oi(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new ps(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=ts.INSTANCE),n.push(s),r++}return new ds(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Gc(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof Mc){if(e.dataSource!==Pc.MergeSet)throw e.dataSource===Pc.Update?(Xr(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof xc)e.fieldTransforms.push(new ys(e.path,Uu.instance));else if(t instanceof Uc){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new qu(n);e.fieldTransforms.push(new ys(e.path,r))}else if(t instanceof qc){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new Fu(n);e.fieldTransforms.push(new ys(e.path,i))}else if(t instanceof Fc){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new Vu(o);e.fieldTransforms.push(new ys(e.path,a))}else Yr("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return ts.INSTANCE;if("number"==typeof t)return Bs(t)?new os(t):new as(t);if("boolean"==typeof t)return es.of(t);if("string"==typeof t)return new ss(t);if(t instanceof Date)return new us(to.fromDate(t));if(t instanceof to)return new us(new to(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Tu)return new fs(t);if(t instanceof Oi)return new hs(t);if(t instanceof Qc)return new ls(t.databaseId,t.key);throw e.createError("Unsupported field value: "+bi(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new Wc(Pc.Argument,t,Bi.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function Hc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof to||t instanceof Tu||t instanceof Oi||t instanceof Qc||t instanceof Lc)}function Yc(t,e,n){if(!Hc(n)||!vi(n)){var r=bi(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Xc(t,e){if(e instanceof Ac)return e._internalPath;if("string"==typeof e)return Jc(t,e);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Jc(t,e){try{return function(t){if(t.search(Nc)>=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Ac.bind.apply(Ac,[void 0].concat(t.split("."))))}catch(e){throw new ti(Zr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=$c(e);throw new ti(Zr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function $c(t){return t instanceof Error?t.message:t.toString()}var Zc="firestore.googleapis.com",th=!0,eh=!0,nh=!1,rh=Ma.COLLECTION_DISABLED,ih=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new ti(Zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Zc,this.ssl=th}else pi("settings","non-empty string","host",t.host),this.host=t.host,di("settings","boolean","ssl",t.ssl),this.ssl=ri(t.ssl,th);if(Ei("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),di("settings","object","credentials",t.credentials),this.credentials=t.credentials,di("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?zr("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&zr("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=ri(t.timestampsInSnapshots,eh),di("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ma.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==rh&&t.cacheSizeBytes<Ma.MINIMUM_CACHE_SIZE_BYTES)throw new ti(Zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ma.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}di("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0===t.experimentalForceLongPolling?nh:t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),oh=function(){return function(){}}(),ah=function(){function t(e){var n=this;this._queue=new Wi,this.INTERNAL={delete:function(){return r(n,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.shutdown()];case 1:return t.sent(),[2]}})})}};var o=new oh;if("object"==typeof e.options){var a=e;o.firebaseApp=a,o.databaseId=t.databaseIdFromApp(a),o.persistenceKey=o.firebaseApp.name,o.credentials=new Dc(a)}else{var s=e;if(!s.projectId)throw new ti(Zr.INVALID_ARGUMENT,"Must provide projectId");o.databaseId=new xi(s.projectId,s.database),o.persistenceKey="[DEFAULT]",o.credentials=new _c}o.settings=new ih({}),this._config=o,this._databaseId=o.databaseId}return t.prototype.settings=function(t){if(ui("Firestore.settings",arguments,1),li("Firestore.settings","object",1,t),ni(t,"persistence"))throw new ti(Zr.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new ih(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._config.settings=e,void 0!==e.credentials&&(this._config.credentials=function(t){if(!t)return new _c;switch(t.type){case"gapi":var e=t.client;return Xr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new Rc(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new ti(Zr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new ti(Zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&zr("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=ri(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new Ec(this._config.settings.cacheSizeBytes,e))},t.prototype.clearPersistence=function(){var t=this,e=Ga.buildStoragePrefix(this.makeDatabaseInfo()),n=new Ki;return this._queue.enqueueAndForget(function(){return r(t,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientShutdown)throw new ti(Zr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,Ga.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}})})}),n.promise},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new Tc),this._firestoreClient},t.prototype.makeDatabaseInfo=function(){return new Li(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl,this._config.settings.forceLongPolling)},t.prototype.configureClient=function(t){var e=this;Xr(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),Xr(!this._firestoreClient,"configureClient() called multiple times");var n=this.makeDatabaseInfo();return this._dataConverter=new zc(function(t){if(t instanceof ch){var n=e._config.databaseId,r=t.firestore._config.databaseId;if(!r.isEqual(n))throw new ti(Zr.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new Qc(e._config.databaseId,t._key)}return t}),this._firestoreClient=new Ic(Jr.getPlatform(),n,this._config.credentials,this._queue),this._firestoreClient.start(t)},t.databaseIdFromApp=function(t){var e=t.options;if(!ni(e,"projectId"))throw new ti(Zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new ti(Zr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new xi(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new ti(Zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return ui("Firestore.collection",arguments,1),li("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new mh(Fi.fromString(t),this)},t.prototype.doc=function(t){return ui("Firestore.doc",arguments,1),li("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),ch.forPath(Fi.fromString(t),this)},t.prototype.collectionGroup=function(t){if(ui("Firestore.collectionGroup",arguments,1),li("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new ph(new Iu(Fi.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return ui("Firestore.runTransaction",arguments,1),li("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new sh(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new uh(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(Gr()){case Mr.DEBUG:return"debug";case Mr.ERROR:return"error";case Mr.SILENT:return"silent";default:return Yr("Unknown log level: "+Gr())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(ui("Firestore.setLogLevel",arguments,1),li("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Wr(Mr.DEBUG);break;case"error":Wr(Mr.ERROR);break;case"silent":Wr(Mr.SILENT);break;default:throw new ti(Zr.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},t}(),sh=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;ui("Transaction.get",arguments,1);var n=bh("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Yr("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof Ho)return new lh(e._firestore,n._key,null,!1,!1);if(r instanceof zo)return new lh(e._firestore,n._key,r,!1,!1);throw Yr("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){hi("Transaction.set",arguments,2,3);var r=bh("Transaction.set",t,this._firestore),i=(n=yh("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return"string"==typeof e||e instanceof Ac?(ci("Transaction.update",arguments,3),r=bh("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(ui("Transaction.update",arguments,2),r=bh("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){ui("Transaction.delete",arguments,1);var e=bh("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),uh=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){hi("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=bh("WriteBatch.set",t,this._firestore),i=(n=yh("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,vs.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),"string"==typeof e||e instanceof Ac?(ci("WriteBatch.update",arguments,3),r=bh("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(ui("WriteBatch.update",arguments,2),r=bh("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,vs.exists(!0))),this},t.prototype.delete=function(t){ui("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=bh("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Is(e._key,vs.NONE)),this},t.prototype.commit=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new ti(Zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),ch=function(){function t(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n){if(e.length%2!=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new ji(e),n)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new mh(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(ui("DocumentReference.collection",arguments,1),li("DocumentReference.collection","non-empty string",1,t),!t)throw new ti(Zr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Fi.fromString(t);return new mh(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Ti("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},t.prototype.set=function(t,e){hi("DocumentReference.set",arguments,1,2);var n=(e=yh("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,vs.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof Ac?(ci("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(ui("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,vs.exists(!0)))},t.prototype.delete=function(){return ui("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Is(this._key,vs.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];hi("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Oc(t[i])||(Ei("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),di("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return Oc(t[i])?n=t[i]:(li("DocumentReference.onSnapshot","function",i,t[i]),fi("DocumentReference.onSnapshot","function",i+1,t[i+1]),fi("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Sc({next:function(t){if(e.next){Xr(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new lh(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(Iu.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return hi("DocumentReference.get",arguments,0,1),vh("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new lh(e.firestore,e._key,t,!0,t instanceof zo&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new ti(Zr.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new ti(Zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t}(),hh=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),lh=function(){function t(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return t.prototype.data=function(t){return hi("DocumentSnapshot.data",arguments,0,1),t=gh("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,$a.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},t.prototype.get=function(t,e){if(hi("DocumentSnapshot.get",arguments,1,2),e=gh("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(Xc("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,$a.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new ch(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new hh(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Ti("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))},t.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertValue=function(t,e){if(t instanceof ps)return this.convertObject(t,e);if(t instanceof ds)return this.convertArray(t,e);if(t instanceof ls){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||zr("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new ch(n,this._firestore)}return t.value(e)},t.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},t}(),fh=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.data=function(e){var n=t.prototype.data.call(this,e);return Xr("object"==typeof n,"Document in a QueryDocumentSnapshot should exist"),n},n}(lh),ph=function(){function t(t,e){this._query=t,this.firestore=e}return t.prototype.where=function(e,n,r){if(ui("Query.where",arguments,3),wi("Query.where",3,r),"in"!==n&&"array-contains-any"!==n){!function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new ti(Zr.INVALID_ARGUMENT,"Invalid value "+bi(r)+" provided to function "+t+"() for its "+Ii(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,n)}var i,o=Xc("Query.where",e),a=Au.fromString(n);if(o.isKeyField()){if(a===Au.ARRAY_CONTAINS||a===Au.ARRAY_CONTAINS_ANY)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+a.toString()+"' queries on FieldPath.documentId().");if(a===Au.IN){this.validateDisjunctiveFilterElements(r,a);for(var s=[],u=0,c=r;u<c.length;u++){var h=c[u];s.push(this.parseDocumentIdValue(h))}i=new ds(s)}else i=this.parseDocumentIdValue(r)}else a!==Au.IN&&a!==Au.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(r,a),i=this.firestore._dataConverter.parseQueryValue("Query.where",r);var l=Nu.create(o,a,i);return this.validateNewFilter(l),new t(this._query.addFilter(l),this.firestore)},t.prototype.orderBy=function(e,n){var r;if(hi("Query.orderBy",arguments,1,2),fi("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=Ou.ASCENDING;else{if("desc"!==n)throw new ti(Zr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=Ou.DESCENDING}if(null!==this._query.startAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=Xc("Query.orderBy",e),o=new Lu(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore)},t.prototype.limit=function(e){if(ui("Query.limit",arguments,1),li("Query.limit","number",1,e),e<=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new t(this._query.withLimit(e),this.firestore)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];ci("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];ci("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];ci("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];ci("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Ti("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(wi(t,1,e),e instanceof lh){if(n.length>0)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new ti(Zr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new ls(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof cs)throw new ti(Zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new Pu(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new ti(Zr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Fi.fromString(a));if(!ji.isDocumentKey(s))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new ji(s);i.push(new ls(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new Pu(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];hi("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Oc(t[i])||(Ei("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),di("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),Oc(t[i])?n=t[i]:(li("Query.onSnapshot","function",i,t[i]),fi("Query.onSnapshot","function",i+1,t[i+1]),fi("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Sc({next:function(t){e.next&&e.next(new dh(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},t.prototype.get=function(t){var e=this;return hi("Query.get",arguments,0,1),vh("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new dh(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new ti(Zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Fi.fromString(t));if(!ji.isDocumentKey(e))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new ls(this.firestore._databaseId,new ji(e))}if(t instanceof ch){var n=t;return new ls(this.firestore._databaseId,n._key)}throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+bi(t)+".")},t.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter(function(t){return Number.isNaN(t)}).length>0)throw new ti(Zr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},t.prototype.validateNewFilter=function(t){if(t instanceof Nu){var e=[Au.ARRAY_CONTAINS,Au.ARRAY_CONTAINS_ANY],n=[Au.IN,Au.ARRAY_CONTAINS_ANY],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new ti(Zr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new ti(Zr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),dh=function(){function t(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new hh(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;hi("QuerySnapshot.forEach",arguments,1,2),li("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new ph(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(Ei("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),di("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new ti(Zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new fh(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return Xr(e.type===ou.Added,"Invalid event type for first snapshot"),Xr(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==ou.Metadata}).map(function(e){var r=new fh(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,a=-1;return e.type!==ou.Added&&(Xr((i=o.indexOf(e.doc.key))>=0,"Index for document not found"),o=o.delete(e.doc.key)),e.type!==ou.Removed&&(o=o.add(e.doc),a=o.indexOf(e.doc.key)),{type:wh(e.type),doc:r,oldIndex:i,newIndex:a}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Ti("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},t.prototype.convertToDocumentImpl=function(t){return new fh(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},t}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(dh.prototype.docChanges,t,{get:function(){return function(){throw new ti(Zr.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var mh=function(t){function n(e,n){var r=t.call(this,Iu.atPath(e),n)||this;if(e.length%2!=1)throw new ti(Zr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}return e(n,t),Object.defineProperty(n.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new ch(new ji(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),n.prototype.doc=function(t){if(hi("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Ai.newId()),li("CollectionReference.doc","non-empty string",1,t),""===t)throw new ti(Zr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Fi.fromString(t);return ch.forPath(this._query.path.child(e),this.firestore)},n.prototype.add=function(t){ui("CollectionReference.add",arguments,1),li("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},n}(ph);function yh(t,e){if(void 0===e)return{merge:!1};if(Ei(t,e,["merge","mergeFields"]),di(t,"boolean","merge",e.merge),mi(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof Ac}),void 0!==e.mergeFields&&void 0!==e.merge)throw new ti(Zr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function gh(t,e){return void 0===e?{}:(Ei(t,e,["serverTimestamps"]),yi(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function vh(t,e){fi(t,"object",1,e),e&&(Ei(t,e,["source"]),yi(t,0,"source",e.source,["default","server","cache"]))}function bh(t,e,n){if(e instanceof ch){if(e.firestore!==n)throw new ti(Zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Ti(t,"DocumentReference",1,e)}function wh(t){switch(t){case ou.Added:return"added";case ou.Modified:case ou.Metadata:return"modified";case ou.Removed:return"removed";default:return Yr("Unknown change type: "+t)}}var Eh=ei(ah,"Use firebase.firestore() instead."),Th=ei(sh,"Use firebase.firestore().runTransaction() instead."),Ih=ei(uh,"Use firebase.firestore().batch() instead."),Sh=ei(ch,"Use firebase.firestore().doc() instead."),Ah=ei(lh),Nh=ei(fh),Ch=ei(ph),_h=ei(dh),Dh=ei(mh,"Use firebase.firestore().collection() instead."),kh={Firestore:Eh,GeoPoint:Tu,Timestamp:to,Blob:Pi,Transaction:Th,WriteBatch:Ih,DocumentReference:Sh,DocumentSnapshot:Ah,Query:Ch,QueryDocumentSnapshot:Nh,QuerySnapshot:_h,CollectionReference:Dh,FieldPath:Ac,FieldValue:Vc,setLogLevel:ah.setLogLevel,CACHE_SIZE_UNLIMITED:rh};function Rh(t){t.INTERNAL.registerService("firestore",function(t){return new ah(t)},function(t){Xr(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(kh))}var Oh=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.shutdown=function(){},t}(),Ph=function(){function t(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}return t.prototype.addCallback=function(t){this.callbacks.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},t.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},t.prototype.onNetworkAvailable=function(){Qr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(0)}},t.prototype.onNetworkUnavailable=function(){Qr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(1)}},t.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Lh=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){Xr(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){Xr(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){Xr(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){Xr(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){Xr(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){Xr(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),Mh="Connection",xh={BatchGetDocuments:"batchGet",Commit:"commit"},Uh="gl-js/ fire/"+jr,qh=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=Uh},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,a){var s=new Br;s.listenOnce(Fr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case qr.NO_ERROR:var e=s.getResponseJson();Qr(Mh,"XHR received:",JSON.stringify(e)),o(e);break;case qr.TIMEOUT:Qr(Mh,'RPC "'+t+'" timed out'),a(new ti(Zr.DEADLINE_EXCEEDED,"Request time out"));break;case qr.HTTP_ERROR:var n=s.getStatus();if(Qr(Mh,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var i=(u=r.status,c=u.toLowerCase().replace("_","-"),Object.values(Zr).indexOf(c)>=0?c:Zr.UNKNOWN);a(new ti(i,r.message))}else a(new ti(Zr.UNKNOWN,"Server responded with status "+s.getStatus()))}else Qr(Mh,'RPC "'+t+'" failed'),a(new ti(Zr.UNAVAILABLE,"Connection failed."));break;default:Yr('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{Qr(Mh,'RPC "'+t+'" completed.')}var u,c});var u=JSON.stringify(e);Qr(Mh,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),s.send(i,"POST",u,c,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Ur(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),"object"==typeof navigator&&"ReactNative"===navigator.product||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");Qr(Mh,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),s=!1,u=!1,c=new Lh({sendFn:function(t){u?Qr(Mh,"Not sending because WebChannel is closed:",t):(s||(Qr(Mh,"Opening WebChannel transport."),a.open(),s=!0),Qr(Mh,"WebChannel sending:",t),a.send(t))},closeFn:function(){return a.close()}}),h=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(Vr.EventType.OPEN,function(){u||Qr(Mh,"WebChannel transport opened.")}),h(Vr.EventType.CLOSE,function(){u||(u=!0,Qr(Mh,"WebChannel transport closed"),c.callOnClose())}),h(Vr.EventType.ERROR,function(t){u||(u=!0,Qr(Mh,"WebChannel transport errored:",t),c.callOnClose(new ti(Zr.UNAVAILABLE,"The operation could not be completed")))}),h(Vr.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];Xr(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){Qr(Mh,"WebChannel received error:",r);var i=r.status,o=function(t){var e=tu[t];if(void 0!==e)return ru(e)}(i),s=r.message;void 0===o&&(o=Zr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),u=!0,c.callOnClose(new ti(o,s)),a.close()}else Qr(Mh,"WebChannel received:",e),c.callOnMessage(e)}}),setTimeout(function(){c.callOnOpen()},0),c},t.prototype.makeUrl=function(t){var e=xh[t];Xr(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),Fh=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new qh(t))},t.prototype.newConnectivityMonitor=function(){return Ph.isAvailable()?new Ph:new Oh},t.prototype.newSerializer=function(t){return new Xu(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();Jr.setPlatform(new Fh),Rh(k);var Vh="firebasestorage.googleapis.com",Bh="storageBucket",jh=12e4,Kh=6e4,Gh=-9007199254740991,Wh=function(){function t(t,e){this.code_=zh(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return zh(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),Qh={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function zh(t){return"storage/"+t}function Hh(){return new Wh(Qh.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Yh(){return new Wh(Qh.CANCELED,"User canceled the upload/download.")}function Xh(){return new Wh(Qh.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Jh(t,e,n){return new Wh(Qh.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function $h(){return new Wh(Qh.APP_DELETED,"The Firebase app was deleted.")}function Zh(t,e){return new Wh(Qh.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function tl(t){throw new Wh(Qh.INTERNAL_ERROR,"Internal error: "+t)}var el={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function nl(t){switch(t){case el.RAW:case el.BASE64:case el.BASE64URL:case el.DATA_URL:return;default:throw"Expected one of the event types: ["+el.RAW+", "+el.BASE64+", "+el.BASE64URL+", "+el.DATA_URL+"]."}}var rl=function(){return function(t,e){this.data=t,this.contentType=e||null}}();function il(t,e){switch(t){case el.RAW:return new rl(ol(e));case el.BASE64:case el.BASE64URL:return new rl(al(t,e));case el.DATA_URL:return new rl((n=new sl(e)).base64?al(el.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw Zh(el.DATA_URL,"Malformed data URL.")}return ol(e)}(n.rest),function(t){return new sl(t).contentType}(e))}var n;throw Hh()}function ol(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function al(t,e){switch(t){case el.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw Zh(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case el.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw Zh(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(e)}catch(e){throw Zh(t,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var sl=function(){return function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw Zh(el.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=(r=n,i=";base64",r.length>=i.length&&r.substring(r.length-i.length)===i),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1);var r,i}}();var ul,cl={STATE_CHANGED:"state_changed"},hl={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},ll={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function fl(t){switch(t){case hl.RUNNING:case hl.PAUSING:case hl.CANCELING:return ll.RUNNING;case hl.PAUSED:return ll.PAUSED;case hl.SUCCESS:return ll.SUCCESS;case hl.CANCELED:return ll.CANCELED;case hl.ERROR:default:return ll.ERROR}}function pl(t){return null!=t}function dl(t){return void 0!==t}function ml(t){return"function"==typeof t}function yl(t){return"object"==typeof t}function gl(t){return yl(t)&&null!==t}function vl(t){return"string"==typeof t||t instanceof String}function bl(t){return wl(t)&&Number.isInteger(t)}function wl(t){return"number"==typeof t||t instanceof Number}function El(t){return Tl()&&t instanceof Blob}function Tl(){return"undefined"!=typeof Blob}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(ul||(ul={}));var Il=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=ul.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=ul.ABORT,e(t)}),t.xhr_.addEventListener("error",function(){t.errorCode_=ul.NETWORK_ERROR,e(t)}),t.xhr_.addEventListener("load",function(){e(t)})})}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw tl("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),pl(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return pl(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw tl("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw tl("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw tl("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){pl(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){pl(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),Sl=function(){function t(){}return t.prototype.createXhrIo=function(){return new Il},t}();function Al(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}var Nl=function(){function t(t,e){var n=0,r="";El(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(El(this.data_)){var r=this.data_,i=(a=e,s=n,(o=r).webkitSlice?o.webkitSlice(a,s):o.mozSlice?o.mozSlice(a,s):o.slice?o.slice(a,s):null);return null===i?null:new t(i)}var o,a,s;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(Tl()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Al();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Tl())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}.apply(null,r))}var i=e.map(function(t){return vl(t)?il(el.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var a=new Uint8Array(o),s=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)a[s++]=t[e]}),new t(a,!0)},t.prototype.uploadData=function(){return this.data_},t}(),Cl=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e){var n,r;try{n=t.makeFromUrl(e)}catch(n){return new t(e,"")}if(""===n.path)return n;throw r=e,new Wh(Qh.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")},t.makeFromUrl=function(e){var n=null;var r=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");for(var i=Vh.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(e);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];h||(h=""),n=new t(c,h),s.postModify(n);break}}if(null==n)throw function(t){return new Wh(Qh.INVALID_URL,"Invalid URL '"+t+"'.")}(e);return n},t}();function _l(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return yl(n=e)&&!Array.isArray(n)?e:null}function Dl(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function kl(t){return"https://"+Vh+"/v0"+t}function Rl(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function Ol(t,e){return e}var Pl=function(){return function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||Ol}}(),Ll=null;function Ml(){if(Ll)return Ll;var t=[];t.push(new Pl("bucket")),t.push(new Pl("generation")),t.push(new Pl("metageneration")),t.push(new Pl("name","fullPath",!0));var e=new Pl("name");e.xform=function(t,e){return function(t){return!vl(t)||t.length<2?t:Dl(t)}(e)},t.push(e);var n=new Pl("size");return n.xform=function(t,e){return pl(e)?Number(e):e},t.push(n),t.push(new Pl("timeCreated")),t.push(new Pl("updated")),t.push(new Pl("md5Hash",null,!0)),t.push(new Pl("cacheControl",null,!0)),t.push(new Pl("contentDisposition",null,!0)),t.push(new Pl("contentEncoding",null,!0)),t.push(new Pl("contentLanguage",null,!0)),t.push(new Pl("contentType",null,!0)),t.push(new Pl("metadata","customMetadata",!0)),Ll=t}function xl(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=t.bucket,r=t.fullPath,i=new Cl(n,r);return e.makeStorageReference(i)}})}(r,t),r}function Ul(t,e,n){var r=_l(e);return null===r?null:xl(t,r,n)}function ql(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function Fl(t){if(!yl(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!yl(n))throw"Expected object for 'customMetadata' mapping."}else if(gl(n))throw"Mapping for '"+e+"' cannot be an object."}}var Vl="maxResults",Bl=1e3,jl="pageToken",Kl="prefixes",Gl="items";function Wl(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new Wh(Qh.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Bh+"' property when initializing the app?");if(e[Kl])for(var i=0,o=e[Kl];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new Cl(r,a));n.prefixes.push(s)}if(e[Gl])for(var u=0,c=e[Gl];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new Cl(r,h.name));n.items.push(s)}return n}function Ql(t){if(!yl(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===Vl){if(!bl(t[Vl])||t[Vl]<=0)throw"Expected maxResults to be a positive number.";if(t[Vl]>1e3)throw"Expected maxResults to be less than or equal to "+Bl+"."}else{if(e!==jl)throw"Unknown option: "+e;if(t[jl]&&!vl(t[jl]))throw"Expected pageToken to be string."}}var zl=function(){return function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function Hl(t){if(!t)throw Hh()}function Yl(t,e){return function(n,r){var i=Ul(t,r,e);return Hl(null!==i),i}}function Xl(t){return function(e,n){var r=function(t,e){var n=_l(e);return null===n?null:Wl(t,n)}(t,n);return Hl(null!==r),r}}function Jl(t,e){return function(n,r){var i=Ul(t,r,e);return Hl(null!==i),function(t,e){var n=_l(e);if(null===n)return null;if(!vl(n.downloadTokens))return null;var r=n.downloadTokens;if(0===r.length)return null;var i=encodeURIComponent;return r.split(",").map(function(e){var n=t.bucket,r=t.fullPath;return kl("/b/"+i(n)+"/o/"+i(r))+Rl({alt:"media",token:e})})[0]}(i,r)}}function $l(t){return function(e,n){var r,i,o;return 401===e.getStatus()?r=new Wh(Qh.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(o=t.bucket,r=new Wh(Qh.QUOTA_EXCEEDED,"Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,r=new Wh(Qh.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.setServerResponseProp(n.serverResponseProp()),r}}function Zl(t){var e=$l(t);return function(n,r){var i,o=e(n,r);return 404===n.getStatus()&&(i=t.path,o=new Wh(Qh.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),o.setServerResponseProp(r.serverResponseProp()),o}}function tf(t,e,n){var r=kl(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new zl(r,"GET",Yl(t,n),i);return o.errorHandler=Zl(e),o}function ef(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}var nf=function(){return function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}();function rf(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){Hl(!1)}return Hl(!!n&&-1!==(e||["active"]).indexOf(n)),n}function of(t,e,n,r,i,o,a,s){var u=new nf(0,0);if(a?(u.current=a.current,u.total=a.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new Wh(Qh.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;i>0&&(h=Math.min(h,i));var l=u.current,f=l+h,p={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":u.current},d=r.slice(l,f);if(null===d)throw Xh();var m=e.maxUploadRetryTime(),y=new zl(n,"POST",function(t,n){var i,a=rf(t,["active","final"]),s=u.current+h,c=r.size();return i="final"===a?Yl(e,o)(t,n):null,new nf(s,c,"final"===a,i)},m);return y.headers=p,y.body=d.uploadData(),y.progressCallback=s||null,y.errorHandler=$l(t),y}var af=function(){return function(t,e,n){if(ml(t)||pl(e)||pl(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}}}(),sf=function(){return function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o}}();function uf(t,e,n){for(var r=e.length,i=e.length,o=0;o<e.length;o++)if(e[o].optional){r=o;break}var a,s,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw a=r,s=i,u=t,c=n.length,a===s?(h=a,l=1===a?"argument":"arguments"):(h="between "+a+" and "+s,l="arguments"),new Wh(Qh.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{e[o].validator(n[o])}catch(e){throw e instanceof Error?Jh(o,t,e.message):Jh(o,t,e)}}var cf=function(){return function(t,e){var n=this;this.validator=function(e){n.optional&&!dl(e)||t(e)},this.optional=!!e}}();function hf(t,e){function n(t){if(!vl(t))throw"Expected string."}var r,i,o;return t?(i=n,o=t,r=function(t){i(t),o(t)}):r=n,new cf(r,e)}function lf(){return new cf(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Tl()&&t instanceof Blob))throw"Expected Blob or File."})}function ff(t){return new cf(Fl,t)}function pf(){return new cf(function(t){if(!(wl(t)&&t>=0))throw"Expected a number 0 or greater."})}function df(t,e){return new cf(function(e){if(!(null===e||pl(e)&&e instanceof Object))throw"Expected an Object.";null!=t&&t(e)},e)}function mf(t){return new cf(function(t){if(null!==t&&!ml(t))throw"Expected a Function."},t)}function yf(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then(function(){return t.apply(void 0,e)})}}var gf=function(){function t(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=hl.RUNNING,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(Qh.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(hl.ERROR))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(Qh.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(hl.ERROR))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var t=this,e=this.transferred_;return function(n){return t.updateProgress_(e+n)}},t.prototype.shouldDoResumable_=function(t){return t.size()>262144},t.prototype.start_=function(){this.state_===hl.RUNNING&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(t){var e=this;this.authWrapper_.getAuthToken().then(function(n){switch(e.state_){case hl.RUNNING:t(n);break;case hl.CANCELING:e.transition_(hl.CANCELED);break;case hl.PAUSING:e.transition_(hl.PAUSED)}})},t.prototype.createResumable_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=ef(e,r,i),s={name:a.fullPath},u=kl(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=ql(a,n),l=t.maxUploadRetryTime(),f=new zl(u,"POST",function(t){var e;rf(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){Hl(!1)}return Hl(vl(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=$l(e),f}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.uploadUrl_=e,t.needToFetchStatus_=!1,t.completeTransitions_()},t.errorHandler_)})},t.prototype.fetchStatus_=function(){var t=this,e=this.uploadUrl_;this.resolveToken_(function(n){var r=function(t,e,n,r){var i=t.maxUploadRetryTime(),o=new zl(n,"POST",function(t){var e=rf(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){Hl(!1)}n||Hl(!1);var i=Number(n);return Hl(!isNaN(i)),new nf(i,r.size(),"final"===e)},i);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=$l(e),o}(t.authWrapper_,t.location_,e,t.blob_),i=t.authWrapper_.makeRequest(r,n);t.request_=i,i.getPromise().then(function(e){e=e,t.request_=null,t.updateProgress_(e.current),t.needToFetchStatus_=!1,e.finalized&&(t.needToFetchMetadata_=!0),t.completeTransitions_()},t.errorHandler_)})},t.prototype.continueUpload_=function(){var t=this,e=262144*this.chunkMultiplier_,n=new nf(this.transferred_,this.blob_.size()),r=this.uploadUrl_;this.resolveToken_(function(i){var o;try{o=of(t.location_,t.authWrapper_,r,t.blob_,e,t.mappings_,n,t.makeProgressCallback_())}catch(e){return t.error_=e,void t.transition_(hl.ERROR)}var a=t.authWrapper_.makeRequest(o,i);t.request_=a,a.getPromise().then(function(e){t.increaseMultiplier_(),t.request_=null,t.updateProgress_(e.current),e.finalized?(t.metadata_=e.metadata,t.transition_(hl.SUCCESS)):t.completeTransitions_()},t.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var t=this;this.resolveToken_(function(e){var n=tf(t.authWrapper_,t.location_,t.mappings_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.transition_(hl.SUCCESS)},t.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var t=this;this.resolveToken_(function(e){var n=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=ef(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ql(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=Nl.getBlob(c,r,h);if(null===l)throw Xh();var f={name:u.fullPath},p=kl(o),d=t.maxUploadRetryTime(),m=new zl(p,"POST",Yl(t,n),d);return m.urlParams=f,m.headers=a,m.body=l.uploadData(),m.errorHandler=$l(e),m}(t.authWrapper_,t.location_,t.mappings_,t.blob_,t.metadata_),r=t.authWrapper_.makeRequest(n,e);t.request_=r,r.getPromise().then(function(e){t.request_=null,t.metadata_=e,t.updateProgress_(t.blob_.size()),t.transition_(hl.SUCCESS)},t.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case hl.CANCELING:case hl.PAUSING:this.state_=t,null!==this.request_&&this.request_.cancel();break;case hl.RUNNING:var e=this.state_===hl.PAUSED;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case hl.PAUSED:this.state_=t,this.notifyObservers_();break;case hl.CANCELED:this.error_=Yh(),this.state_=t,this.notifyObservers_();break;case hl.ERROR:case hl.SUCCESS:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case hl.PAUSING:this.transition_(hl.PAUSED);break;case hl.CANCELING:this.transition_(hl.CANCELED);break;case hl.RUNNING:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=fl(this.state_);return new sf(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(t,e,n,r){var i="Expected a function or an Object with one of `next`, `error`, `complete` properties.",o=mf(!0).validator,a=df(null,!0).validator;function s(t){try{return void o(t)}catch(t){}try{if(a(t),!(dl(t.next)||dl(t.error)||dl(t.complete)))throw"";return}catch(t){throw i}}uf("on",[hf(function(){if(t!==cl.STATE_CHANGED)throw"Expected one of the event types: ["+cl.STATE_CHANGED+"]."}),df(s,!0),mf(!0),mf(!0)],arguments);var u=this;function c(t){return function(e,n,i){null!==t&&uf("on",t,arguments);var o=new af(e,n,r);return u.addObserver_(o),function(){u.removeObserver_(o)}}}var h=[df(function(t){if(null===t)throw i;s(t)}),mf(!0),mf(!0)];return!(dl(e)||dl(n)||dl(r))?c(h):c(null)(e,n,r)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},t.prototype.notifyObservers_=function(){var t=this;this.finishPromise_(),this.observers_.slice().forEach(function(e){t.notifyObserver_(e)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(fl(this.state_)){case ll.SUCCESS:yf(this.resolve_.bind(null,this.snapshot))();break;case ll.CANCELED:case ll.ERROR:yf(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(fl(this.state_)){case ll.RUNNING:case ll.PAUSED:t.next&&yf(t.next.bind(t,this.snapshot))();break;case ll.SUCCESS:t.complete&&yf(t.complete.bind(t))();break;case ll.CANCELED:case ll.ERROR:t.error&&yf(t.error.bind(t,this.error_))();break;default:t.error&&yf(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){uf("resume",[],arguments);var t=this.state_===hl.PAUSED||this.state_===hl.PAUSING;return t&&this.transition_(hl.RUNNING),t},t.prototype.pause=function(){uf("pause",[],arguments);var t=this.state_===hl.RUNNING;return t&&this.transition_(hl.PAUSING),t},t.prototype.cancel=function(){uf("cancel",[],arguments);var t=this.state_===hl.RUNNING||this.state_===hl.PAUSING;return t&&this.transition_(hl.CANCELING),t},t}(),vf=function(){function t(t,e){this.authWrapper=t,this.location=e instanceof Cl?e:Cl.makeFromUrl(e)}return t.prototype.toString=function(){return uf("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},t.prototype.newRef=function(e,n){return new t(e,n)},t.prototype.mappings=function(){return Ml()},t.prototype.child=function(t){uf("child",[hf()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new Cl(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(t.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new Cl(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){var t=new Cl(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Dl(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),t.prototype.put=function(t,e){return void 0===e&&(e=null),uf("put",[lf(),ff(!0)],arguments),this.throwIfRoot_("put"),new gf(this,this.authWrapper,this.location,this.mappings(),new Nl(t),e)},t.prototype.putString=function(t,e,n){void 0===e&&(e=el.RAW),uf("putString",[hf(),hf(nl,!0),ff(!0)],arguments),this.throwIfRoot_("putString");var r=il(e,t),i=Object.assign({},n);return!pl(i.contentType)&&pl(r.contentType)&&(i.contentType=r.contentType),new gf(this,this.authWrapper,this.location,this.mappings(),new Nl(r.data,!0),i)},t.prototype.delete=function(){var t=this;return uf("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(e){var n=function(t,e){var n=kl(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new zl(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=Zl(e),i}(t.authWrapper,t.location);return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.listAll=function(){uf("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},t.prototype.listAllHelper=function(t,e){return r(this,void 0,void 0,function(){var n,r,o,a;return i(this,function(i){switch(i.label){case 0:return n={pageToken:e},[4,this.list(n)];case 1:return r=i.sent(),(o=t.prefixes).push.apply(o,r.prefixes),(a=t.items).push.apply(a,r.items),null==r.nextPageToken?[3,3]:[4,this.listAllHelper(t,r.nextPageToken)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.list=function(t){var e;uf("list",[(e=!0,new cf(Ql,e))],arguments);var n=this;return this.authWrapper.getAuthToken().then(function(e){var r=t||{},i=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=kl(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new zl(a,"GET",Xl(t),s);return u.urlParams=o,u.errorHandler=$l(e),u}(n.authWrapper,n.location,"/",r.pageToken,r.maxResults);return n.authWrapper.makeRequest(i,e).getPromise()})},t.prototype.getMetadata=function(){var t=this;return uf("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(e){var n=tf(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise()})},t.prototype.updateMetadata=function(t){var e=this;return uf("updateMetadata",[ff()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(n){var r=function(t,e,n,r){var i=kl(e.fullServerUrl()),o=ql(n,r),a=t.maxOperationRetryTime(),s=new zl(i,"PATCH",Yl(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=Zl(e),s}(e.authWrapper,e.location,t,e.mappings());return e.authWrapper.makeRequest(r,n).getPromise()})},t.prototype.getDownloadURL=function(){var t=this;return uf("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(e){var n=function(t,e,n){var r=kl(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new zl(r,"GET",Jl(t,n),i);return o.errorHandler=Zl(e),o}(t.authWrapper,t.location,t.mappings());return t.authWrapper.makeRequest(n,e).getPromise().then(function(t){if(null===t)throw new Wh(Qh.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},t.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new Wh(Qh.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},t}(),bf=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}(),wf=function(){function t(){this.map=new Map,this.id=Gh}return t.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},t.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},t}(),Ef=function(){function t(e,n,r,i,o){if(this.bucket_=null,this.deleted_=!1,this.app_=e,null!==this.app_){var a=this.app_.options;pl(a)&&(this.bucket_=t.extractBucket_(a))}this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=o,this.service_=i,this.maxOperationRetryTime_=jh,this.maxUploadRetryTime_=Kh,this.requestMap_=new wf}return t.extractBucket_=function(t){var e=t[Bh]||null;return null==e?null:Cl.makeFromBucketSpec(e).bucket},t.prototype.getAuthToken=function(){return null!==this.app_&&pl(this.app_.INTERNAL)&&pl(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},t.prototype.bucket=function(){if(this.deleted_)throw $h();return this.bucket_},t.prototype.service=function(){return this.service_},t.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},t.prototype.makeRequest=function(t,e){if(this.deleted_)return new bf($h());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},t.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},t.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},t.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},t.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},t.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},t}();var Tf=function(){function t(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,a=n.xhr;if(n.wasSuccessCode)try{var s=t.callback_(a,a.getResponseText());dl(s)?i(s):i()}catch(t){o(t)}else null!==a?((r=Hh()).setServerResponseProp(a.getResponseText()),t.errorCallback_?o(t.errorCallback_(a,r)):o(r)):n.canceled?o(r=t.appDelete_?$h():Yh()):o(r=new Wh(Qh.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new If(!1,null,!0)):this.backoffId_=function(t,e,n){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];u||(u=!0,e.apply(null,t))}function h(e){i=setTimeout(function(){i=null,t(l,s())},e)}function l(t){for(var e,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];u||(t?c.call.apply(c,[null,t].concat(n)):s()||o?c.call.apply(c,[null,t].concat(n)):(r<64&&(r*=2),1===a?(a=2,e=0):e=1e3*(r+Math.random()),h(e)))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){o=!0,p(!0)},n),p}(function(e,n){if(n)e(!1,new If(!1,null,!0));else{var r=t.pool_.createXhrIo();t.pendingXhr_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(n){null!==t.progressCallback_&&n.removeUploadProgressListener(i),t.pendingXhr_=null;var r=(n=n).getErrorCode()===ul.NO_ERROR,o=n.getStatus();if(r&&!t.isRetryStatusCode_(o)){var a=-1!==t.successCodes_.indexOf(o);e(!0,new If(a,n))}else{var s=n.getErrorCode()===ul.ABORT;e(!1,new If(!1,null,s))}})}function i(e){var n=e.loaded,r=e.lengthComputable?e.total:-1;null!==t.progressCallback_&&t.progressCallback_(n,r)}},e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),If=function(){return function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n}}();function Sf(t,e,n){var r=Rl(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==k?k.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new Tf(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var Af=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new Ef(t,function(t,e){return new vf(t,e)},Sf,this,e),this.app_=t,null!=n)this.bucket_=Cl.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new Cl(r,""))}this.internals_=new Nf(this)}return t.prototype.ref=function(t){if(uf("ref",[hf(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new vf(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return uf("refFromURL",[hf(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{Cl.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new vf(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){uf("setMaxUploadRetryTime",[pf()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){uf("setMaxOperationRetryTime",[pf()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),Nf=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},t}(),Cf="storage";function _f(t,e,n){return new Af(t,new Sl,n)}function Df(){}function kf(t){let e;return function(t,e){const n=t.subscribe(e);return n.unsubscribe?()=>n.unsubscribe():n}(t,t=>e=t)(),e}!function(t){var e={TaskState:ll,TaskEvent:cl,StringFormat:el,Storage:Af,Reference:vf};t.INTERNAL.registerService(Cf,_f,e,void 0,!0)}(k);const Rf=[];function Of(t,e){return{subscribe:Pf(t,e).subscribe}}function Pf(t,e=Df){let n;const r=[];function i(e){if(o=e,((i=t)!=i?o==o:i!==o||i&&"object"==typeof i||"function"==typeof i)&&(t=e,n)){const e=!Rf.length;for(let e=0;e<r.length;e+=1){const n=r[e];n[1](),Rf.push(n,t)}if(e){for(let t=0;t<Rf.length;t+=2)Rf[t][0](Rf[t+1]);Rf.length=0}}var i,o}return{set:i,update:function(e){i(e(t))},subscribe:function(o,a=Df){const s=[o,a];return r.push(s),1===r.length&&(n=e(i)||Df),o(t),()=>{const t=r.indexOf(s);-1!==t&&r.splice(t,1),0===r.length&&(n(),n=null)}}}}async function Lf(){let t=k.auth().currentUser;return t?t.getIdToken():new Promise((t,e)=>{let n=null;const r=k.auth().onAuthStateChanged(e=>{n&&clearTimeout(n),n=null,r(),t(e?e.getIdToken():null)});n=setTimeout(e,2e3)})}async function Mf(t,e="GET",n=null,r=3e3){const i=await Lf();if(null==i)throw new Error("Not authorized");const o=new AbortController,a=o.signal;setTimeout(()=>o.abort(),r);const s=await fetch(t,{method:e,signal:a,withCredentials:!0,credentials:"include",headers:new Headers({Authorization:"Bearer "+i,"Content-Type":"application/json"}),body:n});if(!s.ok)throw new Error("Request failed. Error code: "+s.status,s);return await s.json()}const xf=window._userdata?window._userdata:new class{constructor(){this.auth_promise=new Promise((t,e)=>{this.auth_resolve=t}),this.access_tokens={},this.backups={},this.tidyupFn=[],this.data_setter=null,this.data=Of(null,t=>this.data_setter=t),this.tidyupFn.push(this.data.subscribe(()=>{})),this.user_setter=null,this.user=Of(null,t=>this.user_setter=t),this.tidyupFn.push(this.user.subscribe(()=>{})),this.actionqueue_has_subscribers=!1,this.actionqueue_setter=null,this.actionqueue=Of({},t=>(this.actionqueue_setter=t,this.actionqueue_has_subscribers=!0,this.actionqueue_init(),()=>{this.actionqueue_has_subscribers=!1,this.actionqueue_init()})),this.tidyupFn.push(this.actionqueue.subscribe(()=>{})),this.BUCKET_BACKUP="gs://openhabx-backups",this.BUCKET_BILLING="gs://openhabx-bills",this.COLL_INVOICES="invoices",console.log("Start firebase"),k.initializeApp({apiKey:"AIzaSyDtVk7gzBYy4ub3B1JuB4xErb_CMcYXHtU",authDomain:"openhabx.firebaseapp.com",databaseURL:"https://openhabx.firebaseio.com",projectId:"openhabx",storageBucket:"openhabx-backups",messagingSenderId:"889637406242",appId:"1:889637406242:web:68e31a7134337311"}),this.tidyupFn.push(k.auth().onAuthStateChanged(t=>this.check_login(t)))}dispose(){this.userdata_listener_unsubscribe&&this.userdata_listener_unsubscribe(),delete this.userdata_listener_unsubscribe;for(const t of this.tidyupFn)t();this.tidyupFn=[],this.actionqueue_unsubscribe&&this.actionqueue_unsubscribe(),delete this.actionqueue_unsubscribe}async ready(){return this.auth_promise}storage(t){return k.app().storage(t)}db(){return k.firestore()}check_login(t){if(t&&"IocPph06rUWM3ABcIHguR3CIw6v1"==t.uid&&(t.is_admin=!0),this.user_setter(t),this.userdata_listener_unsubscribe&&(this.userdata_listener_unsubscribe(),delete this.userdata_listener_unsubscribe),this.actionqueue_init(),t){const e=k.firestore();this.userdata_listener_unsubscribe=e.collection("users").doc(t.uid).onSnapshot(t=>{this.data_setter(t.data()),this.auth_promise.is_resolved=!0,this.auth_resolve()},t=>{console.warn("User data error",t)})}}check_logged_in(){const t=kf(this.user);if(!t||!t.uid)throw console.warn("Not logged in!"),new Error("Not logged in");return t}async applyData(t,e=!1){const n=this.check_logged_in();return k.firestore().collection("users").doc(n.uid).set(t,{merge:e})}async updateData(t){const e=this.check_logged_in();return k.firestore().collection("users").doc(e.uid).update(t)}async queue_removal(){return this.updateData({queued_remove:Date.now()})}async clear_removal(){return this.updateData({queued_remove:k.firestore.FieldValue.delete()})}async add_installation(t){const e=this.check_logged_in(),n={};return n["installations."+t.id]=t,k.firestore().collection("users").doc(e.uid).update(n)}async remove_installation(t){const e=this.check_logged_in();await this.clear_queue(t.id),await this.remove_from_collection("access_tokens",e.uid+"_"+t.id);const n={};return n["installations."+t.id]=k.firestore.FieldValue.delete(),k.firestore().collection("users").doc(e.uid).update(n)}async remove_from_collection(t="",e=""){const n=this.check_logged_in(),r=k.firestore(),i=r.collection(t).where("uid","==",n.uid);return null==e&&(i=i.doc(e)),i.get().then(function(t){let e=r.batch();t.docs.forEach(t=>{e.delete(t.ref)}),e.commit().catch(t=>console.warn("Batch deleting failed:",t))})}async set_collection_doc(t="",e="",n={},r=!1){this.check_logged_in();const i=k.firestore().collection(t);return e.empty()?i.set(n):r?i.doc(e).update(n):i.doc(e).set(n)}async fetch_collection(t="access_tokens",e=null,n=null,r=null){const i=this.check_logged_in();let o=k.firestore().collection(t).where("uid","==",i.uid);e&&(o=o.orderBy(n).limit(e)),r&&(o=o.startAfter(r));let a={};return o.get().then(t=>{const e=t.docs[t.docs.length-1];return t.forEach(t=>a[t.id]=t.data()),e}).then(e=>(this[t]=a,e))}actionqueue_init(){if(!this.actionqueue_has_subscribers)return this.actionqueue_unsubscribe&&this.actionqueue_unsubscribe(),void delete this.actionqueue_unsubscribe;const t=kf(this.user);if(t&&t.uid&&!this.actionqueue_unsubscribe){var e=k.firestore();this.actionqueue_unsubscribe=e.collectionGroup("queue").where("uid","==",t.uid).onSnapshot(t=>{t.docChanges().forEach(t=>{const e=t.doc.data();if(!e.iid||!e.c)return void console.warn("Found queue document that is incomplete",e);const n=e.aid?e.aid:e.c,r=kf(this.actionqueue);"removed"===t.type?r[e.iid]&&(delete r[e.iid][n],this.actionqueue_setter(r)):(r[e.iid]||(r[e.iid]={}),r[e.iid][n]=e,this.actionqueue_setter(r))})})}}async queue_action(t,e,n=null){const r=this.check_logged_in(),i=n||e;return k.firestore().collection("users").doc(r.uid).collection("installations").doc(t).collection("queue").doc(i).set({t:Date.now(),iid:t,c:e,aid:n,uid:r.uid})}async remove_queued_action(t,e,n=null){const r=this.check_logged_in(),i=n||e;return k.firestore().collection("users").doc(r.uid).collection("installations").doc(t).collection("queue").doc(i).delete()}async clear_queue(t=""){const e=this.check_logged_in();return k.firestore().collection("users").doc(e.uid).collection("installations").doc(t).collection("queue").get().then(t=>t.docs.map(t=>{t.reference.delete()}))}};function Uf(t,e,n){const r=t?xf.user.subscribe(e=>t(e)):()=>{},i=e?xf.data.subscribe(t=>e(t)):()=>{},o=n?xf.actionqueue.subscribe(t=>n(t)):()=>{};return()=>{r(),i(),o()}}window._userdata=xf;export{Uf as UserAwareComponent,Mf as fetchWithAuth,k as firebase,Lf as getIdToken,xf as userdata};
//# sourceMappingURL=userdata.js.map
