function t(){}function e(t,e,n,s,c){t.__svelte_meta={loc:{file:e,line:n,column:s,char:c}}}function n(t){return t()}function s(){return Object.create(null)}function c(t){t.forEach(n)}function r(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(t,e){t.appendChild(e)}function i(t,e,n){t.insertBefore(e,n||null)}function l(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function f(){return d(" ")}function h(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function p(t,e,n){t.style.setProperty(e,n)}let m;function v(t){m=t}const g=[],$=[],_=[],w=[],y=Promise.resolve();let k=!1;function b(t){_.push(t)}function x(){const t=new Set;do{for(;g.length;){const t=g.shift();v(t),E(t.$$)}for(;$.length;)$.pop()();for(let e=0;e<_.length;e+=1){const n=_[e];t.has(n)||(n(),t.add(n))}_.length=0}while(g.length);for(;w.length;)w.pop()();k=!1}function E(t){t.fragment&&(t.update(t.dirty),c(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(b))}const C=new Set;const D="undefined"!=typeof window?window:global;function S(t,e){t.$$.dirty||(g.push(t),k||(k=!0,y.then(x)),t.$$.dirty=s()),t.$$.dirty[e]=!0}function L(e,o,a,i,l,u){const d=m;v(e);const f=o.props||{},h=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:l,bound:s(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:[]),callbacks:s(),dirty:null};let p=!1;var g,$,_;h.ctx=a?a(e,f,(t,n)=>{h.ctx&&l(h.ctx[t],h.ctx[t]=n)&&(h.bound[t]&&h.bound[t](n),p&&S(e,t))}):f,h.update(),p=!0,c(h.before_update),h.fragment=i(h.ctx),o.target&&(o.hydrate?h.fragment.l((_=o.target,Array.from(_.childNodes))):h.fragment.c(),o.intro&&((g=e.$$.fragment)&&g.i&&(C.delete(g),g.i($))),function(t,e,s){const{fragment:o,on_mount:a,on_destroy:i,after_update:l}=t.$$;o.m(e,s),b(()=>{const e=a.map(n).filter(r);i?i.push(...e):c(e),t.$$.on_mount=[]}),l.forEach(b)}(e,o.target,o.anchor),x()),v(d)}class j{$destroy(){var e,n;n=1,(e=this).$$.fragment&&(c(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}class A extends j{constructor(t){if(!t||!t.target&&!t.$$inline)throw new Error("'target' is a required option");super()}$destroy(){super.$destroy(),this.$destroy=(()=>{console.warn("Component was already destroyed")})}}const{Error:O,Object:N,console:M}=D,P="assets/js/ui-servicestatus/cmp.svelte";function T(t,e,n){const s=N.create(t);return s.service=e[n],s}function W(t){var n,s,c;return{c:function(){n=u("span"),s=d("Failed"),h(n,"class","text-danger"),h(n,"title",c="Last checked: "+new t.Date(t.service.last_checked).toLocaleString()+".\n          Error: "+t.service.error_msg),e(n,P,101,8,2950)},m:function(t,e){i(t,n,e),a(n,s)},p:function(t,e){t.services_values&&c!==(c="Last checked: "+new e.Date(e.service.last_checked).toLocaleString()+".\n          Error: "+e.service.error_msg)&&h(n,"title",c)},d:function(t){t&&l(n)}}}function q(n){var s;return{c:function(){(s=u("span")).textContent="â€¦",h(s,"class","text-warning"),e(s,P,99,8,2885)},m:function(t,e){i(t,s,e)},p:t,d:function(t){t&&l(s)}}}function B(t){var n,s,c;return{c:function(){n=u("span"),s=d("OK"),h(n,"class","text-success"),h(n,"title",c="Last checked: "+new t.Date(t.service.last_checked).toLocaleString()+".\n          Cached: "+(t.service.cached?"Yes":"No")),e(n,P,92,8,2633)},m:function(t,e){i(t,n,e),a(n,s)},p:function(t,e){t.services_values&&c!==(c="Last checked: "+new e.Date(e.service.last_checked).toLocaleString()+".\n          Cached: "+(e.service.cached?"Yes":"No"))&&h(n,"title",c)},d:function(t){t&&l(n)}}}function I(t){var n,s,c,r,o=t.service.title+"";function h(t){return t.service.ok?B:0===t.service.last_checked?q:W}var p=h(t),m=p(t);return{c:function(){n=u("div"),s=d(o),c=f(),m.c(),r=f(),e(n,P,89,4,2574)},m:function(t,e){i(t,n,e),a(n,s),a(n,c),m.m(n,null),a(n,r)},p:function(t,e){var c,a;t.services_values&&o!==(o=e.service.title+"")&&(a=""+(a=o),(c=s).data!==a&&(c.data=a)),p===(p=h(e))&&m?m.p(t,e):(m.d(1),(m=p(e))&&(m.c(),m.m(n,r)))},d:function(t){t&&l(n),m.d()}}}function Y(n){for(var s,c=n.services_values,r=[],o=0;o<c.length;o+=1)r[o]=I(T(n,c,o));return{c:function(){s=u("div");for(var t=0;t<r.length;t+=1)r[t].c();h(s,"class",n.classes),p(s,"display","grid"),p(s,"grid-auto-flow","column"),p(s,"grid-auto-columns","200px"),p(s,"grid-gap","20px"),e(s,P,84,0,2420)},l:function(t){throw new O("options.hydrate only works if the component was compiled with the `hydratable: true` option")},m:function(t,e){i(t,s,e);for(var n=0;n<r.length;n+=1)r[n].m(s,null)},p:function(t,e){if(t.services_values||t.Date){c=e.services_values;for(var n=0;n<c.length;n+=1){const o=T(e,c,n);r[n]?r[n].p(t,o):(r[n]=I(o),r[n].c(),r[n].m(s,null))}for(;n<r.length;n+=1)r[n].d(1);r.length=c.length}t.classes&&h(s,"class",e.classes)},i:t,o:t,d:function(t){t&&l(s),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(r,t)}}}function F(t,e,n){let s,{classes:c=""}=e,r={registry:{title:"Addon Registry",test_url:"https://registry.openhabx.com/",last_checked:0,ok:!1,timer:null},oauth:{title:"OAuth Tokens",test_url:"https://oauth.openhabx.com/",last_checked:0,ok:!1,timer:null},backup:{title:"Backup Storage",test_url:"gs://openhabx-backups",last_checked:0,ok:!1,timer:null}};!async function(){let t=await import("../../../../../../../../js/cmp/userdata.js");s=t.firebase,await t.userdata.ready();let e=t.userdata.user;for(let[t,c]of Object.entries(r)){const o=localStorage.getItem("servicetest/"+t);if(o&&o.ttl>Date.now()){c.ok=!0,c.cached=!0,c.last_checked=o.last_checked,r[t]=c,n("services",r);continue}let a=null;if(c.test_url.startsWith("http")?a=fetch(c.test_url,{mode:"no-cors"}).then(t=>{if(t.status<200||t.status>=300)throw new Error(`Unhealthy status code ${t.status}`)}):c.test_url.startsWith("gs")&&(a=s.app().storage(c.test_url).ref().child(e.uid).listAll()),!a)return c.ok=!1,void console.error("Not supported service!");a.then(()=>{c.ok=!0,c.last_checked=Date.now(),c.ttl=Date.now()+36e5,localStorage.setItem("servicetest/"+c.id,JSON.stringify(c)),r[t]=c,n("services",r)}).catch(e=>{c.error_msg=e.message,c.ok=!1,c.last_checked=Date.now(),r[t]=c,n("services",r)})}}();const o=["classes"];let a;return N.keys(e).forEach(t=>{o.includes(t)||t.startsWith("$$")||M.warn(`<Cmp> was created with unknown prop '${t}'`)}),t.$set=(t=>{"classes"in t&&n("classes",c=t.classes)}),t.$$.update=((t={services:1})=>{t.services&&n("services_values",a=Object.values(r))}),{classes:c,services_values:a,Date}}class H extends A{constructor(t){super(t),L(this,t,F,Y,o,["classes"])}get classes(){throw new O("<Cmp>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set classes(t){throw new O("<Cmp>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}window.customElements.define("ui-servicestatus",class extends HTMLElement{constructor(){super()}connectedCallback(){const t=this.getAttribute("class")||"btn btn-primary";this.removeAttribute("class"),this.cmp=new H({target:this,props:{classes:t}})}disconnectedCallback(){this.cmp&&this.cmp.onMount&&this.cmp.onMount()}});
//# sourceMappingURL=ui-servicestatus.js.map
